<!DOCTYPE HTML>
<html lang="zh-CN">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta name="HandheldFriendly" content="true">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Xuxx,Galileo,blog" />
    <meta name="generator" content="Maverick 1.0" />
    <meta name="template" content="Galileo" />
    <link rel="alternate" type="application/rss+xml" title="Xuxx的个人博客。 &raquo; RSS 2.0" href="/Xuxx_Blogs/feed/index.xml" />
    <link rel="alternate" type="application/atom+xml" title="Xuxx的个人博客。 &raquo; ATOM 1.0" href="/Xuxx_Blogs/feed/atom/index.xml" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/qq1820582487/Xuxx_Blogs@gh-pages/assets/galileo-ec40839efa.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/qq1820582487/Xuxx_Blogs@gh-pages/assets/ExSearch/ExSearch-182e5a8868.css">
    <link href="https://fonts.googleapis.com/css?family=Fira+Code&display=swap" rel="stylesheet">
    <script>
        var ExSearchConfig = {
            root: "",
            api: "https://cdn.jsdelivr.net/gh/qq1820582487/Xuxx_Blogs@gh-pages/73b61b58a698e60bd0b9a4961779c892.json"
        }
    </script>
    
<title>Spring Boot整合Spring Data JPA - Xuxx的个人博客。</title>
<meta name="author" content="Xuxx" />
<meta name="description" content="笔记" />
<meta property="og:title" content="Spring Boot整合Spring Data JPA - Xuxx的个人博客。" />
<meta property="og:description" content="笔记" />
<meta property="og:site_name" content="Xuxx的个人博客。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/Xuxx_Blogs/archives/bj19/" />
<meta property="og:image" content="" />
<meta property="article:published_time" content="2020-05-13T01:20:00-00.00" />
<meta name="twitter:title" content="Spring Boot整合Spring Data JPA - Xuxx的个人博客。" />
<meta name="twitter:description" content="笔记" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="" />


    
<meta http-equiv="x-dns-prefetch-control" content="on">
<link rel="dns-prefetch" href="//cdn.jsdelivr.net" />

    </head>
    
    <body>
        
        <div class="container">
            <header id="ga-header">
                <div first>
                    <aside id="ga-logo">
                        <a href="/Xuxx_Blogs/" target="_self">
                            <img src="https://cdn.jsdelivr.net/gh/qq1820582487/Xuxx_Blogs@gh-pages/logo.png" alt="Xuxx的个人博客。">
                        </a>
                    </aside>
                    <aside id="ga-brand">
                        <h1 class="brand"><a class="no-style" href="/Xuxx_Blogs/">Xuxx的个人博客。</a></h1>
                        <p>坚持有效行动，改变自然发生。</p>
                    </aside>
                </div>
                <div second id="ga-nav">
                    <nav class="navs">
                        <ul><li><a class="ga-highlight" href="/Xuxx_Blogs/" target="_self">首页</a></li><span class="separator">·</span><li><a class="ga-highlight" href="/Xuxx_Blogs/archives/" target="_self">归档</a></li><span class="separator">·</span><li><a class="ga-highlight" href="/Xuxx_Blogs/about/" target="_self">关于</a></li><span class="separator">·</span><li><a href="#" target="_self" class="search-form-input ga-highlight">搜索</a></li></ul>
                    </nav>
                    <nav class="social-links">
                        <ul><li><a class="no-style" title="Twitter" href="https://twitter.com/xuxx3309" target="_blank"><i class="gi gi-twitter"></i>Twitter</a></li><span class="separator">·</span><li><a class="no-style" title="GitHub" href="https://github.com/QQ1820582487" target="_blank"><i class="gi gi-github"></i>GitHub</a></li></ul>
                    </nav>
                </div>
            </header>
            <div class="wrapper">
                
<main>    
    <section class="ga-section ga-content">
        <article class="yue">
            <h1 class="ga-post_title">Spring Boot整合Spring Data JPA</h1>
            <span class="ga-post_meta ga-mono">
                <span>Xuxx</span>
                <time>
                    2020-05-13
                </time>
                
                in <a no-style class="category" href="/Xuxx_Blogs/category/笔记/">
                    笔记
                </a>
                
                
            </span>
            <div class="ga-content_body">
                <h2>1.了解JPA</h2>
<h3>1. JPA是什么</h3>
<ol>
<li>Java Persistence API：用于对象持久化的 API</li>
<li>Java EE 5.0 平台标准的 ORM 规范，使得应用程序以统一的方式访问持久层
<figure class="pswp-item" style="flex: 88.78326996197718" data-width="467" data-height="263"><img src="https://cdn.jsdelivr.net/gh/qq1820582487/Xuxx_Blogs@gh-pages/archives/assets/71ac7413dbdac1140ee8516a64610395.png" alt="img" /><figcaption>img</figcaption></figure></li>
</ol>
<h3>2. JPA和Hibernate的关系</h3>
<ol>
<li>JPA 是 Hibernate 的一个抽象（就像JDBC和JDBC驱动的关系）；</li>
<li>JPA 是规范：JPA 本质上就是一种 ORM 规范，不是ORM 框架，这是因为 JPA 并未提供 ORM 实现，它只是制订了一些规范，提供了一些编程的 API 接口，但具体实现则由 ORM 厂商提供实现；</li>
<li>Hibernate 是实现：Hibernate 除了作为 ORM 框架之外，它也是一种 JPA 实现</li>
<li>从功能上来说， JPA 是 Hibernate 功能的一个子集</li>
</ol>
<h3>3. JPA的供应商</h3>
<p>JPA 的目标之一是制定一个可以由很多供应商实现的 API，Hibernate 3.2+、TopLink 10.1+ 以及 OpenJPA 都提供了 JPA 的实现，Jpa 供应商有很多，常见的有如下四种：</p>
<ol>
<li>Hibernate
JPA 的始作俑者就是 Hibernate 的作者，Hibernate 从 3.2 开始兼容 JPA。</li>
<li>OpenJPA
OpenJPA 是 Apache 组织提供的开源项目。</li>
<li>TopLink
TopLink 以前需要收费，如今开源了。</li>
<li>EclipseLink</li>
</ol>
<h3>4. JPA的优势</h3>
<ol>
<li>标准化: 提供相同的 API，这保证了基于JPA 开发的企业应用能够经过少量的修改就能够在不同的 JPA 框架下运行。</li>
<li>简单易用，集成方便: JPA 的主要目标之一就是提供更加简单的编程模型，在 JPA 框架下创建实体和创建 Java 类一样简单，只需要使用 javax.persistence.Entity 进行注解；JPA 的框架和接口也都非常简单。</li>
<li>可媲美JDBC的查询能力: JPA的查询语言是面向对象的，JPA定义了独特的JPQL，而且能够支持批量更新和修改、JOIN、GROUP BY、HAVING 等通常只有 SQL 才能够提供的高级查询特性，甚至还能够支持子查询。</li>
<li>支持面向对象的高级特性: JPA 中能够支持面向对象的高级特性，如类之间的继承、多态和类之间的复杂关系，最大限度的使用面向对象的模型</li>
</ol>
<h3>5. JPA包含的技术</h3>
<ol>
<li><p>ORM 映射元数据：JPA 支持 XML 和 JDK 5.0 注解两种元数据的形式，元数据描述对象和表之间的映射关系，框架据此将实体对象持久化到数据库表中。</p>
</li>
<li><p>JPA 的 API：用来操作实体对象，执行CRUD操作，框架在后台完成所有的事情，开发者从繁琐的 JDBC 和 SQL 代码中解脱出来。</p>
</li>
<li><p>查询语言（JPQL）：这是持久化操作中很重要的一个方面，通过面向对象而非面向数据库的查询语言查询数据，避免程序和具体的 SQL 紧密耦合。</p>
<p>## Spring Data</p>
</li>
</ol>
<p>Spring Data 是 Spring 的一个子项目。用于简化数据库访问，支持NoSQL 和 关系数据存储。其主要目标是使数据库的访问变得方便快捷。Spring Data 具有如下特点：</p>
<ol>
<li>SpringData 项目支持 NoSQL 存储：
MongoDB （文档数据库）
Neo4j（图形数据库）
Redis（键/值存储）
Hbase（列族数据库）</li>
<li>SpringData 项目所支持的关系数据存储技术：
JDBC
JPA</li>
<li>Spring Data Jpa 致力于减少数据访问层 (DAO) 的开发量. 开发者唯一要做的，就是声明持久层的接口，其他都交给 Spring Data JPA 来帮你完成！</li>
<li>框架怎么可能代替开发者实现业务逻辑呢？比如：当有一个 UserDao.findUserById() 这样一个方法声明，大致应该能判断出这是根据给定条件的 ID 查询出满足条件的 User 对象。Spring Data JPA 做的便是规范方法的名字，根据符合规范的名字来确定方法需要实现什么样的逻辑。</li>
</ol>
<h3>补充：</h3>
<h4>关于 JPQL</h4>
<ol>
<li>JPQL语言，即 Java Persistence Query Language 的简称。JPQL 是一种和 SQL 非常类似的中间性和对象化查询语言，它最终会被编译成针对不同底层数据库的 SQL 查询，从而屏蔽不同数据库的差异。JPQL语言的语句可以是 select 语句、update 语句或delete语句，它们都通过 Query 接口封装执行。</li>
<li>Query接口封装了执行数据库查询的相关方法。调用 EntityManager 的 createQuery、create NamedQuery 及 createNativeQuery 方法可以获得查询对象，进而可调用 Query 接口的相关方法来执行查询操作。</li>
<li>Query接口的主要方法如下：</li>
</ol>
<ul>
<li><strong>int executeUpdate();</strong> | 用于执行update或delete语句。</li>
<li><strong>List getResultList();</strong> | 用于执行select语句并返回结果集实体列表。</li>
<li><strong>Object getSingleResult();</strong> | 用于执行只返回单个结果实体的select语句。</li>
<li><strong>Query setFirstResult(int startPosition);</strong> | 用于设置从哪个实体记录开始返回查询结果。</li>
<li><strong>Query setMaxResults(int maxResult);</strong> | 用于设置返回结果实体的最大数。与setFirstResult结合使用可实现分页查询。</li>
<li><strong>Query setFlushMode(FlushModeType flushMode);</strong> | 设置查询对象的Flush模式。参数可以取2个枚举值：FlushModeType.AUTO 为自动更新数据库记录，FlushMode Type.COMMIT 为直到提交事务时才更新数据库记录。</li>
<li><strong>setHint(String hintName, Object value);</strong> | 设置与查询对象相关的特定供应商参数或提示信息。参数名及其取值需要参考特定 JPA 实现库提供商的文档。如果第二个参数无效将抛出IllegalArgumentException异常。</li>
<li><strong>setParameter(int position, Object value);</strong> | 为查询语句的指定位置参数赋值。Position 指定参数序号，value 为赋给参数的值。</li>
<li><strong>setParameter(int position, Date d, TemporalType type);</strong> | 为查询语句的指定位置参数赋 Date 值。Position 指定参数序号，value 为赋给参数的值，temporalType 取 TemporalType 的枚举常量，包括 DATE、TIME 及 TIMESTAMP 三个，，用于将 Java 的 Date 型值临时转换为数据库支持的日期时间类型（java.sql.Date、java.sql.Time及java.sql.Timestamp）。</li>
<li><strong>setParameter(int position, Calendar c, TemporalType type);</strong> | 为查询语句的指定位置参数赋 Calenda r值。position 指定参数序号，value 为赋给参数的值，temporalType 的含义及取舍同前。</li>
<li><strong>setParameter(String name, Object value);</strong> | 为查询语句的指定名称参数赋值。</li>
<li><strong>setParameter(String name, Date d, TemporalType type);</strong> | 为查询语句的指定名称参数赋 Date 值,用法同前。</li>
<li><strong>setParameter(String name, Calendar c, TemporalType type);</strong> | 为查询语句的指定名称参数设置Calendar值。name为参数名，其它同前。该方法调用时如果参数位置或参数名不正确，或者所赋的参数值类型不匹配，将抛出 IllegalArgumentException 异常。</li>
</ul>
<h4>JPQL 举例</h4>
<p>和在 SQL 中一样，JPQL 中的 select 语句用于执行查询。其语法可表示为：
<code>select_clause form_clause [where_clause] [groupby_clause] [having_clause] [orderby_clause]</code></p>
<p>其中：</p>
<ol>
<li>from 子句是查询语句的必选子句。</li>
<li>select 用来指定查询返回的结果实体或实体的某些属性。</li>
<li>from 子句声明查询源实体类，并指定标识符变量（相当于SQL表的别名）。</li>
<li>如果不希望返回重复实体，可使用关键字 distinct 修饰。select、from 都是 JPQL 的关键字，通常全大写或全小写，建议不要大小写混用。</li>
</ol>
<p>在 JPQL 中，查询所有实体的 JPQL 查询语句很简单，如下：
<code>select o from Order o 或 select o from Order as o</code>
这里关键字 as 可以省去，标识符变量的命名规范与 Java 标识符相同，且区分大小写,调用 EntityManager 的 createQuery() 方法可创建查询对象，接着调用 Query 接口的 getResultList() 方法就可获得查询结果集，如下：</p>

<pre><code>Query query = entityManager.createQuery( "select o from Order o"); List orders = query.getResultList();Iterator iterator = orders.iterator();while(iterator.hasNext() ) {  // 处理Order}</code></pre>
<p>其他方法的与此类似，这里不再赘述。</p>
<h2>2.使用JPA</h2>
<h3>1.简单使用</h3>
<div class="highlight"><pre><span></span><span class="c">&lt;!--依赖--&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-data-jpa<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>mysql<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>mysql-connector-java<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
    <span class="nt">&lt;version&gt;</span>5.1.27<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="c"># 配置数据库连接池及数据库驱动</span>
<span class="na">spring.datasource.type</span><span class="o">=</span><span class="s">com.zaxxer.hikari.HikariDataSource</span>
<span class="na">spring.datasource.username</span><span class="o">=</span><span class="s">root</span>
<span class="na">spring.datasource.password</span><span class="o">=</span><span class="s">root</span>
<span class="na">spring.datasource.url</span><span class="o">=</span><span class="s">jdbc:mysql://localhost:3306/test?useSSL=false&amp;serverTimezone=Asia/Shanghai</span>

<span class="c">#jpa</span>
<span class="na">spring.jpa.database</span><span class="o">=</span><span class="s">mysql</span>
<span class="na">spring.jpa.database-platform</span><span class="o">=</span><span class="s">mysql</span>
<span class="c"># 生成方式 update 运行时在数据库生成表，若有更新则去更新数据</span>
<span class="na">spring.jpa.hibernate.ddl-auto</span><span class="o">=</span><span class="s">update</span>
<span class="c"># 控制台展示 JPA 框架生成的sql语句</span>
<span class="na">spring.jpa.show-sql</span><span class="o">=</span><span class="s">true</span>
<span class="c"># 使用JPA 创建表时，默认使用的存储引擎是MyISAM，通过指定数据库版本，可以使用InnoDB</span>
<span class="na">spring.jpa.properties.hibernate.dialect</span><span class="o">=</span><span class="s">org.hibernate.dialect.MySQL57Dialect</span>

<span class="c">##是否自动生成dd</span>
<span class="c">#spring.jpa.generate-ddl=true</span>
<span class="c"># 格式化sql语句</span>
<span class="c">#spring.jpa.properties.hibernate-format_sql=true</span>
<span class="c"># 解决 hibernate multiple merge 问题</span>
<span class="c">#spring.jpa.properties.hibernate.event.merge.entity_copy_observer = allow</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * @author Xuxx3309</span>
<span class="cm"> * @Description</span>
<span class="cm"> * @create 2020-05-15 0:41</span>
<span class="cm"> */</span>
<span class="nd">@Data</span>
<span class="c1">//默认情况下类名即表名</span>
<span class="nd">@Entity</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;t_book&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="p">{</span>
    <span class="c1">//标注主键字段</span>
    <span class="nd">@Id</span>
    <span class="c1">//主键自增</span>
    <span class="nd">@GeneratedValue</span><span class="p">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="n">GenerationType</span><span class="p">.</span><span class="na">IDENTITY</span><span class="p">)</span>
    <span class="c1">//@Column(name = &quot;id&quot;, length = 50, nullable = false)</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">id</span><span class="p">;</span>
    <span class="c1">//@Column(name = &quot;name&quot;, length = 50, nullable = false)</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="p">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">author</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * @author Xuxx3309</span>
<span class="cm"> * @Description</span>
<span class="cm"> * @create 2020-05-15 0:51</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">BookDao</span> <span class="kd">extends</span> <span class="n">JpaRepository</span><span class="o">&lt;</span><span class="n">Book</span><span class="p">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="p">{</span>
<span class="p">}</span>
</pre></div>
<p>补充：</p>
<p>与继承 Repository 接口等价的一种方式是在持久层接口上使用 @RepositoryDefinition 注解，并为其指定 domainClass 和 idClass 属性。像下面这样：</p>
<div class="highlight"><pre><span></span><span class="nd">@RepositoryDefinition</span><span class="p">(</span><span class="n">domainClass</span> <span class="o">=</span> <span class="n">Book</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">idClass</span> <span class="o">=</span> <span class="n">Inetger</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">BookDao</span><span class="p">{</span>
<span class="p">}</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="c1">//测试JPA中自带的方法</span>

<span class="nd">@SpringBootTest</span>
<span class="kd">class</span> <span class="nc">JpaApplicationTests</span> <span class="p">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">BookDao</span> <span class="n">bookDao</span><span class="p">;</span>

    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="nf">testSave</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Book</span><span class="p">();</span>
        <span class="n">book</span><span class="p">.</span><span class="na">setName</span><span class="p">(</span><span class="s">&quot;JAVA开发指南&quot;</span><span class="p">);</span>
        <span class="n">book</span><span class="p">.</span><span class="na">setAuthor</span><span class="p">(</span><span class="s">&quot;Xuxx&quot;</span><span class="p">);</span>
        <span class="n">Book</span> <span class="n">save_book</span> <span class="o">=</span> <span class="n">bookDao</span><span class="p">.</span><span class="na">save</span><span class="p">(</span><span class="n">book</span><span class="p">);</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">save_book</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testUpdate</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Book</span><span class="p">();</span>
        <span class="n">book</span><span class="p">.</span><span class="na">setId</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">book</span><span class="p">.</span><span class="na">setName</span><span class="p">(</span><span class="s">&quot;JAVA开发指南&quot;</span><span class="p">);</span>
        <span class="n">book</span><span class="p">.</span><span class="na">setAuthor</span><span class="p">(</span><span class="s">&quot;X&quot;</span><span class="p">);</span>
        <span class="c1">//saveAndFlush:数据库中有（根据id判断）就更新，没有就添加</span>
        <span class="n">Book</span> <span class="n">saveAndFlush</span> <span class="o">=</span> <span class="n">bookDao</span><span class="p">.</span><span class="na">saveAndFlush</span><span class="p">(</span><span class="n">book</span><span class="p">);</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">saveAndFlush</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testDaelete</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">bookDao</span><span class="p">.</span><span class="na">deleteById</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testFind1</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">Optional</span><span class="o">&lt;</span><span class="n">Book</span><span class="o">&gt;</span> <span class="n">book1</span> <span class="o">=</span> <span class="n">bookDao</span><span class="p">.</span><span class="na">findById</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">book1</span><span class="p">.</span><span class="na">get</span><span class="p">());</span>

        <span class="n">List</span><span class="o">&lt;</span><span class="n">Book</span><span class="o">&gt;</span> <span class="n">books</span> <span class="o">=</span> <span class="n">bookDao</span><span class="p">.</span><span class="na">findAll</span><span class="p">();</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">Book</span> <span class="n">book</span> <span class="p">:</span> <span class="n">books</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">book</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">     * 排序</span>
<span class="cm">     */</span>
    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testFind2</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">Sort</span> <span class="n">sort</span> <span class="o">=</span> <span class="n">Sort</span><span class="p">.</span><span class="na">by</span><span class="p">(</span><span class="n">Sort</span><span class="p">.</span><span class="na">Direction</span><span class="p">.</span><span class="na">DESC</span><span class="p">,</span> <span class="s">&quot;id&quot;</span><span class="p">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Book</span><span class="o">&gt;</span> <span class="n">books</span> <span class="o">=</span> <span class="n">bookDao</span><span class="p">.</span><span class="na">findAll</span><span class="p">(</span><span class="n">sort</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">Book</span> <span class="n">book</span> <span class="p">:</span> <span class="n">books</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">book</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">     * 分页</span>
<span class="cm">     */</span>
    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testFind3</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">//of参数：1.第几页（从0开始） 2.每页几条</span>
        <span class="n">Pageable</span> <span class="n">pageable</span> <span class="o">=</span> <span class="n">PageRequest</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
        <span class="n">Page</span><span class="o">&lt;</span><span class="n">Book</span><span class="o">&gt;</span> <span class="n">page</span> <span class="o">=</span> <span class="n">bookDao</span><span class="p">.</span><span class="na">findAll</span><span class="p">(</span><span class="n">pageable</span><span class="p">);</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;总记录数：&quot;</span> <span class="o">+</span> <span class="n">page</span><span class="p">.</span><span class="na">getTotalElements</span><span class="p">());</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;总页数：&quot;</span> <span class="o">+</span> <span class="n">page</span><span class="p">.</span><span class="na">getTotalPages</span><span class="p">());</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;当前页数（从0开始）：&quot;</span> <span class="o">+</span> <span class="n">page</span><span class="p">.</span><span class="na">getNumber</span><span class="p">());</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;每页记录数：&quot;</span> <span class="o">+</span> <span class="n">page</span><span class="p">.</span><span class="na">getSize</span><span class="p">());</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;当前页中存在的记录数：&quot;</span> <span class="o">+</span> <span class="n">page</span><span class="p">.</span><span class="na">getNumberOfElements</span><span class="p">());</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;是否是首页：&quot;</span> <span class="o">+</span> <span class="n">page</span><span class="p">.</span><span class="na">isFirst</span><span class="p">());</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;是否是尾页页：&quot;</span> <span class="o">+</span> <span class="n">page</span><span class="p">.</span><span class="na">isLast</span><span class="p">());</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;查询结果：&quot;</span> <span class="o">+</span> <span class="n">page</span><span class="p">.</span><span class="na">getContent</span><span class="p">());</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">Book</span> <span class="n">book</span> <span class="p">:</span> <span class="n">page</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">book</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">     * 排序+分页</span>
<span class="cm">     */</span>
    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testFind4</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">Sort</span> <span class="n">sort</span> <span class="o">=</span> <span class="n">Sort</span><span class="p">.</span><span class="na">by</span><span class="p">(</span><span class="n">Sort</span><span class="p">.</span><span class="na">Direction</span><span class="p">.</span><span class="na">DESC</span><span class="p">,</span> <span class="s">&quot;id&quot;</span><span class="p">);</span>
        <span class="n">Pageable</span> <span class="n">pageable</span> <span class="o">=</span> <span class="n">PageRequest</span><span class="p">.</span><span class="na">of</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sort</span><span class="p">);</span>
        <span class="n">Page</span><span class="o">&lt;</span><span class="n">Book</span><span class="o">&gt;</span> <span class="n">page</span> <span class="o">=</span> <span class="n">bookDao</span><span class="p">.</span><span class="na">findAll</span><span class="p">(</span><span class="n">pageable</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">Book</span> <span class="n">book</span> <span class="p">:</span> <span class="n">page</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">book</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<h3>2.关键字自定义查询方法</h3>
<h4>方法定义规范</h4>
<h5>1.简单条件查询</h5>
<ul>
<li>按照 Spring Data 的规范，查询方法以 find | read | get 开头</li>
<li>涉及条件查询时，条件的属性用条件关键字连接，要注意的是：条件属性以首字母大写</li>
<li>支持属性的级联查询. 若当前类有符合条件的属性, 则优先使用, 而不使用级联属性. 若需要使用级联属性, 则属性之间使用 _ 进行连接.</li>
</ul>
<p>查询举例：
1.按照id查询</p>

<pre><code>User getUserById(Long id);</code></pre>
<p>2.查询所有年龄小于90岁的人</p>

<pre><code>List&lt;User&gt; findByAgeLessThan(Long age);</code></pre>
<p>3.查询所有姓赵的人（以赵开头）</p>

<pre><code>List&lt;User&gt; findByUsernameStartingWith(String u);</code></pre>
<p>4.查询所有姓赵的、并且id大于50的人</p>

<pre><code>List&lt;User&gt; findByUsernameStartingWithAndIdGreaterThan(String name, Long id);</code></pre>
<p>5.查询所有姓名中包含”上”字的人</p>

<pre><code>List&lt;User&gt; findByUsernameContaining(String name);</code></pre>
<p>6.查询所有姓赵的或者年龄大于90岁的</p>

<pre><code>List&lt;User&gt; findByUsernameStartingWithOrAgeGreaterThan(String name, Long age);</code></pre>
<p>7.查询所有角色为1的用户</p>

<pre><code>List&lt;User&gt; findByRole_Id(Long id);</code></pre>
<p>8.模糊查询（可以直接用 例5）</p>

<pre><code>//调用时要加 "%"+name+"%"
List&lt;User&gt; findByNameLike(String name);</code></pre>
<h5>2.支持的关键字</h5>
<p>支持的查询关键字如下图：</p>
<p><figure class="pswp-item" style="flex: 56.96378830083565" data-width="818" data-height="718"><img src="https://cdn.jsdelivr.net/gh/qq1820582487/Xuxx_Blogs@gh-pages/archives/assets/dc596932a06b2dfd41ac0d8315fa65c3.png" alt="" /></figure></p>
<h5>3.查询方法流程解析</h5>
<p>为什么写上方法名，JPA就知道你想干嘛了呢？假如创建如下的查询：<code>findByUserDepUuid()</code>，框架在解析该方法时，首先剔除 findBy，然后对剩下的属性进行解析，假设查询实体为Doc：</p>
<ol>
<li>先判断 userDepUuid （根据 POJO 规范，首字母变为小写）是否为查询实体的一个属性，如果是，则表示根据该属性进行查询；如果没有该属性，继续第二步；</li>
<li>从右往左截取第一个大写字母开头的字符串(此处为Uuid)，然后检查剩下的字符串是否为查询实体的一个属性，如果是，则表示根据该属性进行查询；如果没有该属性，则重复第二步，继续从右往左截取；最后假设 user 为查询实体的一个属性；</li>
<li>接着处理剩下部分（DepUuid），先判断 user 所对应的类型是否有depUuid属性，如果有，则表示该方法最终是根据 “ Doc.user.depUuid” 的取值进行查询；否则继续按照步骤 2 的规则从右往左截取，最终表示根据 “Doc.user.dep.uuid” 的值进行查询。</li>
<li>可能会存在一种特殊情况，比如 Doc包含一个 user 的属性，也有一个 userDep 属性，此时会存在混淆。可以明确在属性之间加上 “_” 以显式表达意图，比如 “findByUser_DepUuid()” 或者 “findByUserDep_uuid()”</li>
<li>还有一些特殊的参数：例如分页或排序的参数：</li>
</ol>

<pre><code>Page&lt;UserModel&gt; findByName(String name, Pageable pageable);  List&lt;UserModel&gt; findByName(String name, Sort sort);</code></pre>
<h6>@Query注解</h6>
<p>有的时候，这里提供的查询关键字并不能满足我们的查询需求，这个时候就可以使用 @Query 关键字，来自定义查询 SQL，例如查询Id最大的User：</p>

<pre><code>@Query("select u from t_user u where id=(select max(id) from t_user)")
User getMaxIdUser();</code></pre>
<p>如果查询有参数的话，参数有两种不同的传递方式:</p>
<p>1.利用下标索引传参，索引参数如下所示，索引值从1开始，查询中 ”?X” 个数需要与方法定义的参数个数相一致，并且顺序也要一致：</p>

<pre><code>@Query("select u from t_user u where id&gt;?1 and username like ?2")
List&lt;User&gt; selectUserByParam(Long id, String name);</code></pre>
<p>2.命名参数（推荐）：这种方式可以定义好参数名，赋值时采用@Param(“参数名”)，而不用管顺序：</p>

<pre><code>@Query("select u from t_user u where id&gt;:id and username like :name")
List&lt;User&gt; selectUserByParam2(@Param("name") String name, @Param("id") Long id);</code></pre>
<p>查询时候，也可以是使用原生的SQL查询，如下：</p>

<pre><code>@Query(value = "select * from t_user",nativeQuery = true)
List&lt;User&gt; selectAll();</code></pre>
<h6>@Modifying注解</h6>
<p>涉及到数据修改操作，可以使用 @Modifying 注解，@Query 与 @Modifying 这两个 annotation一起声明，可定义个性化更新操作，例如涉及某些字段更新时最为常用，示例如下：</p>

<pre><code>@Modifying
@Query("update t_user set age=:age where id&gt;:id")
int updateUserById(@Param("age") Long age, @Param("id") Long id);</code></pre>
<p>注意：</p>
<ol>
<li>可以通过自定义的 JPQL 完成 UPDATE 和 DELETE 操作. 注意: JPQL 不支持使用 INSERT</li>
<li>方法的返回值应该是 int，表示更新语句所影响的行数</li>
<li>在调用的地方必须加事务，没有事务不能正常执行</li>
<li>默认情况下, Spring Data 的每个方法上有事务, 但都是一个只读事务. 他们不能完成修改操作</li>
</ol>
<h6>@Transactional 注解</h6>
<p>说到这里，再来顺便说说<strong>Spring Data 中的事务问题</strong>：</p>
<ol>
<li>Spring Data 提供了默认的事务处理方式，即所有的查询均声明为只读事务。</li>
<li>对于自定义的方法，如需改变 Spring Data 提供的事务默认方式，可以在方法上添加 <code>@Transactional 注解</code>。</li>
<li>进行多个 Repository 操作时，也应该使它们在同一个事务中处理，按照分层架构的思想，这部分属于业务逻辑层，因此，需要在Service 层实现对多个 Repository 的调用，并在相应的方法上声明事务。</li>
</ol>
<h3>3. Spring Boot整合JPA多数据源</h3>
<div class="highlight"><pre><span></span><span class="c">&lt;!--依赖--&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-data-jpa<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>mysql<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>mysql-connector-java<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
    <span class="nt">&lt;version&gt;</span>5.1.27<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="c"># 配置数据库连接池及数据库驱动</span>
<span class="na">spring.datasource.one.type</span><span class="o">=</span><span class="s">com.zaxxer.hikari.HikariDataSource</span>
<span class="na">spring.datasource.one.username</span><span class="o">=</span><span class="s">root</span>
<span class="na">spring.datasource.one.password</span><span class="o">=</span><span class="s">root</span>
<span class="c">#使用Hikari的话要讲url换成jdbcurl，Druid直接使用url</span>
<span class="na">spring.datasource.one.jdbcurl</span><span class="o">=</span><span class="s">jdbc:mysql://localhost:3306/test?useSSL=false&amp;serverTimezone=Asia/Shanghai</span>

<span class="na">spring.datasource.two.type</span><span class="o">=</span><span class="s">com.zaxxer.hikari.HikariDataSource</span>
<span class="na">spring.datasource.two.username</span><span class="o">=</span><span class="s">root</span>
<span class="na">spring.datasource.two.password</span><span class="o">=</span><span class="s">root</span>
<span class="na">spring.datasource.two.jdbcurl</span><span class="o">=</span><span class="s">jdbc:mysql://localhost:3306/test2?useSSL=false&amp;serverTimezone=Asia/Shanghai</span>
<span class="c">#与单数据源不同的是 在jpa后都要加上properties</span>
<span class="na">spring.jpa.properties.database</span><span class="o">=</span><span class="s">mysql</span>
<span class="na">spring.jpa.properties.database-platform</span><span class="o">=</span><span class="s">mysql</span>
<span class="na">spring.jpa.properties.hibernate.ddl-auto</span><span class="o">=</span><span class="s">update</span>
<span class="na">spring.jpa.properties.show-sql</span><span class="o">=</span><span class="s">true</span>
<span class="na">spring.jpa.properties.hibernate.dialect</span><span class="o">=</span><span class="s">org.hibernate.dialect.MySQL57Dialect</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * @author Xuxx3309</span>
<span class="cm"> * @Description 配置数据源</span>
<span class="cm"> * @create 2020-05-16 0:30</span>
<span class="cm"> */</span>
<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DataSourceConfig</span> <span class="p">{</span>

    <span class="nd">@Bean</span>
    <span class="nd">@Primary</span><span class="c1">//优先考虑被注解的对象注入</span>
    <span class="nd">@ConfigurationProperties</span><span class="p">(</span><span class="n">prefix</span> <span class="o">=</span> <span class="s">&quot;spring.datasource.one&quot;</span><span class="p">)</span>
    <span class="n">DataSource</span> <span class="nf">dsOne</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">//此处使用Hikari</span>
        <span class="k">return</span> <span class="n">DataSourceBuilder</span><span class="p">.</span><span class="na">create</span><span class="p">().</span><span class="na">type</span><span class="p">(</span><span class="n">HikariDataSource</span><span class="p">.</span><span class="na">class</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>
        <span class="c1">//使用Druid DataSource</span>
<span class="c1">//        return DruidDataSourceBuilder.create().build();</span>
    <span class="p">}</span>

    <span class="nd">@Bean</span>
    <span class="nd">@ConfigurationProperties</span><span class="p">(</span><span class="n">prefix</span> <span class="o">=</span> <span class="s">&quot;spring.datasource.two&quot;</span><span class="p">)</span>
    <span class="n">DataSource</span> <span class="nf">dsTwo</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">DataSourceBuilder</span><span class="p">.</span><span class="na">create</span><span class="p">().</span><span class="na">type</span><span class="p">(</span><span class="n">HikariDataSource</span><span class="p">.</span><span class="na">class</span><span class="p">).</span><span class="na">build</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * @author Xuxx3309</span>
<span class="cm"> * @Description 配置jpa1</span>
<span class="cm"> * @create 2020-05-16 0:39</span>
<span class="cm"> */</span>
<span class="nd">@Configuration</span>
<span class="nd">@EnableJpaRepositories</span><span class="p">(</span><span class="n">basePackages</span> <span class="o">=</span> <span class="s">&quot;com.xuxx.jpa2.dao1&quot;</span><span class="p">,</span>
        <span class="n">entityManagerFactoryRef</span> <span class="o">=</span> <span class="s">&quot;localContainerEntityManagerFactoryBeanOne&quot;</span><span class="p">,</span>
        <span class="n">transactionManagerRef</span> <span class="o">=</span> <span class="s">&quot;platformTransactionManagerOne&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JpaConfigOne</span> <span class="p">{</span>
    <span class="nd">@Autowired</span>
    <span class="nd">@Qualifier</span><span class="p">(</span><span class="s">&quot;dsOne&quot;</span><span class="p">)</span>
    <span class="n">DataSource</span> <span class="n">dsOne</span><span class="p">;</span>

    <span class="nd">@Autowired</span>
    <span class="n">JpaProperties</span> <span class="n">jpaProperties</span><span class="p">;</span>

    <span class="nd">@Bean</span>
    <span class="nd">@Primary</span>
    <span class="n">LocalContainerEntityManagerFactoryBean</span> <span class="nf">localContainerEntityManagerFactoryBeanOne</span><span class="p">(</span><span class="n">EntityManagerFactoryBuilder</span> <span class="n">builder</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">builder</span><span class="p">.</span><span class="na">dataSource</span><span class="p">(</span><span class="n">dsOne</span><span class="p">)</span>
                <span class="p">.</span><span class="na">properties</span><span class="p">(</span><span class="n">jpaProperties</span><span class="p">.</span><span class="na">getProperties</span><span class="p">())</span>
                <span class="p">.</span><span class="na">persistenceUnit</span><span class="p">(</span><span class="s">&quot;pu1&quot;</span><span class="p">)</span>
                <span class="p">.</span><span class="na">packages</span><span class="p">(</span><span class="s">&quot;com.xuxx.jpa2.bean&quot;</span><span class="p">)</span>
                <span class="p">.</span><span class="na">build</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="cm">/**</span>
<span class="cm">     * PlatformTransactionManager是JpaTransactionManager的顶层父类</span>
<span class="cm">     *</span>
<span class="cm">     * @param builder</span>
<span class="cm">     * @return</span>
<span class="cm">     */</span>
    <span class="nd">@Bean</span>
    <span class="n">PlatformTransactionManager</span> <span class="nf">platformTransactionManagerOne</span><span class="p">(</span><span class="n">EntityManagerFactoryBuilder</span> <span class="n">builder</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">JpaTransactionManager</span><span class="p">(</span><span class="n">localContainerEntityManagerFactoryBeanOne</span><span class="p">((</span><span class="n">builder</span><span class="p">)).</span><span class="na">getObject</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * @author Xuxx3309</span>
<span class="cm"> * @Description 配置jpa2</span>
<span class="cm"> * @create 2020-05-16 0:39</span>
<span class="cm"> */</span>
<span class="nd">@Configuration</span>
<span class="nd">@EnableJpaRepositories</span><span class="p">(</span><span class="n">basePackages</span> <span class="o">=</span> <span class="s">&quot;com.xuxx.jpa2.dao2&quot;</span><span class="p">,</span>
        <span class="n">entityManagerFactoryRef</span> <span class="o">=</span> <span class="s">&quot;localContainerEntityManagerFactoryBeanTwo&quot;</span><span class="p">,</span>
        <span class="n">transactionManagerRef</span> <span class="o">=</span> <span class="s">&quot;platformTransactionManagerTwo&quot;</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JpaConfigTwo</span> <span class="p">{</span>
    <span class="nd">@Autowired</span>
    <span class="nd">@Qualifier</span><span class="p">(</span><span class="s">&quot;dsOne&quot;</span><span class="p">)</span>
    <span class="n">DataSource</span> <span class="n">dsOne</span><span class="p">;</span>

    <span class="nd">@Autowired</span>
    <span class="n">JpaProperties</span> <span class="n">jpaProperties</span><span class="p">;</span>

    <span class="nd">@Bean</span>
    <span class="n">LocalContainerEntityManagerFactoryBean</span> <span class="nf">localContainerEntityManagerFactoryBeanTwo</span><span class="p">(</span><span class="n">EntityManagerFactoryBuilder</span> <span class="n">builder</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">builder</span><span class="p">.</span><span class="na">dataSource</span><span class="p">(</span><span class="n">dsOne</span><span class="p">)</span>
                <span class="p">.</span><span class="na">properties</span><span class="p">(</span><span class="n">jpaProperties</span><span class="p">.</span><span class="na">getProperties</span><span class="p">())</span>
                <span class="p">.</span><span class="na">persistenceUnit</span><span class="p">(</span><span class="s">&quot;pu1&quot;</span><span class="p">)</span>
                <span class="p">.</span><span class="na">packages</span><span class="p">(</span><span class="s">&quot;com.xuxx.jpa2.bean&quot;</span><span class="p">)</span>
                <span class="p">.</span><span class="na">build</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="nd">@Bean</span>
    <span class="n">PlatformTransactionManager</span> <span class="nf">platformTransactionManagerTwo</span><span class="p">(</span><span class="n">EntityManagerFactoryBuilder</span> <span class="n">builder</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">JpaTransactionManager</span><span class="p">(</span><span class="n">localContainerEntityManagerFactoryBeanTwo</span><span class="p">((</span><span class="n">builder</span><span class="p">)).</span><span class="na">getObject</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * @author Xuxx3309</span>
<span class="cm"> * @Description</span>
<span class="cm"> * @create 2020-05-16 1:46</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">BookDao1</span> <span class="kd">extends</span> <span class="n">JpaRepository</span><span class="o">&lt;</span><span class="n">Book</span><span class="p">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="p">{</span>
<span class="p">}</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="cm">/**</span>
<span class="cm"> * @author Xuxx3309</span>
<span class="cm"> * @Description</span>
<span class="cm"> * @create 2020-05-16 1:47</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">BookDao2</span> <span class="kd">extends</span> <span class="n">JpaRepository</span><span class="o">&lt;</span><span class="n">Book</span><span class="p">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="p">{</span>
<span class="p">}</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="nd">@SpringBootTest</span>
<span class="kd">class</span> <span class="nc">Jpa2ApplicationTests</span> <span class="p">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">BookDao1</span> <span class="n">bookDao1</span><span class="p">;</span>
    <span class="nd">@Autowired</span>
    <span class="n">BookDao2</span> <span class="n">bookDao2</span><span class="p">;</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Book</span><span class="o">&gt;</span> <span class="n">dao1All</span> <span class="o">=</span> <span class="n">bookDao1</span><span class="p">.</span><span class="na">findAll</span><span class="p">();</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">dao1All</span><span class="p">);</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;-------------&quot;</span><span class="p">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Book</span><span class="o">&gt;</span> <span class="n">dao2All</span> <span class="o">=</span> <span class="n">bookDao2</span><span class="p">.</span><span class="na">findAll</span><span class="p">();</span>
        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">dao2All</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>测试：</p>

<pre><code>[Book(id=1, name=11, author=11), Book(id=2, name=22, author=22), Book(id=6, name=33, author=33), Book(id=7, name=44, author=44), Book(id=8, name=1, author=1), Book(id=9, name=JAVA, author=Xuxx), Book(id=10, name=JAVA1, author=Xuxx), Book(id=11, name=JAVA2, author=Xuxx)]
-------------
[Book(id=1, name=11, author=11), Book(id=2, name=22, author=22), Book(id=6, name=33, author=33), Book(id=7, name=44, author=44), Book(id=8, name=1, author=1), Book(id=9, name=JAVA, author=Xuxx), Book(id=10, name=JAVA1, author=Xuxx), Book(id=11, name=JAVA2, author=Xuxx)]</code></pre>
<h3>4.Repository接口</h3>
<p>来看 Repository 的一个继承关系图：
   <figure class="pswp-item" style="flex: 80.15759312320917" data-width="1119" data-height="698"><img src="https://cdn.jsdelivr.net/gh/qq1820582487/Xuxx_Blogs@gh-pages/archives/assets/6079a0043be0c5085838df77633e5a68.png" alt="img" /><figcaption>img</figcaption></figure>
可以看到，实现类不少。那么到底如何理解 Repository 呢？</p>
<ol>
<li>Repository 接口是 Spring Data 的一个核心接口，它不提供任何方法，开发者需要在自己定义的接口中声明需要的方法 <code>public interface Repository&lt;T, ID extends Serializable&gt; { }</code></li>
<li>若我们定义的接口继承了 Repository, 则该接口会被 IOC 容器识别为一个 Repository Bean，进而纳入到 IOC 容器中，进而可以在该接口中定义满足一定规范的方法。</li>
<li>Spring Data可以让我们只定义接口，只要遵循 Spring Data 的规范，就无需写实现类。</li>
<li>与继承 Repository 等价的一种方式，就是在持久层接口上使用 @RepositoryDefinition 注解，并为其指定 domainClass 和 idClass 属性。像下面这样：</li>
</ol>

<pre><code>@RepositoryDefinition(domainClass = User.class, idClass = Long.class)public interface UserDao{    User findById(Long id);    List&lt;User&gt; findAll();}</code></pre>
<p>基础的 Repository 提供了最基本的数据访问功能，其几个子接口则扩展了一些功能，它的几个常用的实现类如下：</p>
<ul>
<li>CrudRepository： 继承 Repository，实现了一组 CRUD 相关的方法</li>
<li>PagingAndSortingRepository： 继承 CrudRepository，实现了一组分页排序相关的方法</li>
<li>JpaRepository： 继承 PagingAndSortingRepository，实现一组 JPA 规范相关的方法</li>
<li>自定义的 XxxxRepository 需要继承 JpaRepository，这样的 XxxxRepository 接口就具备了通用的数据访问控制层的能力。</li>
<li>JpaSpecificationExecutor：不属于Repository体系，实现一组 JPA Criteria 查询相关的方法</li>
</ul>

            </div>
        </article>
        <div id="ga-tags">
    
    <span class="ga-tag">
        <a class="ga-highlight" href="/Xuxx_Blogs/tag/Java/">#Java</a>
    </span>
    
    <span class="ga-tag">
        <a class="ga-highlight" href="/Xuxx_Blogs/tag/Spring Boot/">#Spring Boot</a>
    </span>
    
    <span class="ga-tag">
        <a class="ga-highlight" href="/Xuxx_Blogs/tag/JPA/">#JPA</a>
    </span>
    
</div>
    </section>

    
<section id="ga-content_pager">

    <div class="next">
        <a class="ga-highlight" href="/Xuxx_Blogs/archives/bj20/">Spring Boot构建REST服务</a>
        <p class="yue">笔记</p>
    </div>


    <div class="prev">
        <a class="ga-highlight" href="/Xuxx_Blogs/archives/bj17/">Spring Boot整合Mybatis</a>
        <p class="yue">笔记</p>
    </div>

</section>


    

</main>

                <footer class="ga-mono" id="ga-footer">
                    <section>
                        <span id="ga-uptime"></span>
                        <span class="brand">Xuxx的个人博客。</span>
                    </section>
                    <section>
                        <p class="copyright">
                            <span>Copyright © 2021 Xuxx</span>
                            <span>Powered by <a no-style href="https://github.com/AlanDecode/Maverick" target="_blank">Maverick & Galileo</a></span>
                        </p>
                        <div class="copyright">
                            <span class="footer-addon">
                                
                            </span>
                            <nav class="social-links">
                                <ul><li><a class="no-style" title="Twitter" href="https://twitter.com/xuxx3309" target="_blank"><i class="gi gi-twitter"></i>Twitter</a></li><span class="separator">·</span><li><a class="no-style" title="GitHub" href="https://github.com/QQ1820582487" target="_blank"><i class="gi gi-github"></i>GitHub</a></li></ul>
                            </nav>
                        </div>
                    </section>
                    <script>
                        var site_build_date = "2019-12-26T02:30+08:00"
                    </script>
                    <script src="https://cdn.jsdelivr.net/gh/qq1820582487/Xuxx_Blogs@gh-pages/assets/galileo-d8a0a06eff.js"></script>
                </footer>
            </div>
        </div>
    </div>
        
        
        <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="pswp__bg"></div>
        <div class="pswp__scroll-wrap">
            <div class="pswp__container">
                <div class="pswp__item"></div>
                <div class="pswp__item"></div>
                <div class="pswp__item"></div>
            </div>
            <div class="pswp__ui pswp__ui--hidden">
                <div class="pswp__top-bar">
                    <div class="pswp__counter"></div>
                    <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                    <button class="pswp__button pswp__button--share" title="Share"></button>
                    <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                    <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                    <div class="pswp__preloader">
                        <div class="pswp__preloader__icn">
                          <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                          </div>
                        </div>
                    </div>
                </div>
                <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                    <div class="pswp__share-tooltip"></div> 
                </div>
                <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
                </button>
                <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
                </button>
                <div class="pswp__caption">
                    <div class="pswp__caption__center"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/gh/qq1820582487/Xuxx_Blogs@gh-pages/assets/ExSearch/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/qq1820582487/Xuxx_Blogs@gh-pages/assets/ExSearch/ExSearch-493cb9cd89.js"></script>
    
    <!--katex-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/qq1820582487/Xuxx_Blogs@gh-pages/assets/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/gh/qq1820582487/Xuxx_Blogs@gh-pages/assets/katex.min.js"></script>
    <script>
    mathOpts = {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "\\[", right: "\\]", display: true},
            {left: "$", right: "$", display: false},
            {left: "\\(", right: "\\)", display: false}
        ]
    };
    </script>
    <script defer src="https://cdn.jsdelivr.net/gh/qq1820582487/Xuxx_Blogs@gh-pages/assets/auto-render.min.js" onload="renderMathInElement(document.body, mathOpts);"></script>

    
    </body>
</html>