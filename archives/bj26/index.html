<!DOCTYPE HTML>
<html lang="zh-CN">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta name="HandheldFriendly" content="true">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Xuxx,Galileo,blog" />
    <meta name="generator" content="Maverick 1.0" />
    <meta name="template" content="Galileo" />
    <link rel="alternate" type="application/rss+xml" title="Xuxx的个人博客。 &raquo; RSS 2.0" href="/Xuxx_Blogs/feed/index.xml" />
    <link rel="alternate" type="application/atom+xml" title="Xuxx的个人博客。 &raquo; ATOM 1.0" href="/Xuxx_Blogs/feed/atom/index.xml" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/qq1820582487/Xuxx_Blogs@gh-pages/assets/galileo-ec40839efa.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/qq1820582487/Xuxx_Blogs@gh-pages/assets/ExSearch/ExSearch-182e5a8868.css">
    <link href="https://fonts.googleapis.com/css?family=Fira+Code&display=swap" rel="stylesheet">
    <script>
        var ExSearchConfig = {
            root: "",
            api: "https://cdn.jsdelivr.net/gh/qq1820582487/Xuxx_Blogs@gh-pages/1ab9c70cd7326b8f45a62d7ce1587869.json"
        }
    </script>
    
<title>Spring Boot应用监控 - Xuxx的个人博客。</title>
<meta name="author" content="Xuxx" />
<meta name="description" content="笔记" />
<meta property="og:title" content="Spring Boot应用监控 - Xuxx的个人博客。" />
<meta property="og:description" content="笔记" />
<meta property="og:site_name" content="Xuxx的个人博客。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/Xuxx_Blogs/archives/bj26/" />
<meta property="og:image" content="" />
<meta property="article:published_time" content="2020-06-05T00:50:00-00.00" />
<meta name="twitter:title" content="Spring Boot应用监控 - Xuxx的个人博客。" />
<meta name="twitter:description" content="笔记" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="" />


    
<meta http-equiv="x-dns-prefetch-control" content="on">
<link rel="dns-prefetch" href="//cdn.jsdelivr.net" />

    </head>
    
    <body>
        
        <div class="container">
            <header id="ga-header">
                <div first>
                    <aside id="ga-logo">
                        <a href="/Xuxx_Blogs/" target="_self">
                            <img src="https://cdn.jsdelivr.net/gh/qq1820582487/Xuxx_Blogs@gh-pages/logo.png" alt="Xuxx的个人博客。">
                        </a>
                    </aside>
                    <aside id="ga-brand">
                        <h1 class="brand"><a class="no-style" href="/Xuxx_Blogs/">Xuxx的个人博客。</a></h1>
                        <p>坚持有效行动，改变自然发生——致自己。</p>
                    </aside>
                </div>
                <div second id="ga-nav">
                    <nav class="navs">
                        <ul><li><a class="ga-highlight" href="/Xuxx_Blogs/" target="_self">首页</a></li><span class="separator">·</span><li><a class="ga-highlight" href="/Xuxx_Blogs/archives/" target="_self">归档</a></li><span class="separator">·</span><li><a class="ga-highlight" href="/Xuxx_Blogs/about/" target="_self">关于</a></li><span class="separator">·</span><li><a href="#" target="_self" class="search-form-input ga-highlight">搜索</a></li></ul>
                    </nav>
                    <nav class="social-links">
                        <ul><li><a class="no-style" title="Twitter" href="https://twitter.com/xuxx3309" target="_blank"><i class="gi gi-twitter"></i>Twitter</a></li><span class="separator">·</span><li><a class="no-style" title="GitHub" href="https://github.com/QQ1820582487" target="_blank"><i class="gi gi-github"></i>GitHub</a></li></ul>
                    </nav>
                </div>
            </header>
            <div class="wrapper">
                
<main>    
    <section class="ga-section ga-content">
        <article class="yue">
            <h1 class="ga-post_title">Spring Boot应用监控</h1>
            <span class="ga-post_meta ga-mono">
                <span>Xuxx</span>
                <time>
                    2020-06-05
                </time>
                
                in <a no-style class="category" href="/Xuxx_Blogs/category/笔记/">
                    笔记
                </a>
                
                
            </span>
            <div class="ga-content_body">
                <h2>1.Actuator入门</h2>
<p><a href="https://docs.spring.io/spring-boot/docs/2.3.0.RELEASE/reference/html/production-ready-features.html#production-ready-endpoints">官方文档</a></p>
<p>Actuator是Spring Boot提供的一个服务，可以通过暴露端点路由，用来输出应用中的诸多端点信息。</p>
<p>每个单独的端点都可以<a href="https://docs.spring.io/spring-boot/docs/2.3.0.RELEASE/reference/html/production-ready-features.html#production-ready-endpoints-exposing-endpoints">通过HTTP或JMX </a><a href="https://docs.spring.io/spring-boot/docs/2.3.0.RELEASE/reference/html/production-ready-features.html#production-ready-endpoints-enabling-endpoints">启用或禁用</a>和<a href="https://docs.spring.io/spring-boot/docs/2.3.0.RELEASE/reference/html/production-ready-features.html#production-ready-endpoints-exposing-endpoints">公开（可远程访问）</a>。启用和公开端点均被视为可用。内置端点只有在可用时才会被自动配置。大多数应用程序选择通过HTTP公开，其中端点的ID和前缀<code>/actuator</code>映射到URL。例如，默认情况下，<code>health</code>端点映射到<code>/actuator/health</code>。</p>
<p>依赖如下</p>
<div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-actuator<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
<p>启动Spring Boot应用程序之后，只要在浏览器中输入端点信息就能获得应用的一些状态信息。</p>
<table>
<thead><tr>
<th style="text-align:left">ID</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>auditevents</code></td>
<td style="text-align:left">公开当前应用程序的审核事件信息。需要一个<code>AuditEventRepository</code>Bean。</td>
</tr>
<tr>
<td style="text-align:left"><code>beans</code></td>
<td style="text-align:left">显示应用程序中所有Spring Bean的完整列表。</td>
</tr>
<tr>
<td style="text-align:left"><code>caches</code></td>
<td style="text-align:left">公开可用的缓存。</td>
</tr>
<tr>
<td style="text-align:left"><code>conditions</code></td>
<td style="text-align:left">显示在配置和自动配置类上评估的条件以及它们匹配或不匹配的原因。</td>
</tr>
<tr>
<td style="text-align:left"><code>configprops</code></td>
<td style="text-align:left">显示所有的整理列表<code>@ConfigurationProperties</code>。</td>
</tr>
<tr>
<td style="text-align:left"><code>env</code></td>
<td style="text-align:left">公开Spring的属性<code>ConfigurableEnvironment</code>。</td>
</tr>
<tr>
<td style="text-align:left"><code>flyway</code></td>
<td style="text-align:left">显示已应用的所有Flyway数据库迁移。需要一个或多个<code>Flyway</code>Bean。</td>
</tr>
<tr>
<td style="text-align:left"><code>health</code></td>
<td style="text-align:left">显示应用程序运行状况信息。</td>
</tr>
<tr>
<td style="text-align:left"><code>httptrace</code></td>
<td style="text-align:left">显示HTTP跟踪信息（默认情况下，最近100个HTTP请求-响应交换）。需要一个<code>HttpTraceRepository</code>Bean。</td>
</tr>
<tr>
<td style="text-align:left"><code>info</code></td>
<td style="text-align:left">显示任意应用程序信息。</td>
</tr>
<tr>
<td style="text-align:left"><code>integrationgraph</code></td>
<td style="text-align:left">显示Spring Integration图。需要对的依赖<code>spring-integration-core</code>。</td>
</tr>
<tr>
<td style="text-align:left"><code>loggers</code></td>
<td style="text-align:left">显示和修改应用程序中记录器的配置。</td>
</tr>
<tr>
<td style="text-align:left"><code>liquibase</code></td>
<td style="text-align:left">显示已应用的所有Liquibase数据库迁移。需要一个或多个<code>Liquibase</code>Bean。</td>
</tr>
<tr>
<td style="text-align:left"><code>metrics</code></td>
<td style="text-align:left">显示当前应用程序的“指标”信息。</td>
</tr>
<tr>
<td style="text-align:left"><code>mappings</code></td>
<td style="text-align:left">显示所有<code>@RequestMapping</code>路径的整理列表。</td>
</tr>
<tr>
<td style="text-align:left"><code>scheduledtasks</code></td>
<td style="text-align:left">显示应用程序中的计划任务。</td>
</tr>
<tr>
<td style="text-align:left"><code>sessions</code></td>
<td style="text-align:left">允许从Spring Session支持的会话存储中检索和删除用户会话。需要使用Spring Session的基于Servlet的Web应用程序。</td>
</tr>
<tr>
<td style="text-align:left"><code>shutdown</code></td>
<td style="text-align:left">使应用程序正常关闭。<strong>默认禁用。</strong></td>
</tr>
<tr>
<td style="text-align:left"><code>threaddump</code></td>
<td style="text-align:left">执行线程转储。</td>
</tr>
</tbody>
</table>
<p>如果您的应用程序是Web应用程序（Spring MVC，Spring WebFlux或Jersey），则可以使用以下附加端点：</p>
<table>
<thead><tr>
<th style="text-align:left">ID</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>heapdump</code></td>
<td style="text-align:left">返回<code>hprof</code>堆转储文件。</td>
</tr>
<tr>
<td style="text-align:left"><code>jolokia</code></td>
<td style="text-align:left">通过HTTP公开JMX bean（当Jolokia在类路径上时，不适用于WebFlux）。需要对的依赖<code>jolokia-core</code>。</td>
</tr>
<tr>
<td style="text-align:left"><code>logfile</code></td>
<td style="text-align:left">返回日志文件的内容（如果已设置<code>logging.file.name</code>或<code>logging.file.path</code>属性）。支持使用HTTP <code>Range</code>标头来检索部分日志文件的内容。</td>
</tr>
<tr>
<td style="text-align:left"><code>prometheus</code></td>
<td style="text-align:left">以Prometheus服务器可以抓取的格式公开指标。需要对的依赖<code>micrometer-registry-prometheus</code>。</td>
</tr>
</tbody>
</table>
<p>常用端点列举如下，可以一个个详细试一下：</p>
<ul>
<li>/info           　　　　　   应用基本信息</li>
<li>/health       　　　　　   健康度信息</li>
<li>/metrics     　　　　　   运行指标</li>
<li>/env           　　　　　   环境变量信息</li>
<li>/loggers    　　　　　    日志相关</li>
<li>/dump       　　　　　　线程相关信息</li>
<li>/trace      　　　　　　   请求调用轨迹</li>
</ul>
<h3>1.1.启用端点</h3>
<p>默认情况下，所有端点<code>shutdown</code>均处于启用状态。要配置端点的启用，请使用其<code>management.endpoint.&lt;id&gt;.enabled</code>属性。以下示例启用<code>shutdown</code>端点：</p>
<div class="highlight"><pre><span></span><span class="na">management.endpoint.shutdown.enabled</span><span class="o">=</span><span class="s">true</span>
</pre></div>
<p>如果您希望启用端点启用而不是退出启用，请将该<code>management.endpoints.enabled-by-default</code>属性设置为，<code>false</code>并使用各个端点<code>enabled</code>属性重新启用。以下示例启用该<code>info</code>端点并禁用所有其他端点：</p>
<div class="highlight"><pre><span></span><span class="na">management.endpoints.enabled-by-default</span><span class="o">=</span><span class="s">false</span>
<span class="na">management.endpoint.info.enabled</span><span class="o">=</span><span class="s">true</span>
</pre></div>
<p>默认只有<code>shutdown</code>端点是禁用的，但是默认情况下也只能使用<code>/health</code>和<code>/info</code>端点，因为端口不仅要开启，还需要暴露。</p>
<h3>1.2.暴露端点</h3>
<p>由于端点可能包含敏感信息，因此应谨慎考虑何时公开它们。下表显示了内置端点的默认暴露：</p>
<table>
<thead><tr>
<th style="text-align:left">ID</th>
<th style="text-align:left">JMX</th>
<th style="text-align:left">网页</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>auditevents</code></td>
<td style="text-align:left">是</td>
<td style="text-align:left">没有</td>
</tr>
<tr>
<td style="text-align:left"><code>beans</code></td>
<td style="text-align:left">是</td>
<td style="text-align:left">没有</td>
</tr>
<tr>
<td style="text-align:left"><code>caches</code></td>
<td style="text-align:left">是</td>
<td style="text-align:left">没有</td>
</tr>
<tr>
<td style="text-align:left"><code>conditions</code></td>
<td style="text-align:left">是</td>
<td style="text-align:left">没有</td>
</tr>
<tr>
<td style="text-align:left"><code>configprops</code></td>
<td style="text-align:left">是</td>
<td style="text-align:left">没有</td>
</tr>
<tr>
<td style="text-align:left"><code>env</code></td>
<td style="text-align:left">是</td>
<td style="text-align:left">没有</td>
</tr>
<tr>
<td style="text-align:left"><code>flyway</code></td>
<td style="text-align:left">是</td>
<td style="text-align:left">没有</td>
</tr>
<tr>
<td style="text-align:left"><code>health</code></td>
<td style="text-align:left">是</td>
<td style="text-align:left">是</td>
</tr>
<tr>
<td style="text-align:left"><code>heapdump</code></td>
<td style="text-align:left">不适用</td>
<td style="text-align:left">没有</td>
</tr>
<tr>
<td style="text-align:left"><code>httptrace</code></td>
<td style="text-align:left">是</td>
<td style="text-align:left">没有</td>
</tr>
<tr>
<td style="text-align:left"><code>info</code></td>
<td style="text-align:left">是</td>
<td style="text-align:left">是</td>
</tr>
<tr>
<td style="text-align:left"><code>integrationgraph</code></td>
<td style="text-align:left">是</td>
<td style="text-align:left">没有</td>
</tr>
<tr>
<td style="text-align:left"><code>jolokia</code></td>
<td style="text-align:left">不适用</td>
<td style="text-align:left">没有</td>
</tr>
<tr>
<td style="text-align:left"><code>logfile</code></td>
<td style="text-align:left">不适用</td>
<td style="text-align:left">没有</td>
</tr>
<tr>
<td style="text-align:left"><code>loggers</code></td>
<td style="text-align:left">是</td>
<td style="text-align:left">没有</td>
</tr>
<tr>
<td style="text-align:left"><code>liquibase</code></td>
<td style="text-align:left">是</td>
<td style="text-align:left">没有</td>
</tr>
<tr>
<td style="text-align:left"><code>metrics</code></td>
<td style="text-align:left">是</td>
<td style="text-align:left">没有</td>
</tr>
<tr>
<td style="text-align:left"><code>mappings</code></td>
<td style="text-align:left">是</td>
<td style="text-align:left">没有</td>
</tr>
<tr>
<td style="text-align:left"><code>prometheus</code></td>
<td style="text-align:left">不适用</td>
<td style="text-align:left">没有</td>
</tr>
<tr>
<td style="text-align:left"><code>scheduledtasks</code></td>
<td style="text-align:left">是</td>
<td style="text-align:left">没有</td>
</tr>
<tr>
<td style="text-align:left"><code>sessions</code></td>
<td style="text-align:left">是</td>
<td style="text-align:left">没有</td>
</tr>
<tr>
<td style="text-align:left"><code>shutdown</code></td>
<td style="text-align:left">是</td>
<td style="text-align:left">没有</td>
</tr>
<tr>
<td style="text-align:left"><code>threaddump</code></td>
<td style="text-align:left">是</td>
<td style="text-align:left">没有</td>
</tr>
</tbody>
</table>
<p>下表是默认的端点暴露情况:</p>
<table>
<thead><tr>
<th style="text-align:left">属性</th>
<th style="text-align:left">默认</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>management.endpoints.jmx.exposure.exclude</code></td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left"><code>management.endpoints.jmx.exposure.include</code></td>
<td style="text-align:left"><code>*</code></td>
</tr>
<tr>
<td style="text-align:left"><code>management.endpoints.web.exposure.exclude</code></td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left"><code>management.endpoints.web.exposure.include</code></td>
<td style="text-align:left"><code>info, health</code></td>
</tr>
</tbody>
</table>
<p>例如，要通过HTTP暴露除<code>env</code>和<code>beans</code>端点之外的所有内容，使用以下配置：</p>
<div class="highlight"><pre><span></span><span class="na">management.endpoints.web.exposure.include</span><span class="o">=</span><span class="s">*</span>
<span class="na">management.endpoints.web.exposure.exclude</span><span class="o">=</span><span class="s">env,beans</span>
</pre></div>
<p>注意：在YAML中有特殊含义，因此，如果要包括（或排除）所有端点，请确保添加引号，如以下示例所示：</p>

<pre><code>management:
  endpoints:
    web:
      exposure:
        include: "*"</code></pre>
<h3>1.3.保护HTTP端点</h3>
<p>应该像对待其他任何敏感URL一样，小心保护HTTP端点的安全。如果存在Spring Security，则默认情况下使用Spring Security的内容协商策略来保护端点安全。例如，如果希望为HTTP端点配置自定义安全性，只允许具有特定角色的用户访问它们，Spring Boot提供了一些方便的<code>RequestMatcher</code>对象，这些对象可以与Spring Security结合使用。</p>
<p>引入Spring Security</p>
<div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-security<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
<p>添加配置</p>
<div class="highlight"><pre><span></span><span class="na">spring.security.user.name</span><span class="o">=</span><span class="s">xuxx</span>
<span class="na">spring.security.user.password</span><span class="o">=</span><span class="s">123</span>
<span class="na">spring.security.user.roles</span><span class="o">=</span><span class="s">ENDPOINT_ADMIN</span>
</pre></div>
<p>典型的Spring Security配置可能类似于以下示例：</p>
<div class="highlight"><pre><span></span><span class="nd">@Configuration</span><span class="p">(</span><span class="n">proxyBeanMethods</span> <span class="o">=</span> <span class="kc">false</span><span class="p">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ActuatorSecurity</span> <span class="kd">extends</span> <span class="n">WebSecurityConfigurerAdapter</span> <span class="p">{</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">configure</span><span class="p">(</span><span class="n">HttpSecurity</span> <span class="n">http</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
        <span class="n">http</span><span class="p">.</span><span class="na">requestMatcher</span><span class="p">(</span><span class="n">EndpointRequest</span><span class="p">.</span><span class="na">toAnyEndpoint</span><span class="p">())</span>
                <span class="p">.</span><span class="na">authorizeRequests</span><span class="p">()</span>
                <span class="p">.</span><span class="na">anyRequest</span><span class="p">()</span>
                <span class="p">.</span><span class="na">hasRole</span><span class="p">(</span><span class="s">&quot;ENDPOINT_ADMIN&quot;</span><span class="p">)</span>
                <span class="p">.</span><span class="na">and</span><span class="p">()</span>
                <span class="p">.</span><span class="na">httpBasic</span><span class="p">();</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
<h3>1.4.CORS支持</h3>
<p>默认情况下，CORS支持是禁用的，并且仅<code>management.endpoints.web.cors.allowed-origins</code>在设置属性后才启用。以下配置允许<code>GET</code>和<code>POST</code>从<code>example.com</code>域调用：</p>
<div class="highlight"><pre><span></span><span class="na">management.endpoints.web.cors.allowed-origins</span><span class="o">=</span><span class="s">https://xuxx.com</span>
<span class="na">management.endpoints.web.cors.allowed-methods</span><span class="o">=</span><span class="s">GET,POST</span>
</pre></div>
<h2>2.通过HTTP进行监视和管理</h2>
<h3>2.1.自定义管理端点路径</h3>
<p>有时，自定义管理端点的前缀很有用。例如，<code>/actuator</code>已经用于其他用途。可以使用该<code>management.endpoints.web.base-path</code>属性来更改管理端点的前缀，如以下示例所示：</p>
<div class="highlight"><pre><span></span><span class="na">management.endpoints.web.base-path</span><span class="o">=</span><span class="s">/manage</span>
</pre></div>
<p>设置完重启后，再次访问地址就会变成<code>/manage/*</code></p>
<p>如果要将端点映射到其他路径，则可以使用该<code>management.endpoints.web.path-mapping</code>属性。</p>
<p>以下示例重新映射<code>/actuator/health</code>到<code>/healthcheck</code>：</p>
<p>application.properties</p>
<div class="highlight"><pre><span></span><span class="na">management.endpoints.web.base-path</span><span class="o">=</span><span class="s">/</span>
<span class="na">management.endpoints.web.path-mapping.health</span><span class="o">=</span><span class="s">healthcheck</span>
</pre></div>
<h3>2.2禁用HTTP端点</h3>
<p>如果不想通过HTTP公开端点，则可以将管理端口设置为<code>-1</code>，如以下示例所示：</p>
<div class="highlight"><pre><span></span><span class="na">management.server.port</span><span class="o">=</span><span class="s">-1</span>
</pre></div>
<p>也可以使用该<code>management.endpoints.web.exposure.exclude</code>属性来实现，如以下示例所示：</p>
<div class="highlight"><pre><span></span><span class="na">management.endpoints.web.exposure.exclude</span><span class="o">=</span><span class="s">*</span>
</pre></div>
<h3>2.3.自定义管理服务器端口和地址</h3>
<p>对于基于云的部署，使用默认的HTTP端口公开管理端点是明智的选择。但是，如果应用程序在自己的数据中心内运行，则可能更倾向于使用其他HTTP端口公开端点。</p>
<p>如以下示例所示：</p>
<div class="highlight"><pre><span></span><span class="na">management.server.port</span><span class="o">=</span><span class="s">8081</span>
<span class="na">management.server.address</span><span class="o">=</span><span class="s">127.0.0.1</span>
</pre></div>
<h2>3.常用端点</h2>
<h3>3.1.health端点</h3>
<p>health 主要用来检查应用的运行状态，这是我们使用最高频的一个监控点。通常使用此接口提醒我们应用实例的运行状态，以及应用不”健康“的原因，比如数据库连接、磁盘空间不够等。</p>
<p>默认情况下 health 的状态是开放的，添加依赖后启动项目，访问：<code>http://localhost:8080/actuator/health</code>即可看到应用的状态。</p>
<div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;status&quot;</span> <span class="p">:</span> <span class="s2">&quot;UP&quot;</span>
<span class="p">}</span>
</pre></div>
<p>默认情况下，最终的 Spring Boot 应用的状态是由 HealthAggregator(健康聚合器) 汇总而成的，汇总的算法是：</p>
<ul>
<li>1 设置状态码顺序：<code>setStatusOrder(Status.DOWN, Status.OUT_OF_SERVICE, Status.UP, Status.UNKNOWN);</code>。</li>
<li>2 过滤掉不能识别的状态码。</li>
<li>3 如果无任何状态码，整个 Spring Boot 应用的状态是 UNKNOWN。</li>
<li>4 将所有收集到的状态码按照 1 中的顺序排序。</li>
<li>5 返回有序状态码序列中的第一个状态码，作为整个 Spring Boot 应用的状态。</li>
</ul>
<p>health 通过合并几个健康指数检查应用的健康情况。Spring Boot Actuator 有几个预定义的健康指标比如<code>DataSourceHealthIndicator</code>, <code>DiskSpaceHealthIndicator</code>, <code>MongoHealthIndicator</code>, <code>RedisHealthIndicator</code>等，它使用这些健康指标作为健康检查的一部分。</p>
<p>举个例子，如果你的应用使用了Redis，<code>RedisHealthindicator</code> 将被当作检查的一部分；如果使用了MongoDB，那么<code>MongoHealthIndicator</code> 将被当作检查的一部分。</p>
<p>可以在配置文件中关闭特定的健康检查指标，比如关闭 redis 的健康检查：</p>
<div class="highlight"><pre><span></span><span class="na">management.health.redise.enabled</span><span class="o">=</span><span class="s">false</span>
</pre></div>
<p>默认情况下，所有的这些健康指标都被当作健康检查的一部分。</p>
<h3>3.2.info端点</h3>
<h4>1.自定义信息</h4>
<p>info 就是我们自己配置在配置文件中以 info 开头的配置信息（也可以使用java代码配置，懒得写），例如：</p>
<div class="highlight"><pre><span></span><span class="na">info.app.encoding</span><span class="o">=</span><span class="s">@project.build.sourceEncoding@</span>
<span class="na">info.app.java.source</span><span class="o">=</span><span class="s">@java.version@</span>
<span class="na">info.author.name</span><span class="o">=</span><span class="s">xuxx</span>
<span class="na">info.author.phone</span><span class="o">=</span><span class="s">10086</span>
</pre></div>
<p>启动项目，访问：<code>http://localhost:8080/actuator/info</code>返回信息如下：</p>
<div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;author&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;phone&quot;</span><span class="p">:</span> <span class="s2">&quot;10086&quot;</span><span class="p">,</span>
    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;xuxx&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;app&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;encoding&quot;</span><span class="p">:</span> <span class="s2">&quot;UTF-8&quot;</span><span class="p">,</span>
    <span class="nt">&quot;java&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;1.8.0_221&quot;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<h4>2.git信息</h4>
<p>引入插件，该插件用来产生git的版本信息</p>
<div class="highlight"><pre><span></span><span class="nt">&lt;plugin&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>pl.project13.maven<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>git-commit-id-plugin<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/plugin&gt;</span>
</pre></div>
<p>执行插件（未使用git的话会报错：缺少.git文件）</p>
<p><figure class="pswp-item" style="flex: 64.38631790744466" data-width="640" data-height="497"><img src="https://cdn.jsdelivr.net/gh/qq1820582487/Xuxx_Blogs@gh-pages/archives/assets/ca23c95e598825cd7529008201dc67e5.png" alt="" /></figure></p>
<p>执行完成后，在<code>target/classes</code>目录下，产生了一个<code>git.properties</code>配置信息：</p>
<p><figure class="pswp-item"  data-width="-1" data-height="-1" size-undefined><img src="D:\UserData\Desktop\杂物\Xuxx_Blogs\src\static\笔记图片\2020-06-05-Spring Boot应用监控_02.png" alt="" /></figure></p>
<p>这个文件就是当前项目的git信息，它的内容如下：</p>
<div class="highlight"><pre><span></span><span class="c">#Generated by Git-Commit-Id-Plugin</span>
<span class="c">#Fri Jun 05 04:07:54 CST 2020</span>
<span class="na">git.branch</span><span class="o">=</span><span class="s">master</span>
<span class="na">git.build.host</span><span class="o">=</span><span class="s">Xuxx3309</span>
<span class="na">git.build.time</span><span class="o">=</span><span class="s">2020-06-05T04\:07\:54+0800</span>
<span class="na">git.build.user.email</span><span class="o">=</span><span class="s">1820502487@qq.com</span>
<span class="na">git.build.user.name</span><span class="o">=</span><span class="s">Xuxx</span>
<span class="na">git.build.version</span><span class="o">=</span><span class="s">0.0.1-SNAPSHOT</span>
<span class="na">git.closest.tag.commit.count</span><span class="o">=</span>
<span class="na">git.closest.tag.name</span><span class="o">=</span>
<span class="na">git.commit.id</span><span class="o">=</span><span class="s">35f45d9378511195e5ce3501278c5efa315a5070</span>
<span class="na">git.commit.id.abbrev</span><span class="o">=</span><span class="s">35f45d9</span>
<span class="na">git.commit.id.describe</span><span class="o">=</span><span class="s">35f45d9</span>
<span class="na">git.commit.id.describe-short</span><span class="o">=</span><span class="s">35f45d9</span>
<span class="na">git.commit.message.full</span><span class="o">=</span><span class="s">初始化</span>
<span class="na">git.commit.message.short</span><span class="o">=</span><span class="s">初始化</span>
<span class="na">git.commit.time</span><span class="o">=</span><span class="s">2020-06-05T04\:07\:48+0800</span>
<span class="na">git.commit.user.email</span><span class="o">=</span><span class="s">1820502487@qq.com</span>
<span class="na">git.commit.user.name</span><span class="o">=</span><span class="s">Xuxx</span>
<span class="na">git.dirty</span><span class="o">=</span><span class="s">false</span>
<span class="na">git.local.branch.ahead</span><span class="o">=</span><span class="s">NO_REMOTE</span>
<span class="na">git.local.branch.behind</span><span class="o">=</span><span class="s">NO_REMOTE</span>
<span class="na">git.remote.origin.url</span><span class="o">=</span><span class="s">Unknown</span>
<span class="na">git.tags</span><span class="o">=</span>
<span class="na">git.total.commit.count</span><span class="o">=</span><span class="s">1</span>
</pre></div>
<p>启动测试(没有配置git信息的展示策略)，访问：<code>http://localhost:8080/actuator/info</code>返回信息如下：</p>
<div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;author&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;phone&quot;</span><span class="p">:</span> <span class="s2">&quot;10086&quot;</span><span class="p">,</span>
    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;xuxx&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;app&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;encoding&quot;</span><span class="p">:</span> <span class="s2">&quot;UTF-8&quot;</span><span class="p">,</span>
    <span class="nt">&quot;java&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;1.8.0_221&quot;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nt">&quot;git&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;commit&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;2020-06-04T20:07:48Z&quot;</span><span class="p">,</span>
      <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;35f45d9&quot;</span>
    <span class="p">},</span>
    <span class="nt">&quot;branch&quot;</span><span class="p">:</span> <span class="s2">&quot;master&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>其中包含了关于branch和commit的基础信息。而这个信息格式是最简模式，我们也可以配置一下git信息的展示策略，默认为simple</p>
<div class="highlight"><pre><span></span><span class="na">management.info.git.mode</span><span class="o">=</span><span class="s">full</span>
</pre></div>
<p>重启应用后再访问<code>/info</code>端点，可以获得更为详细的版本信息了。</p>
<h4>3.build信息</h4>
<p>和git信息类似，引入插件</p>
<div class="highlight"><pre><span></span><span class="nt">&lt;plugin&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>pl.project13.maven<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>git-commit-id-plugin<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/plugin&gt;</span>
</pre></div>
<p>执行插件:</p>
<p><figure class="pswp-item"  data-width="-1" data-height="-1" size-undefined><img src="D:\UserData\Desktop\杂物\Xuxx_Blogs\src\static\笔记图片\2020-06-05-Spring Boot应用监控_04.png" alt="" /></figure></p>
<p>执行完成后，在<code>target/classes</code>目录下，产生了一个<code>build-info.properties</code>配置信息：</p>
<p><figure class="pswp-item" style="flex: 74.32432432432432" data-width="385" data-height="259"><img src="https://cdn.jsdelivr.net/gh/qq1820582487/Xuxx_Blogs@gh-pages/archives/assets/08296937daa0cf918d81ae535036fef9.png" alt="" /></figure></p>
<p>这个文件就是当前项目的git信息，它的内容如下：</p>
<div class="highlight"><pre><span></span><span class="na">build.artifact</span><span class="o">=</span><span class="s">actuator</span>
<span class="na">build.group</span><span class="o">=</span><span class="s">com.xuxx</span>
<span class="na">build.name</span><span class="o">=</span><span class="s">actuator</span>
<span class="na">build.time</span><span class="o">=</span><span class="s">2020-06-04T20\:39\:03.874Z</span>
<span class="na">build.version</span><span class="o">=</span><span class="s">0.0.1-SNAPSHOT</span>
</pre></div>
<p>启动测试,访问：<code>http://localhost:8080/actuator/info</code>返回信息如下：</p>
<div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;author&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;phone&quot;</span><span class="p">:</span> <span class="s2">&quot;10086&quot;</span><span class="p">,</span>
    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;xuxx&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;app&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;encoding&quot;</span><span class="p">:</span> <span class="s2">&quot;UTF-8&quot;</span><span class="p">,</span>
    <span class="nt">&quot;java&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;1.8.0_221&quot;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nt">&quot;git&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;commit&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;2020-06-04T20:07:48Z&quot;</span><span class="p">,</span>
      <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;35f45d9&quot;</span>
    <span class="p">},</span>
    <span class="nt">&quot;branch&quot;</span><span class="p">:</span> <span class="s2">&quot;master&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;build&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;0.0.1-SNAPSHOT&quot;</span><span class="p">,</span>
    <span class="nt">&quot;artifact&quot;</span><span class="p">:</span> <span class="s2">&quot;actuator&quot;</span><span class="p">,</span>
    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;actuator&quot;</span><span class="p">,</span>
    <span class="nt">&quot;group&quot;</span><span class="p">:</span> <span class="s2">&quot;com.xuxx&quot;</span><span class="p">,</span>
    <span class="nt">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;2020-06-04T20:39:03.874Z&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<h2>4.Spring Boot Admin监控系统</h2>
<h3>1.什么是 Spring Boot Admin?</h3>
<p>Spring Boot Admin 是一个管理和监控 Spring Boot 应用程序的开源软件。每个应用都认为是一个客户端，通过 HTTP 或者使用 Eureka 注册到 admin server 中进行展示，Spring Boot Admin UI 部分使用 VueJs 将数据展示在前端。</p>
<h3>2.简单使用</h3>
<h4>2.1.Admin Server 端</h4>
<p>首先来创建一个Spring Boot Admin Server工程作为服务端</p>
<p>依赖：</p>
<div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>de.codecentric<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-boot-admin-starter-server<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
<p>然后在应用主类上通过加<code>@EnableAdminServer</code>注解来启用Spring Boot Admin。</p>
<div class="highlight"><pre><span></span><span class="nd">@EnableAdminServer</span>
<span class="nd">@SpringBootApplication</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AdminApplication</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">SpringApplication</span><span class="p">.</span><span class="na">run</span><span class="p">(</span><span class="n">AdminApplication</span><span class="p">.</span><span class="na">class</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
<p>启动程序，浏览器打开<code>localhost:8080</code>查看Spring Boot Admin主页面：</p>
<p><figure class="pswp-item" style="flex: 161.63575042158516" data-width="1917" data-height="593"><img src="https://cdn.jsdelivr.net/gh/qq1820582487/Xuxx_Blogs@gh-pages/archives/assets/9d6bb093e54cfac76367edc6405102c0.png" alt="" /></figure></p>
<p>此时Application一栏空空如也，等待待监控的应用加入</p>
<h4>2.2.Admin Clent 端</h4>
<p>创建要监控的Spring Boot应用</p>
<p>依赖：</p>
<div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-actuator<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>de.codecentric<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-boot-admin-starter-client<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
<p>简单配置</p>
<div class="highlight"><pre><span></span><span class="na">server.port</span><span class="o">=</span><span class="s">8081</span>
<span class="c">#配置actuator</span>
<span class="na">management.endpoints.web.exposure.include</span><span class="o">=</span><span class="s">*</span>
<span class="c">#配置admin，将应用注册到Admin服务端去</span>
<span class="na">spring.boot.admin.client.url</span><span class="o">=</span><span class="s">http://127.0.0.1:8080</span>
</pre></div>
<p>Clent 端一启动，Admin 服务 端立马推送来了消息，告诉你Admin Clent 端上线了：</p>
<p><figure class="pswp-item"  data-width="-1" data-height="-1" size-undefined><img src="D:\UserData\Desktop\杂物\Xuxx_Blogs\src\static\笔记图片\2020-06-05-Spring Boot应用监控_08.png" alt="" /></figure></p>
<p>此时再去查看Admin主界面</p>
<p><figure class="pswp-item"  data-width="-1" data-height="-1" size-undefined><img src="D:\UserData\Desktop\杂物\Xuxx_Blogs\src\static\笔记图片\2020-06-05-Spring Boot应用监控_09.png" alt="" /></figure></p>
<p>补充：如果我们使用的是单个 Spring Boot 应用，就需要在每一个被监控的应用中配置 Admin Server 的地址信息；如果应用都注册在 Eureka 中就不需要再对每个应用进行配置，Spring Boot Admin 会自动从注册中心抓取应用的相关信息。</p>
<h3>3. 通知</h3>
<h4>3.1邮件通知</h4>
<p>在 Spring Boot Admin 中 当注册的应用程序状态更改为DOWN、UNKNOWN、OFFLINE 都可以指定触发通知，下面讲解配置邮件通知。</p>
<p>在Admin Server 端，加上mail的依赖：</p>
<div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-mail<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
<p>收发邮件的配置：</p>
<div class="highlight"><pre><span></span><span class="na">spring.mail.host</span><span class="o">=</span><span class="s">smtp.qq.com</span>
<span class="na">spring.mail.port</span><span class="o">=</span><span class="s">465</span>
<span class="na">spring.mail.username</span><span class="o">=</span><span class="s">1820502487@qq.com</span>
<span class="c">#授权码</span>
<span class="na">spring.mail.password</span><span class="o">=</span><span class="s">zdbnotvgejxmbeji</span>
<span class="na">spring.mail.default-encoding</span><span class="o">=</span><span class="s">UTF-8</span>
<span class="c">#加密连接</span>
<span class="na">spring.mail.properties.mail.smtp.socketFactory.class</span><span class="o">=</span><span class="s">javax.net.ssl.SSLSocketFactory</span>
<span class="c">#日志</span>
<span class="na">spring.mail.properties.mail.debug</span><span class="o">=</span><span class="s">true</span>
<span class="c">#将邮件发送给谁</span>
<span class="na">spring.boot.admin.notify.mail.to</span><span class="o">=</span><span class="s">1913312971@qq.com</span>
<span class="c">#从哪儿发来的</span>
<span class="na">spring.boot.admin.notify.mail.from</span><span class="o">=</span><span class="s">1820502487@qq.com</span>
<span class="c">#忽略状态变化，留空就是每一个状态变化都不忽略</span>
<span class="na">spring.boot.admin.notify.mail.ignore-changes</span><span class="o">=</span>
</pre></div>
<p>重启Admin Server 端，之后若出现注册的<strong>客户端的状态从 UP 变为 OFFLINE 或其他状态，服务端就会自动将电子邮件发送到上面配置的收件地址。</strong></p>
<p><strong>注意 : 配置了邮件通知后，会出现 反复通知 service offline / up。这个问题的原因在于 查询应用程序的状态和信息超时，下面给出两种解决方案：</strong></p>
<p>(Admin Clent 端配置)</p>
<div class="highlight"><pre><span></span><span class="c">#方法一：配置超时时间（单位:ms）</span>

<span class="na">spring.boot.admin.monitor.read-timeout</span><span class="o">=</span><span class="s">20000</span>

<span class="c">#方法二：关闭未使用或不重要的检查点</span>

<span class="na">management.health.db.enabled</span><span class="o">=</span><span class="s">false</span>
<span class="na">management.health.mail.enabled</span><span class="o">=</span><span class="s">false</span>
<span class="na">management.health.redis.enabled</span><span class="o">=</span><span class="s">false</span>
<span class="na">management.health.mongo.enabled</span><span class="o">=</span><span class="s">false</span>
</pre></div>
<h4>3.2. 自定义通知</h4>
<p>可以通过添加实现Notifier接口的Spring Beans来添加您自己的通知程序，最好通过扩展 AbstractEventNotifier或AbstractStatusChangeNotifier。在Admin Server 端中编写一个自定义的通知器：</p>
<div class="highlight"><pre><span></span><span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomNotifier</span>  <span class="kd">extends</span> <span class="n">AbstractStatusChangeNotifier</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">LOGGER</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="p">.</span><span class="na">getLogger</span><span class="p">(</span> <span class="n">LoggingNotifier</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>

    <span class="kd">public</span> <span class="nf">CustomNotifier</span><span class="p">(</span><span class="n">InstanceRepository</span> <span class="n">repository</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">super</span><span class="p">(</span><span class="n">repository</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="n">Mono</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span> <span class="nf">doNotify</span><span class="p">(</span><span class="n">InstanceEvent</span> <span class="n">event</span><span class="p">,</span> <span class="n">Instance</span> <span class="n">instance</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">Mono</span><span class="p">.</span><span class="na">fromRunnable</span><span class="p">(()</span> <span class="o">-&gt;</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">event</span> <span class="k">instanceof</span> <span class="n">InstanceStatusChangedEvent</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">LOGGER</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;Instance {} ({}) is {}&quot;</span><span class="p">,</span> <span class="n">instance</span><span class="p">.</span><span class="na">getRegistration</span><span class="p">().</span><span class="na">getName</span><span class="p">(),</span> <span class="n">event</span><span class="p">.</span><span class="na">getInstance</span><span class="p">(),</span>
                        <span class="p">((</span><span class="n">InstanceStatusChangedEvent</span><span class="p">)</span> <span class="n">event</span><span class="p">).</span><span class="na">getStatusInfo</span><span class="p">().</span><span class="na">getStatus</span><span class="p">());</span>

                <span class="n">String</span> <span class="n">status</span> <span class="o">=</span> <span class="p">((</span><span class="n">InstanceStatusChangedEvent</span><span class="p">)</span> <span class="n">event</span><span class="p">).</span><span class="na">getStatusInfo</span><span class="p">().</span><span class="na">getStatus</span><span class="p">();</span>

                <span class="k">switch</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span> <span class="p">{</span>
                    <span class="c1">// 健康检查没通过</span>
                    <span class="k">case</span> <span class="s">&quot;DOWN&quot;</span><span class="p">:</span>
                        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;发送 健康检查没通过 的通知！&quot;</span><span class="p">);</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="c1">// 服务离线</span>
                    <span class="k">case</span> <span class="s">&quot;OFFLINE&quot;</span><span class="p">:</span>
                        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;发送 服务离线 的通知！&quot;</span><span class="p">);</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="c1">//服务上线</span>
                    <span class="k">case</span> <span class="s">&quot;UP&quot;</span><span class="p">:</span>
                        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;发送 服务上线 的通知！&quot;</span><span class="p">);</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="c1">// 服务未知异常</span>
                    <span class="k">case</span> <span class="s">&quot;UNKNOWN&quot;</span><span class="p">:</span>
                        <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;发送 服务未知异常 的通知！&quot;</span><span class="p">);</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">default</span><span class="p">:</span>
                        <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>

            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">LOGGER</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;Instance {} ({}) {}&quot;</span><span class="p">,</span> <span class="n">instance</span><span class="p">.</span><span class="na">getRegistration</span><span class="p">().</span><span class="na">getName</span><span class="p">(),</span> <span class="n">event</span><span class="p">.</span><span class="na">getInstance</span><span class="p">(),</span>
                        <span class="n">event</span><span class="p">.</span><span class="na">getType</span><span class="p">());</span>
            <span class="p">}</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

            </div>
        </article>
        <div id="ga-tags">
    
    <span class="ga-tag">
        <a class="ga-highlight" href="/Xuxx_Blogs/tag/Java/">#Java</a>
    </span>
    
    <span class="ga-tag">
        <a class="ga-highlight" href="/Xuxx_Blogs/tag/Spring Boot/">#Spring Boot</a>
    </span>
    
</div>
    </section>

    
<section id="ga-content_pager">

    <div class="next">
        <a class="ga-highlight" href="/Xuxx_Blogs/archives/bj27/">MySQL优化相关</a>
        <p class="yue">笔记</p>
    </div>


    <div class="prev">
        <a class="ga-highlight" href="/Xuxx_Blogs/archives/bj25/">Spring Boot发送邮件</a>
        <p class="yue">笔记</p>
    </div>

</section>


    

</main>

                <footer class="ga-mono" id="ga-footer">
                    <section>
                        <span id="ga-uptime"></span>
                        <span class="brand">Xuxx的个人博客。</span>
                    </section>
                    <section>
                        <p class="copyright">
                            <span>Copyright © 2020 Xuxx</span>
                            <span>Powered by <a no-style href="https://github.com/AlanDecode/Maverick" target="_blank">Maverick & Galileo</a></span>
                        </p>
                        <div class="copyright">
                            <span class="footer-addon">
                                
                            </span>
                            <nav class="social-links">
                                <ul><li><a class="no-style" title="Twitter" href="https://twitter.com/xuxx3309" target="_blank"><i class="gi gi-twitter"></i>Twitter</a></li><span class="separator">·</span><li><a class="no-style" title="GitHub" href="https://github.com/QQ1820582487" target="_blank"><i class="gi gi-github"></i>GitHub</a></li></ul>
                            </nav>
                        </div>
                    </section>
                    <script>
                        var site_build_date = "2019-12-26T02:30+08:00"
                    </script>
                    <script src="https://cdn.jsdelivr.net/gh/qq1820582487/Xuxx_Blogs@gh-pages/assets/galileo-d8a0a06eff.js"></script>
                </footer>
            </div>
        </div>
    </div>
        
        
        <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="pswp__bg"></div>
        <div class="pswp__scroll-wrap">
            <div class="pswp__container">
                <div class="pswp__item"></div>
                <div class="pswp__item"></div>
                <div class="pswp__item"></div>
            </div>
            <div class="pswp__ui pswp__ui--hidden">
                <div class="pswp__top-bar">
                    <div class="pswp__counter"></div>
                    <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                    <button class="pswp__button pswp__button--share" title="Share"></button>
                    <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                    <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                    <div class="pswp__preloader">
                        <div class="pswp__preloader__icn">
                          <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                          </div>
                        </div>
                    </div>
                </div>
                <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                    <div class="pswp__share-tooltip"></div> 
                </div>
                <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
                </button>
                <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
                </button>
                <div class="pswp__caption">
                    <div class="pswp__caption__center"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/gh/qq1820582487/Xuxx_Blogs@gh-pages/assets/ExSearch/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/qq1820582487/Xuxx_Blogs@gh-pages/assets/ExSearch/ExSearch-493cb9cd89.js"></script>
    
    <!--katex-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/qq1820582487/Xuxx_Blogs@gh-pages/assets/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/gh/qq1820582487/Xuxx_Blogs@gh-pages/assets/katex.min.js"></script>
    <script>
    mathOpts = {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "\\[", right: "\\]", display: true},
            {left: "$", right: "$", display: false},
            {left: "\\(", right: "\\)", display: false}
        ]
    };
    </script>
    <script defer src="https://cdn.jsdelivr.net/gh/qq1820582487/Xuxx_Blogs@gh-pages/assets/auto-render.min.js" onload="renderMathInElement(document.body, mathOpts);"></script>

    
    </body>
</html>