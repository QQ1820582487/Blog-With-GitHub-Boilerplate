<!DOCTYPE HTML>
<html lang="zh-CN">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta name="HandheldFriendly" content="true">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Xuxx,Galileo,blog" />
    <meta name="generator" content="Maverick 1.0" />
    <meta name="template" content="Galileo" />
    <link rel="alternate" type="application/rss+xml" title="Xuxx - 个人博客 &raquo; RSS 2.0" href="/Xuxx_Blogs/feed/index.xml" />
    <link rel="alternate" type="application/atom+xml" title="Xuxx - 个人博客 &raquo; ATOM 1.0" href="/Xuxx_Blogs/feed/atom/index.xml" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/qq1820582487/Xuxx_Blogs@gh-pages/assets/galileo-ec40839efa.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/qq1820582487/Xuxx_Blogs@gh-pages/assets/ExSearch/ExSearch-182e5a8868.css">
    <link href="https://fonts.googleapis.com/css?family=Fira+Code&display=swap" rel="stylesheet">
    <script>
        var ExSearchConfig = {
            root: "",
            api: "https://cdn.jsdelivr.net/gh/qq1820582487/Xuxx_Blogs@gh-pages/c10dc259b8727544cd1c251e10d2b7c8.json"
        }
    </script>
    
<title>GoFrame 笔记 - Xuxx - 个人博客</title>
<meta name="author" content="Xuxx" />
<meta name="description" content="笔记" />
<meta property="og:title" content="GoFrame 笔记 - Xuxx - 个人博客" />
<meta property="og:description" content="笔记" />
<meta property="og:site_name" content="Xuxx - 个人博客" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/Xuxx_Blogs/archives/go_bj_001/" />
<meta property="og:image" content="" />
<meta property="article:published_time" content="2024-09-06T19:09:00-00.00" />
<meta name="twitter:title" content="GoFrame 笔记 - Xuxx - 个人博客" />
<meta name="twitter:description" content="笔记" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="" />


    
<meta http-equiv="x-dns-prefetch-control" content="on">
<link rel="dns-prefetch" href="//cdn.jsdelivr.net" />

    </head>
    
    <body>
        
        <div class="container">
            <header id="ga-header">
                <div first>
                    <aside id="ga-logo">
                        <a href="/Xuxx_Blogs/" target="_self">
                            <img src="https://cdn.jsdelivr.net/gh/qq1820582487/Xuxx_Blogs@gh-pages/logo.png" alt="Xuxx - 个人博客">
                        </a>
                    </aside>
                    <aside id="ga-brand">
                        <h1 class="brand"><a class="no-style" href="/Xuxx_Blogs/">Xuxx - 个人博客</a></h1>
                        <p>坚持有效行动，改变自然发生。</p>
                    </aside>
                </div>
                <div second id="ga-nav">
                    <nav class="navs">
                        <ul><li><a class="ga-highlight" href="/Xuxx_Blogs/" target="_self">首页</a></li><span class="separator">·</span><li><a class="ga-highlight" href="/Xuxx_Blogs/archives/" target="_self">归档</a></li><span class="separator">·</span><li><a class="ga-highlight" href="/Xuxx_Blogs/about/" target="_self">关于</a></li><span class="separator">·</span><li><a href="#" target="_self" class="search-form-input ga-highlight">搜索</a></li></ul>
                    </nav>
                    <nav class="social-links">
                        <ul><li><a class="no-style" title="Twitter" href="https://twitter.com/xuxx3309" target="_blank"><i class="gi gi-twitter"></i>Twitter</a></li><span class="separator">·</span><li><a class="no-style" title="GitHub" href="https://github.com/QQ1820582487" target="_blank"><i class="gi gi-github"></i>GitHub</a></li></ul>
                    </nav>
                </div>
            </header>
            <div class="wrapper">
                
<main>    
    <section class="ga-section ga-content">
        <article class="yue">
            <h1 class="ga-post_title">GoFrame 笔记</h1>
            <span class="ga-post_meta ga-mono">
                <span>Xuxx</span>
                <time>
                    2024-09-06
                </time>
                
                in <a no-style class="category" href="/Xuxx_Blogs/category/笔记/">
                    笔记
                </a>
                
                
            </span>
            <div class="ga-content_body">
                <p>[TOC]</p>
<p><strong>本文开始记录开始时间为2023-09，如果官方文档有更新导致本文中链接失效或与官方文档不相同的地方或错漏，以官方文档为准</strong></p>
<h1>准备工作</h1>
<h2>前置条件</h2>
<p>已安装Go语言开发环境，已配置好GOROOT、GOPATH环境变量</p>
<p>熟悉Go语言基本语法与使用</p>
<p>GoFrame文档：<a href="https://goframe.org/">https://goframe.org/</a></p>
<p>学习过程以官方文档为主，本文内容均摘自官方文档，</p>
<p>本阶段只介绍Web开发部分，微服务部分以后有机会新开</p>
<h2>安装框架工具</h2>
<p><a href="https://github.com/gogf/gf/releases">https://github.com/gogf/gf/releases</a></p>
<p>下载对应的包安装。推荐安装到GOROOT的bin目录中</p>
<p>用以下命令查看是否安装成功</p>
<div class="highlight"><pre><span></span>gf<span class="w"> </span>-v
</pre></div>
<h2>项目初始化</h2>
<div class="highlight"><pre><span></span>go<span class="w"> </span>env<span class="w"> </span>-w<span class="w"> </span><span class="nv">GO111MODULE</span><span class="o">=</span>on
go<span class="w"> </span>env<span class="w"> </span>-w<span class="w"> </span><span class="nv">GOPROXY</span><span class="o">=</span>https://goproxy.cn
<span class="c1"># 如果已经设置过可以不要上面这两行</span>

gf<span class="w"> </span>init<span class="w"> </span>gf_demo<span class="w"> </span>-u<span class="w"> </span><span class="c1"># 如果之前已经创建过项目，并且不需要创建最新版本则省略-u</span>
</pre></div>
<blockquote><p>常用代理地址：</p>
<ul>
<li><code>https://goproxy.cn</code></li>
<li><code>https://goproxy.io</code></li>
<li><code>https://mirrors.aliyun.com/goproxy/</code></li>
</ul>
</blockquote>
<h2>项目启动</h2>
<p>进入项目中main.go文件所在的目录运行如下命令</p>
<div class="highlight"><pre><span></span>gf<span class="w"> </span>run<span class="w"> </span>main.go
</pre></div>
<p>启动成功后，在浏览器中输入<code>http://127.0.0.1:8000/hello</code>查看结果</p>
<h2>框架设计</h2>
<p>关于框架设计的内容，有点过于抽象，内容也是偏理论的，初学就来纠结这部分基本上也难以理解，所以这部分的其他内容可以放到以后再来研究。不过也需要了解一点基础知识，比如<code>MVC</code>与<code>3-Tier Architecture</code>，这部分内容详见文档<a href="https://goframe.org/pages/viewpage.action?pageId=3672442">代码分层设计</a>，不需要完全理解，知道个大概也就可以了。</p>
<h3>项目目录结构</h3>
<pre style="background: #272822; color: white">
/
├── api                 请求接口输入/输出数据结构定义
├── hack                项目开发工具、脚本
├── internal            业务逻辑存放目录，核心代码
│   ├── cmd             入口指令与其他命令工具目录
│   ├── consts          常量定义目录
│   ├── controller      控制器目录，接收/解析用户请求
│   ├── dao             数据访问对象目录，用于和底层数据库交互
│   ├── logic           核心业务逻辑代码目录
│   ├── model           数据结构管理模块，管理数据实体对象，以及输入与输出数据结构定义
│   |   ├── do          数据操作中业务模型与实例模型转换，由工具维护，不能手动修改
│   │   └── entity      数据模型是模型与数据集合的一对一关系，由工具维护，不用手动修改。
│   └── service         业务接口定义层。具体的接口实现在logic中进行注入。
├── manifest            包含程序编译、部署、运行、配置的文件
├── resource            静态资源文件
├── utility
├── go.mod
└── main.go             程序入口文件
</pre><p>有关项目目录更多详细介绍以及请求分层流转见文档<a href="https://goframe.org/pages/viewpage.action?pageId=30740166">工程目录设计</a></p>
<h1>路由</h1>
<h2>路由注册</h2>
<h3>函数注册</h3>
<p><strong>相关方法：</strong></p>
<div class="highlight"><pre><span></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="nx">Server</span><span class="p">)</span><span class="w"> </span><span class="nx">BindHandler</span><span class="p">(</span><span class="nx">pattern</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">handler</span><span class="w"> </span><span class="kd">interface</span><span class="p">{})</span>
</pre></div>
<p>其中<code>handler</code>的定义方式有如下两种：</p>
<div class="highlight"><pre><span></span><span class="kd">func</span><span class="p">(</span><span class="nx">request</span><span class="w"> </span><span class="o">*</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span>
<span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">BizRequest</span><span class="p">)(</span><span class="nx">BizResponse</span><span class="p">,</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
</pre></div>
<p><strong>匿名函数与普通函数注册</strong>
<code>internal/cmd/cmd.go</code></p>
<div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nx">cmd</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;context&quot;</span>

<span class="w">    </span><span class="s">&quot;github.com/gogf/gf/v2/frame/g&quot;</span>
<span class="w">    </span><span class="s">&quot;github.com/gogf/gf/v2/net/ghttp&quot;</span>
<span class="w">    </span><span class="s">&quot;github.com/gogf/gf/v2/os/gcmd&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">handler</span><span class="p">(</span><span class="nx">req</span><span class="w"> </span><span class="o">*</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">req</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Writeln</span><span class="p">(</span><span class="s">&quot;&lt;h1&gt;Hello World From handler&lt;/h1&gt;&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">var</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">Main</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">gcmd</span><span class="p">.</span><span class="nx">Command</span><span class="p">{</span>
<span class="w">        </span><span class="nx">Name</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;main&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Usage</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;main&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Brief</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;start http server&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Func</span><span class="p">:</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">parser</span><span class="w"> </span><span class="o">*</span><span class="nx">gcmd</span><span class="p">.</span><span class="nx">Parser</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">s</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Server</span><span class="p">()</span>

<span class="w">            </span><span class="c1">// 直接用匿名函数进行路由注册</span>
<span class="w">            </span><span class="nx">s</span><span class="p">.</span><span class="nx">BindHandler</span><span class="p">(</span><span class="s">&quot;/hello&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">req</span><span class="w"> </span><span class="o">*</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">req</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Writeln</span><span class="p">(</span><span class="s">&quot;&lt;h1&gt;Hello World!&lt;/h1&gt;&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="p">})</span>

<span class="w">            </span><span class="c1">// 或者使用提前定义好的函数来进行注册</span>
<span class="w">            </span><span class="nx">s</span><span class="p">.</span><span class="nx">BindHandler</span><span class="p">(</span><span class="s">&quot;/world&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">handler</span><span class="p">)</span>

<span class="w">            </span><span class="nx">s</span><span class="p">.</span><span class="nx">Run</span><span class="p">()</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">)</span>
</pre></div>
<p>注册成功后在浏览器输入<a href="http://127.0.0.1:8000/hello">http://127.0.0.1:8000/hello</a>或者<a href="http://127.0.0.1:8000/world">http://127.0.0.1:8000/world</a>即可访问对应的路由</p>
<p><strong>指定HTTP请求方法</strong>
上述方法注册路由默认支持所有HTTP请求方法，如果需要指定请求方法，可用以下写法：</p>
<div class="highlight"><pre><span></span><span class="c1">// 该路由只支持GET请求</span>
<span class="nx">s</span><span class="p">.</span><span class="nx">BindHandler</span><span class="p">(</span><span class="s">&quot;GET:/hello&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">req</span><span class="w"> </span><span class="o">*</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">req</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Writeln</span><span class="p">(</span><span class="s">&quot;&lt;h1&gt;Hello World! GET&lt;/h1&gt;&quot;</span><span class="p">)</span>
<span class="p">})</span>
<span class="c1">// 该路由只支持POST请求</span>
<span class="nx">s</span><span class="p">.</span><span class="nx">BindHandler</span><span class="p">(</span><span class="s">&quot;POST:/hello&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">req</span><span class="w"> </span><span class="o">*</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">req</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Writeln</span><span class="p">(</span><span class="s">&quot;&lt;h1&gt;Hello World! POST&lt;/h1&gt;&quot;</span><span class="p">)</span>
<span class="p">})</span>
</pre></div>
<p>对于同一路由可以定义不同的请求方法实现不同功能。</p>
<blockquote><p>几个最常用HTTP方法</p>
<table>
<thead><tr>
<th style="text-align:center">方法</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">GET</td>
<td style="text-align:center">用于获取数据，不会修改服务端资源数据</td>
</tr>
<tr>
<td style="text-align:center">POST</td>
<td style="text-align:center">将资源数据提交到服务端，常用于在服务端创建新数据</td>
</tr>
<tr>
<td style="text-align:center">PUT</td>
<td style="text-align:center">将资源数据提交到服务端，常用于修改已存在的资源数据</td>
</tr>
<tr>
<td style="text-align:center">DELETE</td>
<td style="text-align:center">用于删除服务端资源数据</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
</blockquote>
<p><strong>对象方法注册</strong></p>
<p>还可以用对象当中的方法来注册路由。</p>
<p>选定义一个名为<code>user</code>控制器</p>
<p><code>internal/controller/user/user.go</code></p>
<div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nx">user</span>

<span class="kn">import</span><span class="w"> </span><span class="s">&quot;github.com/gogf/gf/v2/net/ghttp&quot;</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">Controller</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">New</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="nx">Controller</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Controller</span><span class="p">{}</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Controller</span><span class="p">)</span><span class="w"> </span><span class="nx">AddUser</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">r</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Writeln</span><span class="p">(</span><span class="s">&quot;添加用户&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Controller</span><span class="p">)</span><span class="w"> </span><span class="nx">UpdateUser</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">r</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Writeln</span><span class="p">(</span><span class="s">&quot;更新用户&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Controller</span><span class="p">)</span><span class="w"> </span><span class="nx">DeleteUser</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">r</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Writeln</span><span class="p">(</span><span class="s">&quot;删除用户&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Controller</span><span class="p">)</span><span class="w"> </span><span class="nx">ListUser</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">r</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Writeln</span><span class="p">(</span><span class="s">&quot;用户列表&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Controller</span><span class="p">)</span><span class="w"> </span><span class="nx">GetUser</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">r</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Writeln</span><span class="p">(</span><span class="s">&quot;查询一个用户&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Controller</span><span class="p">)</span><span class="w"> </span><span class="nx">Post</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">r</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Writeln</span><span class="p">(</span><span class="s">&quot;添加用户&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Controller</span><span class="p">)</span><span class="w"> </span><span class="nx">Put</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">r</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Writeln</span><span class="p">(</span><span class="s">&quot;更新用户&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Controller</span><span class="p">)</span><span class="w"> </span><span class="nx">Delete</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">r</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Writeln</span><span class="p">(</span><span class="s">&quot;删除用户&quot;</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Controller</span><span class="p">)</span><span class="w"> </span><span class="nx">Get</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">r</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Writeln</span><span class="p">(</span><span class="s">&quot;查询一个用户&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
<p><code>internal/cmd/cmd.go</code></p>
<div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nx">cmd</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;context&quot;</span>

<span class="w">    </span><span class="c1">// 引入控制器user包</span>
<span class="w">    </span><span class="s">&quot;gf_demo/internal/controller/user&quot;</span>

<span class="w">    </span><span class="s">&quot;github.com/gogf/gf/v2/frame/g&quot;</span>
<span class="w">    </span><span class="s">&quot;github.com/gogf/gf/v2/os/gcmd&quot;</span>
<span class="p">)</span>

<span class="kd">var</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">Main</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">gcmd</span><span class="p">.</span><span class="nx">Command</span><span class="p">{</span>
<span class="w">        </span><span class="nx">Name</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;main&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Usage</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;main&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Brief</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;start http server&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Func</span><span class="p">:</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">parser</span><span class="w"> </span><span class="o">*</span><span class="nx">gcmd</span><span class="p">.</span><span class="nx">Parser</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">s</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Server</span><span class="p">()</span>

<span class="w">            </span><span class="c1">// 定义对象</span>
<span class="w">            </span><span class="nx">usercontroller</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">New</span><span class="p">()</span>
<span class="w">            </span><span class="c1">// 将对象方法绑定到路由</span>
<span class="w">            </span><span class="nx">s</span><span class="p">.</span><span class="nx">BindHandler</span><span class="p">(</span><span class="s">&quot;/adduser&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">usercontroller</span><span class="p">.</span><span class="nx">AddUser</span><span class="p">)</span>

<span class="w">            </span><span class="nx">s</span><span class="p">.</span><span class="nx">Run</span><span class="p">()</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">)</span>
</pre></div>
<h3>对象注册</h3>
<p>对象里的方法可以批量注册</p>
<p>相关方法</p>
<div class="highlight"><pre><span></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="nx">Server</span><span class="p">)</span><span class="w"> </span><span class="nx">BindObject</span><span class="p">(</span><span class="nx">pattern</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">object</span><span class="w"> </span><span class="kd">interface</span><span class="p">{},</span><span class="w"> </span><span class="nx">method</span><span class="w"> </span><span class="o">...</span><span class="kt">string</span><span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="nx">Server</span><span class="p">)</span><span class="w"> </span><span class="nx">BindObjectMethod</span><span class="p">(</span><span class="nx">pattern</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">object</span><span class="w"> </span><span class="kd">interface</span><span class="p">{},</span><span class="w"> </span><span class="nx">method</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="nx">Server</span><span class="p">)</span><span class="w"> </span><span class="nx">BindObjectRest</span><span class="p">(</span><span class="nx">pattern</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">object</span><span class="w"> </span><span class="kd">interface</span><span class="p">{})</span>
</pre></div>
<p><strong>绑定全部公共方法</strong></p>
<p><code>internal/cmd/cmd.go</code></p>
<div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nx">cmd</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;context&quot;</span>
<span class="w">    </span><span class="s">&quot;starting/internal/controller/user&quot;</span>

<span class="w">    </span><span class="s">&quot;github.com/gogf/gf/v2/frame/g&quot;</span>
<span class="w">    </span><span class="s">&quot;github.com/gogf/gf/v2/os/gcmd&quot;</span>
<span class="p">)</span>

<span class="kd">var</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">Main</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">gcmd</span><span class="p">.</span><span class="nx">Command</span><span class="p">{</span>
<span class="w">        </span><span class="nx">Name</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;main&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Usage</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;main&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Brief</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;start http server&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Func</span><span class="p">:</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">parser</span><span class="w"> </span><span class="o">*</span><span class="nx">gcmd</span><span class="p">.</span><span class="nx">Parser</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">s</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Server</span><span class="p">()</span>

<span class="w">            </span><span class="nx">usercontroller</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">New</span><span class="p">()</span>
<span class="w">            </span><span class="c1">// 绑定user控制器中所有公共方法</span>
<span class="w">            </span><span class="nx">s</span><span class="p">.</span><span class="nx">BindObject</span><span class="p">(</span><span class="s">&quot;/user&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">usercontroller</span><span class="p">)</span>

<span class="w">            </span><span class="nx">s</span><span class="p">.</span><span class="nx">Run</span><span class="p">()</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">)</span>
</pre></div>
<p><strong>绑定指定方法</strong></p>
<div class="highlight"><pre><span></span><span class="nx">usercontroller</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">New</span><span class="p">()</span>
<span class="c1">// 绑定user控制器中多个方法</span>
<span class="nx">s</span><span class="p">.</span><span class="nx">BindObject</span><span class="p">(</span><span class="s">&quot;/user&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">usercontroller</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;AddUser,UpdateUser&quot;</span><span class="p">)</span>
<span class="c1">// 绑定单个方法</span>
<span class="nx">s</span><span class="p">.</span><span class="nx">BindObjectMethod</span><span class="p">(</span><span class="s">&quot;/deluser&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">usercontroller</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;DeleteUser&quot;</span><span class="p">)</span>
</pre></div>
<p><strong>以RESTFul方绑定对象方法</strong></p>
<div class="highlight"><pre><span></span><span class="nx">usercontroller</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">New</span><span class="p">()</span>
<span class="nx">s</span><span class="p">.</span><span class="nx">BindObjectRest</span><span class="p">(</span><span class="s">&quot;/user&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">usercontroller</span><span class="p">)</span>
</pre></div>
<h3>分组注册</h3>
<p>可以为不同路由设置一个相同的前缀，即分组路由，分组路由有以下两种写法</p>
<div class="highlight"><pre><span></span><span class="nx">s</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Server</span><span class="p">()</span>

<span class="nx">usercontroller</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">New</span><span class="p">()</span>
<span class="nx">s</span><span class="p">.</span><span class="nx">Group</span><span class="p">(</span><span class="s">&quot;/user&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">group</span><span class="w"> </span><span class="o">*</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">RouterGroup</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">group</span><span class="p">.</span><span class="nx">Middleware</span><span class="p">(</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">MiddlewareHandlerResponse</span><span class="p">)</span>
<span class="w">    </span><span class="nx">group</span><span class="p">.</span><span class="nx">Bind</span><span class="p">(</span>
<span class="w">        </span><span class="nx">usercontroller</span><span class="p">,</span><span class="w"> </span><span class="c1">// 绑定到控制器对象</span>
<span class="w">    </span><span class="p">)</span>

<span class="w">    </span><span class="c1">// 可以用GET POST PUT等定义路由</span>
<span class="w">    </span><span class="nx">group</span><span class="p">.</span><span class="nx">GET</span><span class="p">(</span><span class="s">&quot;/get&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">r</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Writeln</span><span class="p">(</span><span class="s">&quot;/user/get&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">})</span>
<span class="p">})</span>

<span class="nx">s</span><span class="p">.</span><span class="nx">Run</span><span class="p">()</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="nx">s</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Server</span><span class="p">()</span>

<span class="nx">usercontroller</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">New</span><span class="p">()</span>
<span class="nx">group</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">Group</span><span class="p">(</span><span class="s">&quot;/user&quot;</span><span class="p">)</span>
<span class="nx">group</span><span class="p">.</span><span class="nx">Middleware</span><span class="p">(</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">MiddlewareHandlerResponse</span><span class="p">)</span>
<span class="nx">group</span><span class="p">.</span><span class="nx">Bind</span><span class="p">(</span>
<span class="w">    </span><span class="nx">usercontroller</span><span class="p">,</span><span class="w"> </span><span class="c1">// 绑定到控制器对象</span>
<span class="p">)</span>

<span class="c1">// 可以用GET POST PUT等定义路由</span>
<span class="nx">group</span><span class="p">.</span><span class="nx">GET</span><span class="p">(</span><span class="s">&quot;/get&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">r</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Writeln</span><span class="p">(</span><span class="s">&quot;/user/get&quot;</span><span class="p">)</span>
<span class="p">})</span>

<span class="nx">s</span><span class="p">.</span><span class="nx">Run</span><span class="p">()</span>
</pre></div>
<h2>规范路由</h2>
<p>GoFrame中提供了规范化的路由注册方式，注册方法如下</p>
<div class="highlight"><pre><span></span><span class="kd">func</span><span class="w"> </span><span class="nx">Handler</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">req</span><span class="w"> </span><span class="o">*</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="o">*</span><span class="nx">Response</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
</pre></div>
<p>其中<code>Request</code>与<code>Response</code>为自定义的结构体。</p>
<p>通过如下方式指定请求方法与路径</p>
<div class="highlight"><pre><span></span><span class="kd">type</span><span class="w"> </span><span class="nx">HelloReq</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">g</span><span class="p">.</span><span class="nx">Meta</span><span class="w"> </span><span class="s">`path:&quot;/hello&quot; method:&quot;get&quot;`</span>
<span class="p">}</span>
</pre></div>
<h1>请求输入</h1>
<h2>普通请求输入</h2>
<p>基础代码如下：路由用group绑定到控制器后，在控制器中写如下方法，以下代码均在此修改：</p>
<div class="highlight"><pre><span></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Controller</span><span class="p">)</span><span class="w"> </span><span class="nx">Params</span><span class="p">(</span><span class="nx">request</span><span class="w"> </span><span class="o">*</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">m</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">GetQueryMap</span><span class="p">()</span>
<span class="w">    </span><span class="nx">request</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">WriteJson</span><span class="p">(</span><span class="nx">m</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
<h3>query参数获取</h3>
<p>query参数是指以<code>?a=1&amp;b=2</code>的形式写在url中的参数，通常由GET方法传递。</p>
<p><strong>单个参数值</strong></p>
<div class="highlight"><pre><span></span><span class="nx">m</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">GetQuery</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span>
</pre></div>
<p>GetQuery可以指定参数名称，获取对应的参数值，如果值不存在，则返回<code>nil</code></p>
<p>还可以指定默认值，当对应参数值不存在时，返回指定的默认值</p>
<div class="highlight"><pre><span></span><span class="nx">m</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">GetQuery</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;孙行者&quot;</span><span class="p">)</span>
</pre></div>
<p>返回的是一个<code>gvar.Var</code>类型，可以根据需要进行类型转换，常用类型转换方法如下</p>
<div class="highlight"><pre><span></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">v</span><span class="w"> </span><span class="o">*</span><span class="nx">Var</span><span class="p">)</span><span class="w"> </span><span class="nx">Bytes</span><span class="p">()</span><span class="w"> </span><span class="p">[]</span><span class="kt">byte</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">v</span><span class="w"> </span><span class="o">*</span><span class="nx">Var</span><span class="p">)</span><span class="w"> </span><span class="nx">String</span><span class="p">()</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">v</span><span class="w"> </span><span class="o">*</span><span class="nx">Var</span><span class="p">)</span><span class="w"> </span><span class="nx">Bool</span><span class="p">()</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">v</span><span class="w"> </span><span class="o">*</span><span class="nx">Var</span><span class="p">)</span><span class="w"> </span><span class="nx">Int</span><span class="p">()</span><span class="w"> </span><span class="kt">int</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">v</span><span class="w"> </span><span class="o">*</span><span class="nx">Var</span><span class="p">)</span><span class="w"> </span><span class="nx">Int8</span><span class="p">()</span><span class="w"> </span><span class="kt">int8</span><span class="w"> </span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">v</span><span class="w"> </span><span class="o">*</span><span class="nx">Var</span><span class="p">)</span><span class="w"> </span><span class="nx">Int16</span><span class="p">()</span><span class="w"> </span><span class="kt">int16</span><span class="w"> </span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">v</span><span class="w"> </span><span class="o">*</span><span class="nx">Var</span><span class="p">)</span><span class="w"> </span><span class="nx">Int32</span><span class="p">()</span><span class="w"> </span><span class="kt">int32</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">v</span><span class="w"> </span><span class="o">*</span><span class="nx">Var</span><span class="p">)</span><span class="w"> </span><span class="nx">Int64</span><span class="p">()</span><span class="w"> </span><span class="kt">int64</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">v</span><span class="w"> </span><span class="o">*</span><span class="nx">Var</span><span class="p">)</span><span class="w"> </span><span class="nx">Uint</span><span class="p">()</span><span class="w"> </span><span class="kt">uint</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">v</span><span class="w"> </span><span class="o">*</span><span class="nx">Var</span><span class="p">)</span><span class="w"> </span><span class="nx">Uint8</span><span class="p">()</span><span class="w"> </span><span class="kt">uint8</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">v</span><span class="w"> </span><span class="o">*</span><span class="nx">Var</span><span class="p">)</span><span class="w"> </span><span class="nx">Uint16</span><span class="p">()</span><span class="w"> </span><span class="kt">uint16</span><span class="w"> </span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">v</span><span class="w"> </span><span class="o">*</span><span class="nx">Var</span><span class="p">)</span><span class="w"> </span><span class="nx">Uint32</span><span class="p">()</span><span class="w"> </span><span class="kt">uint32</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">v</span><span class="w"> </span><span class="o">*</span><span class="nx">Var</span><span class="p">)</span><span class="w"> </span><span class="nx">Uint64</span><span class="p">()</span><span class="w"> </span><span class="kt">uint64</span><span class="w"> </span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">v</span><span class="w"> </span><span class="o">*</span><span class="nx">Var</span><span class="p">)</span><span class="w"> </span><span class="nx">Float32</span><span class="p">()</span><span class="w"> </span><span class="kt">float32</span><span class="w"> </span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">v</span><span class="w"> </span><span class="o">*</span><span class="nx">Var</span><span class="p">)</span><span class="w"> </span><span class="nx">Float64</span><span class="p">()</span><span class="w"> </span><span class="kt">float64</span><span class="w"> </span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">v</span><span class="w"> </span><span class="o">*</span><span class="nx">Var</span><span class="p">)</span><span class="w"> </span><span class="nx">Time</span><span class="p">(</span><span class="nx">format</span><span class="w"> </span><span class="o">...</span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Time</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">v</span><span class="w"> </span><span class="o">*</span><span class="nx">Var</span><span class="p">)</span><span class="w"> </span><span class="nx">Duration</span><span class="p">()</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="w"> </span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">v</span><span class="w"> </span><span class="o">*</span><span class="nx">Var</span><span class="p">)</span><span class="w"> </span><span class="nx">GTime</span><span class="p">(</span><span class="nx">format</span><span class="w"> </span><span class="o">...</span><span class="kt">string</span><span class="p">)</span>
</pre></div>
<p><strong>批量获取Query参数</strong></p>
<p>GoFrame中提供了<code>GetQueryMap</code>，<code>GetQueryMapStrStr</code>，<code>GetQueryMapStrVar</code>三个方法用于批量获取Query参数，三个方法使用方式一致，只是返回类型不同。</p>
<ul>
<li>获取全部Query参数</li>
</ul>
<div class="highlight"><pre><span></span><span class="nx">m</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">GetQueryMap</span><span class="p">()</span>
</pre></div>
<ul>
<li>指定需要获取的参数名称与默认值</li>
</ul>
<div class="highlight"><pre><span></span><span class="nx">m</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">GetQueryMap</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;者行孙&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;age&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">600</span><span class="p">})</span>
</pre></div>
<p><strong>将Query参数转化为自定义结构体</strong></p>
<p>可以自定义结构体，将请求参数直接转化为对应的结构体：</p>
<div class="highlight"><pre><span></span><span class="kd">type</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Name</span><span class="w"> </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">Age</span><span class="w">  </span><span class="kt">int</span>
<span class="p">}</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">u</span><span class="w"> </span><span class="o">*</span><span class="nx">user</span>
<span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">ParseQuery</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">u</span><span class="p">)</span>
<span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">request</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">WritelnExit</span><span class="p">(</span><span class="s">&quot;转换出借&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
<p>如上，结构体中成员为<code>Name</code>、<code>Age</code>，参数为<code>name</code>和<code>age</code>则参成功转换，如果结构体成员变量名与参数名不一致则无法转换，此时需要为成员变量指定其对应的参数，可以用<code>json:</code>/<code>param:</code>/<code>p:</code>这些方式来指定。如下</p>
<div class="highlight"><pre><span></span><span class="kd">type</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">UserName</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;name&quot;`</span>
<span class="w">    </span><span class="nx">UserAge</span><span class="w">  </span><span class="kt">int</span><span class="w">    </span><span class="s">`p:&quot;age&quot;`</span>
<span class="p">}</span>
</pre></div>
<h3>表单参数获取（POST参数获取）</h3>
<p>表单参数获取是指获取<code>application/x-www-form-urlencoded</code>、<code>application/form-data</code>、<code>multipart/form-data</code>等数据，也可以用来获取以json格式提交的数据，简单理解即为可以获取POST方法提交的数据。</p>
<p><strong>单个参数</strong></p>
<div class="highlight"><pre><span></span><span class="nx">m</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">GetForm</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span>
</pre></div>
<p><code>GetForm</code>用于指定参数名称，获取对应参数值，如果对应参数不存在，返回<code>nil</code></p>
<p>也可以指定默认值，当指定参数不存在时，返回默认值</p>
<div class="highlight"><pre><span></span><span class="nx">m</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">GetForm</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;烧包谷&quot;</span><span class="p">)</span>
</pre></div>
<p>返回的是一个<code>gvar.Var</code>类型，可以根据需要进行类型转换</p>
<p><strong>批量获取请求数据</strong></p>
<p>可以用<code>GetFormMap</code>、<code>GetFormMapStrStr</code>、<code>GetFormMapStrVar</code>批量获取请求数据，三个方法使用方式一样，只是返回的Map类型不同。</p>
<div class="highlight"><pre><span></span><span class="nx">m</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">GetFormMap</span><span class="p">()</span>
</pre></div>
<p>可以指定需要获取的参数以及默认值</p>
<div class="highlight"><pre><span></span><span class="nx">m</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">GetFormMap</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;大洋芋&quot;</span><span class="p">})</span>
</pre></div>
<p><strong>将请求数据转化为自定义结构体</strong></p>
<p>和Query参数一样，也可以将请求参数直接转为自定义结构体。如果结构体成员名称与参数名称不一致，也可以用<code>json:</code>、<code>param:</code>、<code>p:</code>这些tag来指定对应的参数名称</p>
<div class="highlight"><pre><span></span><span class="kd">type</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">UserName</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;name&quot;`</span>
<span class="w">    </span><span class="nx">UserAge</span><span class="w">  </span><span class="kt">int</span><span class="w">    </span><span class="s">`p:&quot;age&quot;`</span>
<span class="p">}</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">u</span><span class="w"> </span><span class="o">*</span><span class="nx">user</span>
<span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">ParseForm</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">u</span><span class="p">)</span>
<span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">request</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">WritelnExit</span><span class="p">(</span><span class="s">&quot;转换出借&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
<h3>动态路由参数获取</h3>
<p>动态路由需要对现有代码进行一点改动，需要先在<code>api</code>包中定义请求与返回数据格式，对指定的路由进行动态注册：</p>
<p><code>api</code></p>
<div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nx">api</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;github.com/gogf/gf/v2/frame/g&quot;</span>
<span class="p">)</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">Res</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">g</span><span class="p">.</span><span class="nx">Meta</span><span class="w"> </span><span class="s">`mime:&quot;text/html&quot;`</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">ParamReq</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">g</span><span class="p">.</span><span class="nx">Meta</span><span class="w"> </span><span class="s">`path:&quot;/params/:name&quot; method:&quot;all&quot;`</span>
<span class="p">}</span>
</pre></div>
<p>再将控制器的的方法利用<code>api</code>数据结构进行修改：</p>
<p><code>Controller</code></p>
<div class="highlight"><pre><span></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Controller</span><span class="p">)</span><span class="w"> </span><span class="nx">Params</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">req</span><span class="w"> </span><span class="o">*</span><span class="nx">api</span><span class="p">.</span><span class="nx">ParamReq</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="o">*</span><span class="nx">api</span><span class="p">.</span><span class="nx">Res</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">request</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">RequestFromCtx</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<span class="w">    </span><span class="nx">u</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">GetRouter</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">request</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">WriteJson</span><span class="p">(</span><span class="nx">g</span><span class="p">.</span><span class="nx">Map</span><span class="p">{</span><span class="s">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">u</span><span class="p">})</span>
<span class="w">    </span><span class="k">return</span>
<span class="p">}</span>
</pre></div>
<p><strong>获取单个参数</strong></p>
<div class="highlight"><pre><span></span><span class="nx">u</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">GetRouter</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span>
</pre></div>
<p>返回<code>gvar.Var</code>类型，可以按需要进行类型转换。也可以指定默认值。</p>
<p><strong>批量获取参数</strong></p>
<div class="highlight"><pre><span></span><span class="nx">u</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">GetRouterMap</span><span class="p">()</span>
</pre></div>
<p>返回值为<code>map[string]string</code>。如果没有设置动态路由，则返回<code>nil</code></p>
<h3>所有请求参数获取</h3>
<p>GoFrame中还提供了一些方法获取所有请求参数，用法与上面两种类似，只是不区分请求方法。如果GET和POST提供的参数名称相同，则POST参数优先。</p>
<p><strong>获取单个参数</strong></p>
<div class="highlight"><pre><span></span><span class="nx">data</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">GetRequest</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span>
<span class="c1">// 简写</span>
<span class="nx">data</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span>
</pre></div>
<p>返回<code>gvar.Var</code>类型，可以提供默认值。</p>
<p><strong>批量获取请求参数</strong></p>
<div class="highlight"><pre><span></span><span class="nx">data</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">GetRequestMap</span><span class="p">()</span>
<span class="c1">// 可以指定需要获取的参数名及默认值</span>
<span class="nx">data</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">GetRequestMap</span><span class="p">(</span><span class="nx">g</span><span class="p">.</span><span class="nx">Map</span><span class="p">{</span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">})</span>
<span class="c1">// 还有以下几种</span>
<span class="nx">data</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">GetRequestMapStrStr</span><span class="p">()</span>
<span class="nx">data</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">GetRequestMapStrVar</span><span class="p">()</span>
</pre></div>
<p><strong>将请求参数转为自定义结构体</strong></p>
<div class="highlight"><pre><span></span><span class="nx">request</span><span class="p">.</span><span class="nx">Parse</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">u</span><span class="p">)</span><span class="w"> </span><span class="c1">// u为自定义结构体指针</span>
</pre></div>
<h2>Api请求输入</h2>
<p>在<code>api</code>中定义请求与响应数据结构，可以直接将需要接收的参数定义为请求结构体的成员，请求时会自动转为对应结构体。</p>
<p>例如，将前面的<code>api</code>请求部分改为</p>
<div class="highlight"><pre><span></span><span class="kd">type</span><span class="w"> </span><span class="nx">ParamReq</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">g</span><span class="p">.</span><span class="nx">Meta</span><span class="w">   </span><span class="s">`path:&quot;/params&quot; method:&quot;post&quot;`</span>
<span class="w">    </span><span class="nx">UserName</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="s">`p:&quot;name&quot; d:&quot;林冲&quot;`</span>
<span class="w">    </span><span class="nx">UserAge</span><span class="w">  </span><span class="kt">int</span><span class="w">    </span><span class="s">`p:&quot;age&quot; d:&quot;110&quot;`</span>
<span class="p">}</span>
</pre></div>
<p>其中<code>p:</code>或<code>param:</code>用于指定该成员对应的请求参数名，<code>d:</code>或<code>default:</code>用于指定默认值。如果Query与Body中有相同名称的参数，则以Body中的参数优先。</p>
<h1>响应输出</h1>
<p>在控制器中新建如下方法，用来测试响应输出。以下所有代码均在此处修改。</p>
<div class="highlight"><pre><span></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Controller</span><span class="p">)</span><span class="w"> </span><span class="nx">Resp</span><span class="p">(</span><span class="nx">req</span><span class="w"> </span><span class="o">*</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 以下代码在此写</span>
<span class="p">}</span>
</pre></div>
<h2>文本数据返回</h2>
<p>GoFrame中通过以下方法返回文本数据到客户端：</p>
<div class="highlight"><pre><span></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">Response</span><span class="p">)</span><span class="w"> </span><span class="nx">Write</span><span class="p">(</span><span class="nx">content</span><span class="w"> </span><span class="o">...</span><span class="kd">interface</span><span class="p">{})</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">Response</span><span class="p">)</span><span class="w"> </span><span class="nx">WriteExit</span><span class="p">(</span><span class="nx">content</span><span class="w"> </span><span class="o">...</span><span class="kd">interface</span><span class="p">{})</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">Response</span><span class="p">)</span><span class="w"> </span><span class="nx">Writef</span><span class="p">(</span><span class="nx">format</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">params</span><span class="w"> </span><span class="o">...</span><span class="kd">interface</span><span class="p">{})</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">Response</span><span class="p">)</span><span class="w"> </span><span class="nx">WritefExit</span><span class="p">(</span><span class="nx">format</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">params</span><span class="w"> </span><span class="o">...</span><span class="kd">interface</span><span class="p">{})</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">Response</span><span class="p">)</span><span class="w"> </span><span class="nx">Writeln</span><span class="p">(</span><span class="nx">content</span><span class="w"> </span><span class="o">...</span><span class="kd">interface</span><span class="p">{})</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">Response</span><span class="p">)</span><span class="w"> </span><span class="nx">WritelnExit</span><span class="p">(</span><span class="nx">content</span><span class="w"> </span><span class="o">...</span><span class="kd">interface</span><span class="p">{})</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">Response</span><span class="p">)</span><span class="w"> </span><span class="nx">Writefln</span><span class="p">(</span><span class="nx">format</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">params</span><span class="w"> </span><span class="o">...</span><span class="kd">interface</span><span class="p">{})</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">Response</span><span class="p">)</span><span class="w"> </span><span class="nx">WriteflnExit</span><span class="p">(</span><span class="nx">format</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">params</span><span class="w"> </span><span class="o">...</span><span class="kd">interface</span><span class="p">{})</span>
</pre></div>
<p>以上方法中，带有<code>Exit</code>的表示执行完响应之后就退出本次请求，不再执行后面的内容。带有<code>ln</code>的表示会在响应内容的末尾追加换行符。</p>
<p>以上方法用于向客户端响应文本内容。内容格式为<code>text/html</code>或<code>text/plain</code>，参数可以是任意数据类型，非字符串类型通常会将内容进行json转为字符串后返回到客户端。</p>
<p>如果提供参数为文本，可以是普通文本也可以是HTML文本。</p>
<p><strong>响应简单文本</strong></p>
<div class="highlight"><pre><span></span><span class="nx">req</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Write</span><span class="p">(</span><span class="s">&quot;锦瑟无端五十弦&quot;</span><span class="p">)</span>
</pre></div>
<p><strong>响应简单HTML</strong></p>
<div class="highlight"><pre><span></span><span class="nx">req</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Write</span><span class="p">(</span><span class="s">&quot;&lt;h1&gt;春蚕到死丝方尽&lt;/h1&gt;&quot;</span><span class="p">)</span>
</pre></div>
<p><strong>响应复杂HTML</strong></p>
<div class="highlight"><pre><span></span><span class="nx">html</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">`</span>
<span class="s">&lt;!DOCTYPE html&gt;</span>
<span class="s">&lt;html lang=&quot;en&quot;&gt;</span>
<span class="s">&lt;head&gt;</span>
<span class="s">&lt;meta charset=&quot;UTF-8&quot;&gt;</span>
<span class="s">&lt;title&gt;Clock&lt;/title&gt;</span>
<span class="s">&lt;style&gt;</span>
<span class="s">@import url(&#39;https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&amp;display=swap&#39;);</span>
<span class="s">*</span>
<span class="s">{</span>
<span class="s">margin: 0;</span>
<span class="s">padding: 0;</span>
<span class="s">box-sizing: border-box;</span>
<span class="s">font-family: &#39;Poppins&#39;, sans-serif;</span>
<span class="s">}</span>
<span class="s">body</span>
<span class="s">{</span>
<span class="s">display: flex;</span>
<span class="s">justify-content: center;</span>
<span class="s">align-items: center;</span>
<span class="s">min-height: 100vh;</span>
<span class="s">background: #acbaca;</span>
<span class="s">}</span>
<span class="s">.clock</span>
<span class="s">{</span>
<span class="s">position: relative;</span>
<span class="s">width: 300px;</span>
<span class="s">height: 300px;</span>
<span class="s">background: #c9d5e0;</span>
<span class="s">display: flex;</span>
<span class="s">justify-content: center;</span>
<span class="s">align-items: center;</span>
<span class="s">border-radius: 50px;</span>
<span class="s">box-shadow: 30px 30px 30px -10px rgba(0,0,0,0.15),</span>
<span class="s">inset 15px 15px 10px rgba(255,255,255,0.75),</span>
<span class="s">-15px -15px 35px rgba(255,255,255,0.55),</span>
<span class="s">inset -1px -1px 10px rgba(0,0,0,0.2);</span>
<span class="s">}</span>
<span class="s">.clock::before</span>
<span class="s">{</span>
<span class="s">content: &#39;&#39;;</span>
<span class="s">position: absolute;</span>
<span class="s">width: 4px;</span>
<span class="s">height: 4px;</span>
<span class="s">background: #e91e63;</span>
<span class="s">border-radius: 50%;</span>
<span class="s">z-index: 1000;</span>
<span class="s">box-shadow: 0 0 0 1px #e91e63,</span>
<span class="s">0 0 0 3px #fff,</span>
<span class="s">0 0 5px 5px rgba(0,0,0,0.15);</span>
<span class="s">}</span>
<span class="s">.clock .numbers</span>
<span class="s">{</span>
<span class="s">position: absolute;</span>
<span class="s">inset: 35px;</span>
<span class="s">background: #152b4a;</span>
<span class="s">border-radius: 50%;</span>
<span class="s">box-shadow: 5px 5px 15px #152b4a66,</span>
<span class="s">inset 5px 5px 5px rgba(255,255,255,0.55),</span>
<span class="s">-6px -6px 10px rgba(255,255,255,1);</span>
<span class="s">}</span>
<span class="s">.clock .numbers span</span>
<span class="s">{</span>
<span class="s">position: absolute;</span>
<span class="s">inset: 5px;</span>
<span class="s">text-align: center;</span>
<span class="s">color: #fff;</span>
<span class="s">font-size: 1.25em;</span>
<span class="s">transform: rotate(calc(90deg * var(--i)));</span>
<span class="s">}</span>
<span class="s">.clock .numbers span b</span>
<span class="s">{</span>
<span class="s">font-weight: 600;</span>
<span class="s">display: inline-block;</span>
<span class="s">transform: rotate(calc(-90deg * var(--i)));</span>
<span class="s">}</span>
<span class="s">.clock .numbers::before</span>
<span class="s">{</span>
<span class="s">content: &#39;&#39;;</span>
<span class="s">position: absolute;</span>
<span class="s">inset: 35px;</span>
<span class="s">background: linear-gradient(#2196f3,#e91e63);</span>
<span class="s">border-radius: 50%;</span>
<span class="s">animation: animate 2s linear infinite;</span>
<span class="s">}</span>
<span class="s">@keyframes animate</span>
<span class="s">{</span>
<span class="s">0%</span>
<span class="s">{</span>
<span class="s">transform: rotate(360deg);</span>
<span class="s">}</span>
<span class="s">100%</span>
<span class="s">{</span>
<span class="s">transform: rotate(0deg);</span>
<span class="s">}</span>
<span class="s">}</span>
<span class="s">.clock .numbers::after</span>
<span class="s">{</span>
<span class="s">content: &#39;&#39;;</span>
<span class="s">position: absolute;</span>
<span class="s">inset: 38px;</span>
<span class="s">background: #152b4a;</span>
<span class="s">border-radius: 50%;</span>
<span class="s">}</span>
<span class="s">.clock .numbers .circle</span>
<span class="s">{</span>
<span class="s">position: absolute;</span>
<span class="s">inset: 0;</span>
<span class="s">border-radius: 50%;</span>
<span class="s">display: flex;</span>
<span class="s">justify-content: center;</span>
<span class="s">z-index: 10;</span>
<span class="s">}</span>
<span class="s">.clock .numbers .circle i</span>
<span class="s">{</span>
<span class="s">position: absolute;</span>
<span class="s">width: 3px;</span>
<span class="s">height: 50%;</span>
<span class="s">background: #fff;</span>
<span class="s">transform-origin: bottom;</span>
<span class="s">}</span>
<span class="s">.clock .numbers .circle#hr i </span>
<span class="s">{</span>
<span class="s">transform: scaleY(0.3);</span>
<span class="s">width: 4px;</span>
<span class="s">}</span>
<span class="s">.clock .numbers .circle#mn i </span>
<span class="s">{</span>
<span class="s">transform: scaleY(0.45);</span>
<span class="s">}</span>
<span class="s">.clock .numbers .circle#sc i </span>
<span class="s">{</span>
<span class="s">width: 2px;</span>
<span class="s">transform: scaleY(0.55);</span>
<span class="s">background: #e91e63;</span>
<span class="s">box-shadow: 0 30px 0 #e91e63;</span>
<span class="s">}</span>
<span class="s">&lt;/style&gt;</span>
<span class="s">&lt;/head&gt;</span>
<span class="s">&lt;body&gt;</span>
<span class="s">&lt;div class=&quot;clock&quot;&gt;</span>
<span class="s">&lt;div class=&quot;numbers&quot;&gt;</span>
<span class="s">&lt;span style=&quot;--i:0;&quot;&gt;&lt;b&gt;12&lt;/b&gt;&lt;/span&gt;</span>
<span class="s">&lt;span style=&quot;--i:1;&quot;&gt;&lt;b&gt;3&lt;/b&gt;&lt;/span&gt;</span>
<span class="s">&lt;span style=&quot;--i:2;&quot;&gt;&lt;b&gt;6&lt;/b&gt;&lt;/span&gt;</span>
<span class="s">&lt;span style=&quot;--i:3;&quot;&gt;&lt;b&gt;9&lt;/b&gt;&lt;/span&gt;</span>
<span class="s">&lt;div class=&quot;circle&quot; id=&quot;hr&quot;&gt;&lt;i&gt;&lt;/i&gt;&lt;/div&gt;</span>
<span class="s">&lt;div class=&quot;circle&quot; id=&quot;mn&quot;&gt;&lt;i&gt;&lt;/i&gt;&lt;/div&gt;</span>
<span class="s">&lt;div class=&quot;circle&quot; id=&quot;sc&quot;&gt;&lt;i&gt;&lt;/i&gt;&lt;/div&gt;</span>
<span class="s">&lt;/div&gt;</span>
<span class="s">&lt;/div&gt;</span>
<span class="s">&lt;script&gt;</span>
<span class="s">let hr = document.querySelector(&#39;#hr&#39;);</span>
<span class="s">let mn = document.querySelector(&#39;#mn&#39;);</span>
<span class="s">let sc = document.querySelector(&#39;#sc&#39;);</span>

<span class="s">setInterval(()=&gt;{</span>
<span class="s">let day = new Date();</span>
<span class="s">let hh = day.getHours() * 30;</span>
<span class="s">let mm = day.getMinutes() * 6;</span>
<span class="s">let ss = day.getSeconds() * 6;</span>

<span class="s">hr.style.transform = &#39;rotateZ(&#39; + hh+(mm/12) + &#39;deg)&#39;;</span>
<span class="s">mn.style.transform = &#39;rotateZ(&#39; + mm + &#39;deg)&#39;;</span>
<span class="s">sc.style.transform = &#39;rotateZ(&#39; + ss + &#39;deg)&#39;;</span>
<span class="s">})</span>
<span class="s">&lt;/script&gt;</span>
<span class="s">&lt;/body&gt;</span>
<span class="s">&lt;/html&gt;</span>
<span class="s">`</span>
<span class="w">    </span><span class="nx">req</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Write</span><span class="p">(</span><span class="nx">html</span><span class="p">)</span>
</pre></div>
<p><strong>格式化数据填充</strong></p>
<div class="highlight"><pre><span></span><span class="nx">html</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">`</span>
<span class="s">&lt;div&gt;姓名：%s&lt;/div&gt;</span>
<span class="s">&lt;div&gt;年龄：%d&lt;/div&gt;</span>
<span class="s">`</span>
<span class="nx">req</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Writef</span><span class="p">(</span><span class="nx">html</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;林黛玉&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">)</span>
</pre></div>
<h2>JSON数据返回</h2>
<p>GoFrame中可以通过以下方法返回JSON数据：</p>
<div class="highlight"><pre><span></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">Response</span><span class="p">)</span><span class="w"> </span><span class="nx">WriteJson</span><span class="p">(</span><span class="nx">content</span><span class="w"> </span><span class="kd">interface</span><span class="p">{})</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">Response</span><span class="p">)</span><span class="w"> </span><span class="nx">WriteJsonExit</span><span class="p">(</span><span class="nx">content</span><span class="w"> </span><span class="kd">interface</span><span class="p">{})</span>
</pre></div>
<p>通过以上方法，会直接将参数内容进行JSON转换之后返回到客户端，并且将响应头中<code>Content-Type</code>设置为 <code>application/json</code>。</p>
<h2>模板内容返回</h2>
<p>前面可以用<code>writef</code>将数据格式化到HTML内容当中，但这样的做法对于数据以及HTML文件较多的情况太过于麻烦，因此Web框架中一般会采用模板引擎，使用模板语言来进行数据渲染，简化HTML页面与后端数据的交互。</p>
<p>GoFrame中用以下方法进行模板解析和返回：</p>
<div class="highlight"><pre><span></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">Response</span><span class="p">)</span><span class="w"> </span><span class="nx">WriteTpl</span><span class="p">(</span><span class="nx">tpl</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">params</span><span class="w"> </span><span class="o">...</span><span class="nx">gview</span><span class="p">.</span><span class="nx">Params</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">Response</span><span class="p">)</span><span class="w"> </span><span class="nx">WriteTplDefault</span><span class="p">(</span><span class="nx">params</span><span class="w"> </span><span class="o">...</span><span class="nx">gview</span><span class="p">.</span><span class="nx">Params</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">Response</span><span class="p">)</span><span class="w"> </span><span class="nx">WriteTplContent</span><span class="p">(</span><span class="nx">content</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">params</span><span class="w"> </span><span class="o">...</span><span class="nx">gview</span><span class="p">.</span><span class="nx">Params</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>
</pre></div>
<p>其中最常用的是<code>WriteTpl</code>，详细内容后面模板引擎内容里面再说，现在简单理解为该方法可以读取一个html文件，并将其返回给客户端。默认模板文件存放在<code>resource/template</code>下面，因此<code>WriteTpl</code>的第一个参数为对应的模板html文件相对于<code>template</code>的路径</p>
<p>示例：</p>
<div class="highlight"><pre><span></span><span class="nx">req</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">WriteTpl</span><span class="p">(</span><span class="s">&quot;index.html&quot;</span><span class="p">)</span>
<span class="nx">req</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">WriteTpl</span><span class="p">(</span><span class="s">&quot;user/index.html&quot;</span><span class="p">)</span>
</pre></div>
<h2>API数据返回</h2>
<p>现在Web应用多是前后端分离，返回数据为JSON格式，前面所说的<code>WriteJson</code>这样的方法只是单纯将提供的数据进行JSON转换后返回，在实际开发中，返回的JSON数据通常为以 下结构（具体项目会有差异，但基本都是类似结构）：</p>
<div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;code&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="c1">// 自定义编码，用来表示请求成功与失败</span>
<span class="w">    </span><span class="nt">&quot;msg&quot;</span><span class="p">:</span><span class="s2">&quot;请求成功&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// 提示信息，如果请求出错则为错误信息</span>
<span class="w">    </span><span class="nt">&quot;data&quot;</span><span class="p">:{}</span><span class="w">  </span><span class="c1">// 请求返回数据，请求出错一般为null</span>
<span class="p">}</span>
</pre></div>
<p>GoFrame为前后端分离的API开发提供了很好的支持，只需要借助<code>api</code>模块就可以方便完成类似的返回结构，不需要自行定义。</p>
<p>操作步骤如下：</p>
<ul>
<li>在<code>api</code>中定义请求与响应数据结构</li>
</ul>
<div class="highlight"><pre><span></span><span class="kd">type</span><span class="w"> </span><span class="nx">ApiReq</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">g</span><span class="p">.</span><span class="nx">Meta</span><span class="w"> </span><span class="s">`path:&quot;/api&quot; method:&quot;all&quot;`</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">ApiRes</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">UserName</span><span class="w"> </span><span class="kt">string</span><span class="w">    </span><span class="s">`json:&quot;name&quot;`</span>
<span class="w">    </span><span class="nx">UserAge</span><span class="w">  </span><span class="kt">int</span><span class="w">    </span><span class="s">`json:&quot;age&quot;`</span>
<span class="w">    </span><span class="nx">List</span><span class="w">     </span><span class="nx">g</span><span class="p">.</span><span class="nx">Array</span><span class="w"> </span><span class="s">`json:&quot;list&quot;`</span>
<span class="p">}</span>
</pre></div>
<ul>
<li>在控制器中定义对应的方法</li>
</ul>
<div class="highlight"><pre><span></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Controller</span><span class="p">)</span><span class="w"> </span><span class="nx">Api</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">req</span><span class="w"> </span><span class="o">*</span><span class="nx">api</span><span class="p">.</span><span class="nx">ApiReq</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="o">*</span><span class="nx">api</span><span class="p">.</span><span class="nx">ApiRes</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span>
<span class="p">}</span>
</pre></div>
<p><strong>实例化返回数据并返回</strong></p>
<div class="highlight"><pre><span></span><span class="nx">res</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">api</span><span class="p">.</span><span class="nx">ApiRes</span><span class="p">{</span>
<span class="w">    </span><span class="nx">UserName</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;张三&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">UserAge</span><span class="p">:</span><span class="w">  </span><span class="mi">120</span><span class="p">,</span>
<span class="w">    </span><span class="nx">List</span><span class="p">:</span><span class="w">     </span><span class="nx">g</span><span class="p">.</span><span class="nx">Array</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">},</span>
<span class="p">}</span>
<span class="k">return</span>
</pre></div>
<p><strong>如果有错误，定义错误信息并直接返回</strong></p>
<div class="highlight"><pre><span></span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">gerror</span><span class="p">.</span><span class="nx">Newf</span><span class="p">(</span><span class="s">&quot;服务器开小差了&quot;</span><span class="p">)</span>
<span class="k">return</span>
</pre></div>
<p>用上述方法返回数据，会自动返回如下格式JSON数据</p>
<div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;code&quot;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;data&quot;</span><span class="p">:{</span>
<span class="w">        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="s2">&quot;张三&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;age&quot;</span><span class="p">:</span><span class="mi">120</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;list&quot;</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>以上数据格式是通过中间件<code>ghttp.MiddlewareHandlerResponse</code>实现的，实际应用当中可以仿照这一中间件自行定义中间件来确定需要的数据返回格式。</p>
<h1>数据库</h1>
<h2>数据库准备</h2>
<p>需要先安装MySQL数据库(也可以使用其他数据库，本教程以MySQL为例)，安装过程如果不了解的可以在B站搜一下MySQL相关教程。</p>
<ul>
<li><p>创建一个<code>goframe</code>数据库，字符集为<code>utf8</code></p>
</li>
<li><p>运行下列SQL，创建测试数据表</p>
</li>
</ul>
<div class="highlight"><pre><span></span><span class="k">USE</span><span class="w"> </span><span class="n n-Quoted">`goframe`</span><span class="p">;</span>

<span class="cm">/*Table structure for table `book` */</span>

<span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n n-Quoted">`book`</span><span class="p">;</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n n-Quoted">`book`</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n n-Quoted">`id`</span><span class="w"> </span><span class="kt">INT</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="k">UNSIGNED</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="w"> </span><span class="k">AUTO_INCREMENT</span><span class="w"> </span><span class="k">COMMENT</span><span class="w"> </span><span class="s1">&#39;ID&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="n n-Quoted">`name`</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="w"> </span><span class="k">COMMENT</span><span class="w"> </span><span class="s1">&#39;书名&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="n n-Quoted">`author`</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="w"> </span><span class="k">COMMENT</span><span class="w"> </span><span class="s1">&#39;作者&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="n n-Quoted">`price`</span><span class="w"> </span><span class="kt">DOUBLE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="w"> </span><span class="k">COMMENT</span><span class="w"> </span><span class="s1">&#39;价格&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="n n-Quoted">`publish_time`</span><span class="w"> </span><span class="kt">DATE</span><span class="w"> </span><span class="k">COMMENT</span><span class="w"> </span><span class="s1">&#39;出版时间&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n n-Quoted">`id`</span><span class="p">)</span>
<span class="p">)</span><span class="w"> </span><span class="k">ENGINE</span><span class="o">=</span><span class="n">INNODB</span><span class="w"> </span><span class="k">AUTO_INCREMENT</span><span class="o">=</span><span class="mi">7</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span>

<span class="cm">/*Data for the table `book` */</span>

<span class="k">INSERT</span><span class="w">  </span><span class="k">INTO</span><span class="w"> </span><span class="n n-Quoted">`book`</span><span class="p">(</span><span class="n n-Quoted">`id`</span><span class="p">,</span><span class="n n-Quoted">`name`</span><span class="p">,</span><span class="n n-Quoted">`author`</span><span class="p">,</span><span class="n n-Quoted">`price`</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span>
<span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;MySQL数据库从入门到精通&#39;</span><span class="p">,</span><span class="s1">&#39;王飞飞&#39;</span><span class="p">,</span><span class="mf">59.8</span><span class="p">),</span>
<span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;设计模式&#39;</span><span class="p">,</span><span class="s1">&#39;刘伟&#39;</span><span class="p">,</span><span class="mi">45</span><span class="p">),</span>
<span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;数据库原理及应用&#39;</span><span class="p">,</span><span class="s1">&#39;刘亮&#39;</span><span class="p">,</span><span class="mi">33</span><span class="p">),</span>
<span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="s1">&#39;Linux驱动开发入门与实践&#39;</span><span class="p">,</span><span class="s1">&#39;郑强&#39;</span><span class="p">,</span><span class="mi">69</span><span class="p">),</span>
<span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="s1">&#39;Linux驱动开发入门与实践&#39;</span><span class="p">,</span><span class="s1">&#39;郑强&#39;</span><span class="p">,</span><span class="mi">69</span><span class="p">),</span>
<span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;Linux驱动开发入门与实践&#39;</span><span class="p">,</span><span class="s1">&#39;郑强&#39;</span><span class="p">,</span><span class="mi">69</span><span class="p">);</span>

<span class="cm">/*Table structure for table `dept` */</span>

<span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n n-Quoted">`dept`</span><span class="p">;</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n n-Quoted">`dept`</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n n-Quoted">`id`</span><span class="w"> </span><span class="kt">INT</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="k">UNSIGNED</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="w"> </span><span class="k">AUTO_INCREMENT</span><span class="w"> </span><span class="k">COMMENT</span><span class="w"> </span><span class="s1">&#39;ID&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="n n-Quoted">`pid`</span><span class="w"> </span><span class="kt">INT</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="k">UNSIGNED</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="no">NULL</span><span class="w"> </span><span class="k">COMMENT</span><span class="w"> </span><span class="s1">&#39;上级部门ID&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="n n-Quoted">`name`</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="no">NULL</span><span class="w"> </span><span class="k">COMMENT</span><span class="w"> </span><span class="s1">&#39;部门名称&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="n n-Quoted">`leader`</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="no">NULL</span><span class="w"> </span><span class="k">COMMENT</span><span class="w"> </span><span class="s1">&#39;部门领导&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="n n-Quoted">`phone`</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="no">NULL</span><span class="w"> </span><span class="k">COMMENT</span><span class="w"> </span><span class="s1">&#39;联系电话&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n n-Quoted">`id`</span><span class="p">)</span>
<span class="p">)</span><span class="w"> </span><span class="k">ENGINE</span><span class="o">=</span><span class="n">INNODB</span><span class="w"> </span><span class="k">AUTO_INCREMENT</span><span class="o">=</span><span class="mi">108</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span>

<span class="cm">/*Data for the table `dept` */</span>

<span class="k">INSERT</span><span class="w">  </span><span class="k">INTO</span><span class="w"> </span><span class="n n-Quoted">`dept`</span><span class="p">(</span><span class="n n-Quoted">`id`</span><span class="p">,</span><span class="n n-Quoted">`pid`</span><span class="p">,</span><span class="n n-Quoted">`name`</span><span class="p">,</span><span class="n n-Quoted">`leader`</span><span class="p">,</span><span class="n n-Quoted">`phone`</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span>
<span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;哪都通&#39;</span><span class="p">,</span><span class="s1">&#39;赵方旭&#39;</span><span class="p">,</span><span class="s1">&#39;10000000000&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="mi">101</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="s1">&#39;华北大区&#39;</span><span class="p">,</span><span class="s1">&#39;徐四&#39;</span><span class="p">,</span><span class="s1">&#39;10000000001&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="mi">102</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="s1">&#39;东北大区&#39;</span><span class="p">,</span><span class="s1">&#39;高廉&#39;</span><span class="p">,</span><span class="s1">&#39;10000000002&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="mi">103</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="s1">&#39;华东大区&#39;</span><span class="p">,</span><span class="s1">&#39;窦乐&#39;</span><span class="p">,</span><span class="s1">&#39;10000000003&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="mi">104</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="s1">&#39;华中大区&#39;</span><span class="p">,</span><span class="s1">&#39;任菲&#39;</span><span class="p">,</span><span class="s1">&#39;10000000004&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="mi">105</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="s1">&#39;华南大区&#39;</span><span class="p">,</span><span class="no">NULL</span><span class="p">,</span><span class="no">NULL</span><span class="p">),</span>
<span class="p">(</span><span class="mi">106</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="s1">&#39;西北大区&#39;</span><span class="p">,</span><span class="s1">&#39;华风&#39;</span><span class="p">,</span><span class="s1">&#39;10000000005&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="mi">107</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="s1">&#39;西南大区&#39;</span><span class="p">,</span><span class="s1">&#39;郝意&#39;</span><span class="p">,</span><span class="s1">&#39;10000000006&#39;</span><span class="p">);</span>

<span class="cm">/*Table structure for table `emp` */</span>

<span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n n-Quoted">`emp`</span><span class="p">;</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n n-Quoted">`emp`</span><span class="w"> </span><span class="p">(</span>
<span class="w">  </span><span class="n n-Quoted">`id`</span><span class="w"> </span><span class="kt">INT</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="k">UNSIGNED</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="w"> </span><span class="k">AUTO_INCREMENT</span><span class="w"> </span><span class="k">COMMENT</span><span class="w"> </span><span class="s1">&#39;ID&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="n n-Quoted">`dept_id`</span><span class="w"> </span><span class="kt">INT</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="k">UNSIGNED</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="w"> </span><span class="k">COMMENT</span><span class="w"> </span><span class="s1">&#39;所属部门&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="n n-Quoted">`name`</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="w"> </span><span class="k">COMMENT</span><span class="w"> </span><span class="s1">&#39;姓名&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="n n-Quoted">`gender`</span><span class="w"> </span><span class="kt">TINYINT</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="no">NULL</span><span class="w"> </span><span class="k">COMMENT</span><span class="w"> </span><span class="s1">&#39;性别: 0=男 1=女&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="n n-Quoted">`phone`</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="no">NULL</span><span class="w"> </span><span class="k">COMMENT</span><span class="w"> </span><span class="s1">&#39;联系电话&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="n n-Quoted">`email`</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="no">NULL</span><span class="w"> </span><span class="k">COMMENT</span><span class="w"> </span><span class="s1">&#39;邮箱&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="n n-Quoted">`avatar`</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="no">NULL</span><span class="w"> </span><span class="k">COMMENT</span><span class="w"> </span><span class="s1">&#39;照片&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n n-Quoted">`id`</span><span class="p">)</span>
<span class="p">)</span><span class="w"> </span><span class="k">ENGINE</span><span class="o">=</span><span class="n">INNODB</span><span class="w"> </span><span class="k">AUTO_INCREMENT</span><span class="o">=</span><span class="mi">15</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span>

<span class="cm">/*Data for the table `emp` */</span>

<span class="k">INSERT</span><span class="w">  </span><span class="k">INTO</span><span class="w"> </span><span class="n n-Quoted">`emp`</span><span class="p">(</span><span class="n n-Quoted">`id`</span><span class="p">,</span><span class="n n-Quoted">`dept_id`</span><span class="p">,</span><span class="n n-Quoted">`name`</span><span class="p">,</span><span class="n n-Quoted">`gender`</span><span class="p">,</span><span class="n n-Quoted">`phone`</span><span class="p">,</span><span class="n n-Quoted">`email`</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span>
<span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="s1">&#39;赵方旭&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;10000000000&#39;</span><span class="p">,</span><span class="s1">&#39;zhaofx@nadoutong.com&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="s1">&#39;毕游龙&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;10000000007&#39;</span><span class="p">,</span><span class="s1">&#39;biyoulong@nadoutong.com&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="s1">&#39;黄伯仁&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;10000000008&#39;</span><span class="p">,</span><span class="s1">&#39;huangboren@nadoutong.com&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">101</span><span class="p">,</span><span class="s1">&#39;徐四&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;10000000001&#39;</span><span class="p">,</span><span class="s1">&#39;xusi@nadoutong.com&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">101</span><span class="p">,</span><span class="s1">&#39;徐三&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;10000000009&#39;</span><span class="p">,</span><span class="s1">&#39;xusan@nadoutong.com&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">101</span><span class="p">,</span><span class="s1">&#39;冯宝宝&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;10000000010&#39;</span><span class="p">,</span><span class="s1">&#39;fengbaobao@nadoutong.com&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">101</span><span class="p">,</span><span class="s1">&#39;张楚岚&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;10000000011&#39;</span><span class="p">,</span><span class="s1">&#39;zhangchulan@nadoutong.com&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">102</span><span class="p">,</span><span class="s1">&#39;高廉&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;10000000002&#39;</span><span class="p">,</span><span class="s1">&#39;gaolian@nadoutong.com&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">102</span><span class="p">,</span><span class="s1">&#39;高二壮&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;10000000012&#39;</span><span class="p">,</span><span class="s1">&#39;gaoerzhuang@nadoutong.com&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">103</span><span class="p">,</span><span class="s1">&#39;窦乐&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;10000000003&#39;</span><span class="p">,</span><span class="s1">&#39;doule@nadoutong.com&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="mi">103</span><span class="p">,</span><span class="s1">&#39;肖自在&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;10000000013&#39;</span><span class="p">,</span><span class="s1">&#39;xiaozizai@nadoutong.com&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">104</span><span class="p">,</span><span class="s1">&#39;任菲&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;10000000004&#39;</span><span class="p">,</span><span class="s1">&#39;renfei@nadoutong.com&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="mi">106</span><span class="p">,</span><span class="s1">&#39;华风&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;10000000005&#39;</span><span class="p">,</span><span class="s1">&#39;huafeng@nadoutong.com&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">107</span><span class="p">,</span><span class="s1">&#39;郝意&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;10000000006&#39;</span><span class="p">,</span><span class="s1">&#39;huafeng@nadoutong.com&#39;</span><span class="p">);</span>

<span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n n-Quoted">`hobby`</span><span class="p">;</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n n-Quoted">`hobby`</span><span class="w"> </span><span class="p">(</span><span class="w">  </span>
<span class="w">  </span><span class="n n-Quoted">`id`</span><span class="w"> </span><span class="kt">INT</span><span class="w"> </span><span class="k">UNSIGNED</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="w"> </span><span class="k">AUTO_INCREMENT</span><span class="w"> </span><span class="k">COMMENT</span><span class="w"> </span><span class="s1">&#39;ID&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="n n-Quoted">`emp_id`</span><span class="w"> </span><span class="kt">INT</span><span class="w"> </span><span class="k">UNSIGNED</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="w"> </span><span class="k">COMMENT</span><span class="w"> </span><span class="s1">&#39;EmpID&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="n n-Quoted">`hobby`</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">COMMENT</span><span class="w"> </span><span class="s1">&#39;爱好&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n n-Quoted">`id`</span><span class="p">)</span><span class="w"> </span>
<span class="p">)</span><span class="w"> </span><span class="k">ENGINE</span><span class="o">=</span><span class="n">INNODB</span><span class="w"> </span><span class="k">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="w"> </span><span class="k">COLLATE</span><span class="o">=</span><span class="n">utf8_general_ci</span><span class="p">;</span>

<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n n-Quoted">`hobby`</span><span class="w"> </span><span class="p">(</span><span class="n n-Quoted">`id`</span><span class="p">,</span><span class="w"> </span><span class="n n-Quoted">`emp_id`</span><span class="p">,</span><span class="w"> </span><span class="n n-Quoted">`hobby`</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span>
<span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;埋人&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;看美女&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;月下遛鸟&#39;</span><span class="p">);</span>

<span class="k">DROP</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="k">IF</span><span class="w"> </span><span class="k">EXISTS</span><span class="w"> </span><span class="n n-Quoted">`user`</span><span class="p">;</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n n-Quoted">`user`</span><span class="w"> </span><span class="p">(</span><span class="w">  </span>
<span class="w">  </span><span class="n n-Quoted">`id`</span><span class="w"> </span><span class="kt">INT</span><span class="w"> </span><span class="k">UNSIGNED</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="w"> </span><span class="k">AUTO_INCREMENT</span><span class="w"> </span><span class="k">COMMENT</span><span class="w"> </span><span class="s1">&#39;ID&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="n n-Quoted">`username`</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="no">NULL</span><span class="w"> </span><span class="k">COMMENT</span><span class="w"> </span><span class="s1">&#39;用户名&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="n n-Quoted">`nickname`</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span><span class="w"> </span><span class="k">COMMENT</span><span class="w"> </span><span class="s1">&#39;昵称&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="n n-Quoted">`password`</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="w"> </span><span class="k">COMMENT</span><span class="w"> </span><span class="s1">&#39;密码&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="n n-Quoted">`avatar`</span><span class="w"> </span><span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">COMMENT</span><span class="w"> </span><span class="s1">&#39;头像&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="n n-Quoted">`created_at`</span><span class="w"> </span><span class="kt">DATETIME</span><span class="w"> </span><span class="k">COMMENT</span><span class="w"> </span><span class="s1">&#39;创建时间&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n n-Quoted">`id`</span><span class="p">)</span><span class="w"> </span>
<span class="p">)</span><span class="w"> </span><span class="k">ENGINE</span><span class="o">=</span><span class="n">INNODB</span><span class="w"> </span><span class="k">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="w"> </span><span class="k">COLLATE</span><span class="o">=</span><span class="n">utf8_general_ci</span><span class="p">;</span>

<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span>
<span class="n n-Quoted">`user`</span><span class="w"> </span><span class="p">(</span><span class="n n-Quoted">`id`</span><span class="p">,</span><span class="w"> </span><span class="n n-Quoted">`username`</span><span class="p">,</span><span class="w"> </span><span class="n n-Quoted">`nickname`</span><span class="p">,</span><span class="w"> </span><span class="n n-Quoted">`password`</span><span class="p">,</span><span class="w"> </span><span class="n n-Quoted">`avatar`</span><span class="p">,</span><span class="w"> </span><span class="n n-Quoted">`created_at`</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span>
<span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;libai&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;李白&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;123456&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2023-10-08 16:57:24&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;dufu&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;杜甫&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;123456&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2023-10-08 16:57:24&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;baijuyi&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;白居易&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;123456&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2023-10-08 16:57:24&#39;</span><span class="p">);</span>
</pre></div>
<h2>数据库配置</h2>
<p>数据库内容准备完毕后，在配置文件中进行数据库配置，只需要添加如下的内容即可</p>
<p><code>manifest/config/config.yaml</code></p>
<div class="highlight"><pre><span></span><span class="nt">database</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mysql&quot;</span>
<span class="w">  </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;127.0.0.1&quot;</span>
<span class="w">  </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3306&quot;</span>
<span class="w">  </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;root&quot;</span>
<span class="w">  </span><span class="nt">pass</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;root&quot;</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;goframe&quot;</span>
<span class="w">  </span><span class="nt">timezone</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Asia/Shanghai&quot;</span>
<span class="w">  </span><span class="nt">debug</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div>
<blockquote><ul>
<li><code>type</code>：数据库类型 mysql/sqlite/pgsql/oracle等</li>
<li><code>host</code>：数据库主机</li>
<li><code>port</code>：数据库端口</li>
<li><code>user</code>：数据库连接用户名</li>
<li><code>pass</code>：数据库连接密码</li>
<li><code>name</code>：需要连接的数据库名</li>
<li><code>timezone</code>：数据库时区，设置为<code>Asia/Shanghai</code>或者<code>Local</code>，不设置的话会出现时间转换混乱</li>
<li><code>debug</code>：是否开启调试，学习及开发阶段可开启调试，查看数据库操作相关信息输出</li>
</ul>
</blockquote>
<p>以上为连接数据库最简单的配置。如果需要进行更复杂的配置可查阅官方文档<a href="">ORM使用配置</a></p>
<p>上述配置可以简化为一个<code>link</code>，格式为<code>type:user:password@tcp(host:prot)/dbname?param1=value1&amp;..</code></p>
<div class="highlight"><pre><span></span><span class="nt">database</span><span class="p">:</span>
<span class="w">  </span><span class="nt">debug</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">link</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mysql:root:root@tcp(127.0.0.1:3306)/goframe?loc=Local&amp;parseTime=true&quot;</span>
</pre></div>
<p>或者也可以保留上述配置，写为</p>
<div class="highlight"><pre><span></span><span class="nt">database</span><span class="p">:</span>
<span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mysql&quot;</span>
<span class="w">  </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;127.0.0.1&quot;</span>
<span class="w">  </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3306&quot;</span>
<span class="w">  </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;root&quot;</span>
<span class="w">  </span><span class="nt">pass</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;root&quot;</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;goframe&quot;</span>
<span class="w">  </span><span class="nt">timezone</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Local&quot;</span>
<span class="w">  </span><span class="nt">debug</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">link</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mysql:root:root@tcp(127.0.0.1:3306)/goframe?loc=Local&amp;parseTime=true&quot;</span>
</pre></div>
<p>这样的写法使用的是<code>link</code>，其他的单项配置不会生效。</p>
<h2>驱动添加与导入</h2>
<ul>
<li>在<code>main.go</code>中进行MySQL驱动初始化导入</li>
</ul>
<div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">_</span><span class="w"> </span><span class="s">&quot;github.com/gogf/gf/contrib/drivers/mysql/v2&quot;</span>
<span class="p">)</span>
</pre></div>
<ul>
<li>在<code>go.mod</code>中添加驱动库与版本</li>
</ul>
<div class="highlight"><pre><span></span><span class="nx">require</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">gogf</span><span class="o">/</span><span class="nx">gf</span><span class="o">/</span><span class="nx">contrib</span><span class="o">/</span><span class="nx">drivers</span><span class="o">/</span><span class="nx">mysql</span><span class="o">/</span><span class="nx">v2</span><span class="w"> </span><span class="nx">v2</span><span class="mf">.5.3</span>
<span class="w">    </span><span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">gogf</span><span class="o">/</span><span class="nx">gf</span><span class="o">/</span><span class="nx">v2</span><span class="w"> </span><span class="nx">v2</span><span class="mf">.5.3</span>
<span class="p">)</span>
</pre></div>
<ul>
<li>在命令行中进行依赖更新</li>
</ul>
<div class="highlight"><pre><span></span>go<span class="w"> </span>mod<span class="w"> </span>tidy
</pre></div>
<p>等等下载更新完成即可。</p>
<p>至此，在GoFrame中使用数据库的准备工作才准备完毕，正式进入数据库操作部分。</p>
<h2>数据库基本操作</h2>
<p><code>github.com/gogf/gf/v2/frame/g"</code>包里的<code>Model</code>函数返回一个<code>gdb.Model</code>对象，提供了一系列对数据库的操作。<code>Model</code>函数接收一个参数，为数据表名：</p>
<div class="highlight"><pre><span></span><span class="nx">md</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s">&quot;book&quot;</span><span class="p">)</span>
</pre></div>
<p>返回一个与表<code>book</code>关联的<code>Model</code></p>
<h3>查询数据</h3>
<h4>One/All/Count/Value/Array/Fields</h4>
<p><strong>查询数据库中一条数据</strong></p>
<div class="highlight"><pre><span></span><span class="nx">md</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s">&quot;book&quot;</span><span class="p">)</span>
<span class="nx">bk</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">One</span><span class="p">()</span>
<span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">req</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">WriteJson</span><span class="p">(</span><span class="nx">bk</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
<p>返回数据库中第一条数据。查询成功返回的数据为<code>map[string]*gvar.Var</code>类型，所以可以直接访问里面的每一字段：</p>
<div class="highlight"><pre><span></span><span class="nx">req</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">WriteJson</span><span class="p">(</span><span class="nx">bk</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">])</span><span class="w">  </span><span class="c1">// 返回结果中&quot;name&quot;字段</span>
</pre></div>
<p>可以用<code>gvar.Var</code>的方法对字符进行类型转换，转为需要的类型</p>
<div class="highlight"><pre><span></span><span class="nx">bk</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">].</span><span class="nx">String</span><span class="p">()</span><span class="w"> </span><span class="c1">// 转为string类型</span>
<span class="nx">bk</span><span class="p">[</span><span class="s">&quot;price&quot;</span><span class="p">].</span><span class="nx">Float32</span><span class="p">()</span><span class="w"> </span><span class="c1">// 转为float32类型</span>
</pre></div>
<p><strong>指定查询字段</strong></p>
<div class="highlight"><pre><span></span><span class="nx">bk</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">Fields</span><span class="p">(</span><span class="s">&quot;name, price&quot;</span><span class="p">).</span><span class="nx">One</span><span class="p">()</span><span class="w"> </span><span class="c1">//只查询name price两个字符</span>
<span class="c1">// 也可以写为</span>
<span class="nx">bk</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">Fields</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;price&quot;</span><span class="p">).</span><span class="nx">One</span><span class="p">()</span>
</pre></div>
<p><strong>查询多条数据</strong></p>
<div class="highlight"><pre><span></span><span class="nx">md</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s">&quot;book&quot;</span><span class="p">)</span>
<span class="nx">bk</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">All</span><span class="p">()</span>
</pre></div>
<p>该方法以切片返回数据表中所有数据，可以进行循环操作每一条数据</p>
<div class="highlight"><pre><span></span><span class="k">for</span><span class="w"> </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">bk</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">req</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Writeln</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
<p><strong>查询数据数量</strong></p>
<div class="highlight"><pre><span></span><span class="nx">md</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s">&quot;book&quot;</span><span class="p">)</span>
<span class="nx">count</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">Count</span><span class="p">()</span>
</pre></div>
<p><strong>查询一条数据指定字段</strong></p>
<div class="highlight"><pre><span></span><span class="nx">md</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s">&quot;book&quot;</span><span class="p">)</span>
<span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">Value</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span>
</pre></div>
<p><strong>查询指定列数据</strong></p>
<div class="highlight"><pre><span></span><span class="nx">md</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s">&quot;book&quot;</span><span class="p">)</span>
<span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">Array</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span>
</pre></div>
<h4>Max/Min/Sum/Avg</h4>
<p>GoFrame提供了最大最小值、求和、平均等方法</p>
<div class="highlight"><pre><span></span><span class="nx">md</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s">&quot;book&quot;</span><span class="p">)</span>

<span class="nx">max</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">Max</span><span class="p">(</span><span class="s">&quot;price&quot;</span><span class="p">)</span>
<span class="nx">min</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">Min</span><span class="p">(</span><span class="s">&quot;price&quot;</span><span class="p">)</span>
<span class="nx">sum</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">Sum</span><span class="p">(</span><span class="s">&quot;price&quot;</span><span class="p">)</span>
<span class="nx">avg</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">Avg</span><span class="p">(</span><span class="s">&quot;price&quot;</span><span class="p">)</span>
</pre></div>
<h4>Where/Where*/WhereOr/WhereOr*</h4>
<p>查询数据时可以通过<code>Where</code>方法指定条件，如果有多个<code>Where</code>，则多个条件之间会用<code>AND</code>连接</p>
<p><strong>等于</strong></p>
<p>默认情况下条件会用<kbd>=</kbd>连接</p>
<div class="highlight"><pre><span></span><span class="nx">md</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s">&quot;book&quot;</span><span class="p">)</span>
<span class="nx">books</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">).</span><span class="nx">All</span><span class="p">()</span>
</pre></div>
<p><strong>不等</strong></p>
<p>如果是不等关系，需要在字段后面加上不等符号</p>
<div class="highlight"><pre><span></span><span class="nx">md</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s">&quot;book&quot;</span><span class="p">)</span>
<span class="nx">books</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;id&gt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">).</span><span class="nx">All</span><span class="p">()</span>
</pre></div>
<p><strong>多个条件叠加</strong></p>
<p>有多个条件时可以多个<code>Where</code>进行链式调用，条件会用<code>AND</code>连接。</p>
<div class="highlight"><pre><span></span><span class="nx">md</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s">&quot;book&quot;</span><span class="p">)</span>
<span class="nx">books</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;id&gt;=?&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">).</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;id&lt;?&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">).</span><span class="nx">All</span><span class="p">()</span>
</pre></div>
<p><strong>Where系列方法</strong></p>
<table>
<thead><tr>
<th style="text-align:center">方法</th>
<th style="text-align:center">生成的SQL条件表达式</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">WhereLT(column, value)</td>
<td style="text-align:center">column &lt; value</td>
</tr>
<tr>
<td style="text-align:center">WhereLTE(column, value)</td>
<td style="text-align:center">column &lt;= value</td>
</tr>
<tr>
<td style="text-align:center">WhereGT(column, value)</td>
<td style="text-align:center">column &gt; value</td>
</tr>
<tr>
<td style="text-align:center">WhereGTE(column, value)</td>
<td style="text-align:center">column &gt;= value</td>
</tr>
<tr>
<td style="text-align:center">WhereBetween(column, min, max)</td>
<td style="text-align:center">column BETWEEN min AND max</td>
</tr>
<tr>
<td style="text-align:center">WhereNotBetween(column, min, max)</td>
<td style="text-align:center">column NOT BETWEEN min AND max</td>
</tr>
<tr>
<td style="text-align:center">WhereLike(column, like)</td>
<td style="text-align:center">column LIKE like</td>
</tr>
<tr>
<td style="text-align:center">WhereIn(column, in)</td>
<td style="text-align:center">column IN (in)</td>
</tr>
<tr>
<td style="text-align:center">WhereNotIn(column, in)</td>
<td style="text-align:center">column NOT IN (in)</td>
</tr>
<tr>
<td style="text-align:center">WhereNot(column, value)</td>
<td style="text-align:center">column != value</td>
</tr>
<tr>
<td style="text-align:center">WhereNull(columns1, columns2... )</td>
<td style="text-align:center">columns1 IS NULL AND columns2 IS NULL...</td>
</tr>
<tr>
<td style="text-align:center">WhereNotNull(columns1, columns2... )</td>
<td style="text-align:center">columns1 IS NOT NULL AND columns2 IS NOT NULL ...</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<p>使用示例：</p>
<div class="highlight"><pre><span></span><span class="nx">md</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s">&quot;book&quot;</span><span class="p">)</span>
<span class="nx">books</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">WhereIn</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Array</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">}).</span><span class="nx">WhereLike</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%数据%&quot;</span><span class="p">).</span><span class="nx">All</span><span class="p">()</span>

<span class="c1">// 生成如下SQL</span>
<span class="c1">// SELECT * FROM `book` WHERE (`id` IN (1,2,3)) AND (`name` LIKE &#39;%数据%&#39;)</span>
</pre></div>
<p>以上方法如果链式调用会生成以<code>AND</code>连接的条件，如果需要生成以<code>OR</code>连接的条件，则需要用到下列方法：</p>
<p><strong>WhereOr系列方法</strong></p>
<table>
<thead><tr>
<th style="text-align:center">方法</th>
<th style="text-align:center">生成的SQL条件表达式</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">WhereOrLT(column, value)</td>
<td style="text-align:center">OR (column &lt; value)</td>
</tr>
<tr>
<td style="text-align:center">WhereOrLTE(column, value)</td>
<td style="text-align:center">OR (column &lt;= value)</td>
</tr>
<tr>
<td style="text-align:center">WhereOrGT(column, value)</td>
<td style="text-align:center">OR  (column &gt; value)</td>
</tr>
<tr>
<td style="text-align:center">WhereOrGTE(column, value)</td>
<td style="text-align:center">OR (column &gt;= value)</td>
</tr>
<tr>
<td style="text-align:center">WhereOrBetween(column, min, max)</td>
<td style="text-align:center">OR (column BETWEEN min AND max)</td>
</tr>
<tr>
<td style="text-align:center">WhereOrNotBetween(column, min, max)</td>
<td style="text-align:center">OR (column NOT BETWEEN min AND max)</td>
</tr>
<tr>
<td style="text-align:center">WhereOrLike(column, like)</td>
<td style="text-align:center">OR (column LIKE like)</td>
</tr>
<tr>
<td style="text-align:center">WhereOrIn(column, in)</td>
<td style="text-align:center">OR (column IN (in))</td>
</tr>
<tr>
<td style="text-align:center">WhereOrNotIn(column, in)</td>
<td style="text-align:center">OR (column NOT IN (in))</td>
</tr>
<tr>
<td style="text-align:center">WhereOrNot(column, value)</td>
<td style="text-align:center">OR (column != value)</td>
</tr>
<tr>
<td style="text-align:center">WhereOrNull(columns1, columns2... )</td>
<td style="text-align:center">OR (columns1 IS NULL AND columns2 IS NULL...)</td>
</tr>
<tr>
<td style="text-align:center">WhereOrNotNull(columns1, columns2... )</td>
<td style="text-align:center">OR (columns1 IS NOT NULL AND columns2 IS NOT NULL ...)</td>
</tr>
<tr>
<td style="text-align:center">WhereOr(column, value)</td>
<td style="text-align:center">OR (column = value)</td>
</tr>
<tr>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<p>示例：</p>
<div class="highlight"><pre><span></span><span class="nx">md</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s">&quot;book&quot;</span><span class="p">)</span>
<span class="nx">books</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">WhereIn</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Array</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">}).</span><span class="nx">WhereOrLike</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;%数据%&quot;</span><span class="p">).</span><span class="nx">All</span><span class="p">()</span>
<span class="c1">// 生成如下SQL</span>
<span class="c1">// SELECT * FROM `book` WHERE (`id` IN (1,2,3)) OR (`name` LIKE &#39;%数据%&#39;)</span>
</pre></div>
<h4>Group/Order/Order*</h4>
<p><strong>按字段分组</strong></p>
<div class="highlight"><pre><span></span><span class="nx">md</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s">&quot;book&quot;</span><span class="p">)</span>
<span class="nx">books</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">Group</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">).</span><span class="nx">All</span><span class="p">()</span>
</pre></div>
<p><strong>按字段排序</strong></p>
<div class="highlight"><pre><span></span><span class="nx">md</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s">&quot;book&quot;</span><span class="p">)</span>
<span class="nx">books</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">Order</span><span class="p">(</span><span class="s">&quot;price&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;DESC&quot;</span><span class="p">).</span><span class="nx">All</span><span class="p">()</span>
<span class="c1">// 多字段排序</span>
<span class="nx">books</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">Order</span><span class="p">(</span><span class="s">&quot;price&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;DESC&quot;</span><span class="p">).</span><span class="nx">Order</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ASC&quot;</span><span class="p">).</span><span class="nx">All</span><span class="p">()</span>
<span class="c1">// 排序封装方法</span>
<span class="nx">books</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">OrderDesc</span><span class="p">(</span><span class="s">&quot;price&quot;</span><span class="p">).</span><span class="nx">OrderAsc</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">).</span><span class="nx">All</span><span class="p">()</span>
</pre></div>
<h4>Scan</h4>
<p><code>One</code>和<code>All</code>返回的数据为<code>Map</code>或者<code>Map</code>切片，在实际使用当中查询到的数据可能需要转换为特定的数据结构方便使用。</p>
<p><code>Scan</code>方法可以将查询到的数据转为自定义结构体或结构体数组。该方法使用方式非常灵活，示例中只演示推荐写法。</p>
<p><strong>查询数据转为自定义结构体</strong></p>
<div class="highlight"><pre><span></span><span class="kd">type</span><span class="w"> </span><span class="nx">Book</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Id</span><span class="w">          </span><span class="kt">uint</span>
<span class="w">    </span><span class="nx">Name</span><span class="w">        </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">Author</span><span class="w">      </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">Price</span><span class="w">       </span><span class="kt">float64</span>
<span class="w">    </span><span class="nx">PublishTime</span><span class="w"> </span><span class="o">*</span><span class="nx">gtime</span><span class="p">.</span><span class="nx">Time</span>
<span class="p">}</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">book</span><span class="w"> </span><span class="o">*</span><span class="nx">Book</span>

<span class="nx">md</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s">&quot;book&quot;</span><span class="p">)</span>
<span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">book</span><span class="p">)</span>
</pre></div>
<p><code>Scan</code>会将数据库字段下划线命名对应到结构体中相应的驼峰命名上，如果对应不上，则该成员为<code>nil</code>或者零值。如果结构体中成员名称与数据表中字段不对应，可以用<code>orm:</code>标签来指定对应字段</p>
<div class="highlight"><pre><span></span><span class="kd">type</span><span class="w"> </span><span class="nx">Book</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">BookId</span><span class="w">     </span><span class="kt">uint</span><span class="w">        </span><span class="s">`orm:&quot;id&quot;  `</span>
<span class="w">    </span><span class="nx">BookName</span><span class="w">   </span><span class="kt">string</span><span class="w">      </span><span class="s">`orm:&quot;name&quot;`</span>
<span class="w">    </span><span class="nx">BookAuthor</span><span class="w"> </span><span class="kt">string</span><span class="w">      </span><span class="s">`orm:&quot;author&quot;`</span>
<span class="w">    </span><span class="nx">BookPrice</span><span class="w">  </span><span class="kt">float64</span><span class="w">     </span><span class="s">`orm:&quot;price&quot;`</span>
<span class="w">    </span><span class="nx">PubTime</span><span class="w">    </span><span class="o">*</span><span class="nx">gtime</span><span class="p">.</span><span class="nx">Time</span><span class="w"> </span><span class="s">`orm:&quot;publish_time&quot;`</span>
<span class="p">}</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">book</span><span class="w"> </span><span class="o">*</span><span class="nx">Book</span>

<span class="nx">md</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s">&quot;book&quot;</span><span class="p">)</span>
<span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">book</span><span class="p">)</span>
</pre></div>
<p><strong>结构体数组</strong></p>
<p><code>Scan</code>方法可以查询单独结构体，如上，也可以查询一个结构体数组，只需要将结构体指针改为结构体切片传入即可</p>
<div class="highlight"><pre><span></span><span class="kd">type</span><span class="w"> </span><span class="nx">Book</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Id</span><span class="w">          </span><span class="kt">uint</span>
<span class="w">    </span><span class="nx">Name</span><span class="w">        </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">Author</span><span class="w">      </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">Price</span><span class="w">       </span><span class="kt">float64</span>
<span class="w">    </span><span class="nx">PublishTime</span><span class="w"> </span><span class="o">*</span><span class="nx">gtime</span><span class="p">.</span><span class="nx">Time</span>
<span class="p">}</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">book</span><span class="w"> </span><span class="p">[]</span><span class="nx">Book</span>

<span class="nx">md</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s">&quot;book&quot;</span><span class="p">)</span>
<span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">book</span><span class="p">)</span>
</pre></div>
<p>查询结果为一个由<code>Book</code>组成的结构体数组，存放多条数据。</p>
<p>查询部分暂时就先了解这些，实际上只要SQL熟悉的话每种查询基本上都能找到对应的方法来实现。更复杂的查询见官方文档<a href="">ORM查询</a></p>
<h4>查询结果为空判断</h4>
<p><strong>All</strong></p>
<div class="highlight"><pre><span></span><span class="nx">md</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s">&quot;book&quot;</span><span class="p">)</span>
<span class="nx">books</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">All</span><span class="p">()</span>
<span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">books</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">g</span><span class="p">.</span><span class="nx">RequestFromCtx</span><span class="p">(</span><span class="nx">ctx</span><span class="p">).</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Writeln</span><span class="p">(</span><span class="s">&quot;结果为空&quot;</span><span class="p">)</span>
<span class="p">}</span>
<span class="c1">// 或者</span>
<span class="k">if</span><span class="w"> </span><span class="nx">books</span><span class="p">.</span><span class="nx">IsEmpty</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">g</span><span class="p">.</span><span class="nx">RequestFromCtx</span><span class="p">(</span><span class="nx">ctx</span><span class="p">).</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Writeln</span><span class="p">(</span><span class="s">&quot;结果为空&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
<p><strong>One</strong></p>
<div class="highlight"><pre><span></span><span class="nx">md</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s">&quot;book&quot;</span><span class="p">)</span>
<span class="nx">book</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">).</span><span class="nx">One</span><span class="p">()</span>
<span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">book</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">g</span><span class="p">.</span><span class="nx">RequestFromCtx</span><span class="p">(</span><span class="nx">ctx</span><span class="p">).</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Writeln</span><span class="p">(</span><span class="s">&quot;结果为空&quot;</span><span class="p">)</span>
<span class="p">}</span>
<span class="c1">// 或者</span>
<span class="k">if</span><span class="w"> </span><span class="nx">book</span><span class="p">.</span><span class="nx">IsEmpty</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">g</span><span class="p">.</span><span class="nx">RequestFromCtx</span><span class="p">(</span><span class="nx">ctx</span><span class="p">).</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Writeln</span><span class="p">(</span><span class="s">&quot;结果为空&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
<p><strong>Value</strong></p>
<div class="highlight"><pre><span></span><span class="nx">md</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s">&quot;book&quot;</span><span class="p">)</span>
<span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">).</span><span class="nx">Value</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span>
<span class="k">if</span><span class="w"> </span><span class="nx">name</span><span class="p">.</span><span class="nx">IsEmpty</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">g</span><span class="p">.</span><span class="nx">RequestFromCtx</span><span class="p">(</span><span class="nx">ctx</span><span class="p">).</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Writeln</span><span class="p">(</span><span class="s">&quot;结果为空&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
<p><strong>Array</strong></p>
<div class="highlight"><pre><span></span><span class="nx">md</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s">&quot;book&quot;</span><span class="p">)</span>
<span class="nx">names</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">WhereLT</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">).</span><span class="nx">Array</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span>
<span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">names</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">{</span>
<span class="w">    </span><span class="nx">g</span><span class="p">.</span><span class="nx">RequestFromCtx</span><span class="p">(</span><span class="nx">ctx</span><span class="p">).</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Writeln</span><span class="p">(</span><span class="s">&quot;结果为空&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
<p><strong>Scan结构体对象</strong></p>
<div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">book</span><span class="w"> </span><span class="o">*</span><span class="nx">Book</span>
<span class="nx">md</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s">&quot;book&quot;</span><span class="p">)</span>
<span class="nx">md</span><span class="p">.</span><span class="nx">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">book</span><span class="p">)</span>
<span class="k">if</span><span class="w"> </span><span class="nx">book</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">g</span><span class="p">.</span><span class="nx">RequestFromCtx</span><span class="p">(</span><span class="nx">ctx</span><span class="p">).</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Writeln</span><span class="p">(</span><span class="s">&quot;结果为空&quot;</span><span class="p">)</span>
<span class="p">}</span>
<span class="nx">md</span><span class="p">.</span><span class="nx">Save</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
</pre></div>
<p><strong>Scan结构体数组</strong></p>
<div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">books</span><span class="w"> </span><span class="p">[]</span><span class="nx">Book</span>
<span class="nx">md</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s">&quot;book&quot;</span><span class="p">)</span>
<span class="nx">md</span><span class="p">.</span><span class="nx">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">books</span><span class="p">)</span>
<span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">books</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">g</span><span class="p">.</span><span class="nx">RequestFromCtx</span><span class="p">(</span><span class="nx">ctx</span><span class="p">).</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Writeln</span><span class="p">(</span><span class="s">&quot;结果为空&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
<h4>分页</h4>
<p>GoFrame中提供了<code>Page</code>方法可以很方便实现分页查询，只需提供页数和每页数据数量即可。</p>
<div class="highlight"><pre><span></span><span class="nx">md</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s">&quot;book&quot;</span><span class="p">)</span>
<span class="nx">books</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">Page</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">).</span><span class="nx">All</span><span class="p">()</span>
</pre></div>
<p>也有<code>Limit</code>方法可以用来限制查询条数以及自定义起始位置与数据限制</p>
<div class="highlight"><pre><span></span><span class="nx">md</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s">&quot;book&quot;</span><span class="p">)</span>
<span class="c1">// 限制条数</span>
<span class="nx">books</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">Limit</span><span class="p">(</span><span class="mi">5</span><span class="p">).</span><span class="nx">All</span><span class="p">()</span>
<span class="c1">// 指定起始位置与限制条数</span>
<span class="nx">books</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">Limit</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">).</span><span class="nx">All</span><span class="p">()</span>
</pre></div>
<h3>插入数据</h3>
<h4>Insert/Replace/Save</h4>
<p>这三个方法都可以向数据库中写入一条或者多条数据，区别在于当数据中主键字段在数据库中已经存在时，处理方式不同：</p>
<table>
<thead><tr>
<th style="text-align:center">方法</th>
<th style="text-align:center">主键在数据库中已存在时</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Insert</td>
<td style="text-align:center">报错，主键冲突</td>
</tr>
<tr>
<td style="text-align:center">Repalce</td>
<td style="text-align:center">用提供的数据替换已存在同主键的数据</td>
</tr>
<tr>
<td style="text-align:center">Save</td>
<td style="text-align:center">用提供的数据更新已存在的同主键数据</td>
</tr>
</tbody>
</table>
<p><strong>写入单条数据</strong></p>
<div class="highlight"><pre><span></span><span class="nx">md</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s">&quot;book&quot;</span><span class="p">)</span>
<span class="nx">data</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Map</span><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;id&quot;</span><span class="p">:</span><span class="w">           </span><span class="mi">8</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">         </span><span class="s">&quot;Linux驱动开发入门与实践&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;author&quot;</span><span class="p">:</span><span class="w">       </span><span class="s">&quot;郑强&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;price&quot;</span><span class="p">:</span><span class="w">        </span><span class="mi">69</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;publish_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2023-10-10&quot;</span><span class="p">,</span>
<span class="p">}</span>
<span class="c1">// Insert</span>
<span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">Insert</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
<span class="c1">// Replace</span>
<span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">Replace</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
<span class="c1">// Save</span>
<span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">Save</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
</pre></div>
<p>以上方法也可配合<code>Data</code>使用</p>
<div class="highlight"><pre><span></span><span class="c1">// Insert</span>
<span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">Data</span><span class="p">(</span><span class="nx">data</span><span class="p">).</span><span class="nx">Insert</span><span class="p">()</span>
<span class="c1">// Replace</span>
<span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">Data</span><span class="p">(</span><span class="nx">data</span><span class="p">).</span><span class="nx">Replace</span><span class="p">()</span>
<span class="c1">// Save</span>
<span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">Data</span><span class="p">(</span><span class="nx">data</span><span class="p">).</span><span class="nx">Save</span><span class="p">()</span>
</pre></div>
<p>除了使用<code>Map</code>类型之外，还可以用结构体。结构体成员名称与数据表字段名称不对应时，用<code>orm</code>标签指定</p>
<div class="highlight"><pre><span></span><span class="kd">type</span><span class="w"> </span><span class="nx">Book</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Id</span><span class="w">      </span><span class="kt">uint</span>
<span class="w">    </span><span class="nx">Name</span><span class="w">    </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">Author</span><span class="w">  </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">Price</span><span class="w">   </span><span class="kt">float64</span>
<span class="w">    </span><span class="nx">PubTime</span><span class="w"> </span><span class="o">*</span><span class="nx">gtime</span><span class="p">.</span><span class="nx">Time</span><span class="w"> </span><span class="s">`orm:&quot;publish_time&quot;`</span>
<span class="p">}</span>


<span class="nx">md</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s">&quot;book&quot;</span><span class="p">)</span>
<span class="nx">data</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Book</span><span class="p">{</span>
<span class="w">    </span><span class="nx">Id</span><span class="p">:</span><span class="w">      </span><span class="mi">8</span><span class="p">,</span>
<span class="w">    </span><span class="nx">Name</span><span class="p">:</span><span class="w">    </span><span class="s">&quot;Linux驱动开发入门与实践&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">Author</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;郑强&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">Price</span><span class="p">:</span><span class="w">   </span><span class="mf">69.3</span><span class="p">,</span>
<span class="w">    </span><span class="nx">PubTime</span><span class="p">:</span><span class="w"> </span><span class="nx">gtime</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;2023-10-10&quot;</span><span class="p">),</span>
<span class="p">}</span>
<span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">Data</span><span class="p">(</span><span class="nx">data</span><span class="p">).</span><span class="nx">Save</span><span class="p">()</span>
</pre></div>
<p><strong>批量写入数据</strong></p>
<p>上述方法也可以批量写入数据</p>
<div class="highlight"><pre><span></span><span class="nx">data</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">List</span><span class="p">{</span>
<span class="w">    </span><span class="nx">g</span><span class="p">.</span><span class="nx">Map</span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">         </span><span class="s">&quot;Linux驱动开发入门与实践&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;author&quot;</span><span class="p">:</span><span class="w">       </span><span class="s">&quot;郑强&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;price&quot;</span><span class="p">:</span><span class="w">        </span><span class="mf">69.3</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;publish_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">gtime</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;2023-10-10&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nx">g</span><span class="p">.</span><span class="nx">Map</span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">         </span><span class="s">&quot;Linux驱动开发入门与实践&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;author&quot;</span><span class="p">:</span><span class="w">       </span><span class="s">&quot;郑强&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;price&quot;</span><span class="p">:</span><span class="w">        </span><span class="mf">69.3</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;publish_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">gtime</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;2023-10-10&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nx">g</span><span class="p">.</span><span class="nx">Map</span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">         </span><span class="s">&quot;Linux驱动开发入门与实践&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;author&quot;</span><span class="p">:</span><span class="w">       </span><span class="s">&quot;郑强&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;price&quot;</span><span class="p">:</span><span class="w">        </span><span class="mf">69.3</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;publish_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">gtime</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;2023-10-10&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="p">},</span>
<span class="p">}</span>

<span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">Data</span><span class="p">(</span><span class="nx">data</span><span class="p">).</span><span class="nx">Save</span><span class="p">()</span>
</pre></div>
<p>如果使用的是结构体，将<code>g.List</code>改为<code>g.Array</code>或者<code>g.Slice</code></p>
<h4>InsertAndGetId</h4>
<p>写入数据并返回自增ID</p>
<div class="highlight"><pre><span></span><span class="nx">data</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Map</span><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">         </span><span class="s">&quot;Linux驱动开发入门与实践&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;author&quot;</span><span class="p">:</span><span class="w">       </span><span class="s">&quot;郑强&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;price&quot;</span><span class="p">:</span><span class="w">        </span><span class="mf">69.3</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;publish_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">gtime</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;2023-10-10&quot;</span><span class="p">),</span>
<span class="p">}</span>

<span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">Data</span><span class="p">(</span><span class="nx">data</span><span class="p">).</span><span class="nx">InsertAndGetId</span><span class="p">()</span>
</pre></div>
<h4>gdb.Raw</h4>
<p>对于有的字段，可能需要调用SQL里面的操作来获得结果，例如，<code>publish_time</code>字段可以用SQL中的<code>CURRENT_DATE()</code>来获取当前日期，这时就需要用到<code>Raw</code>：</p>
<div class="highlight"><pre><span></span><span class="nx">data</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Map</span><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">         </span><span class="s">&quot;Linux驱动开发入门与实践&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;author&quot;</span><span class="p">:</span><span class="w">       </span><span class="s">&quot;郑强&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;price&quot;</span><span class="p">:</span><span class="w">        </span><span class="mf">69.3</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;publish_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">gdb</span><span class="p">.</span><span class="nx">Raw</span><span class="p">(</span><span class="s">&quot;CURRENT_DATE()&quot;</span><span class="p">),</span>
<span class="p">}</span>

<span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">Data</span><span class="p">(</span><span class="nx">data</span><span class="p">).</span><span class="nx">InsertAndGetId</span><span class="p">()</span>
</pre></div>
<h3>更新数据</h3>
<h4>Update</h4>
<div class="highlight"><pre><span></span><span class="nx">data</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Map</span><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;author&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;郑强强&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;price&quot;</span><span class="p">:</span><span class="w">  </span><span class="mf">69.333</span><span class="p">,</span>
<span class="p">}</span>

<span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;author&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;郑强&quot;</span><span class="p">).</span><span class="nx">Update</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
</pre></div>
<p>也可以配合<code>Data</code>使用</p>
<div class="highlight"><pre><span></span><span class="nx">data</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Map</span><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;author&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;郑强强&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s">&quot;price&quot;</span><span class="p">:</span><span class="w">  </span><span class="mf">69.333</span><span class="p">,</span>
<span class="p">}</span>

<span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;author&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;郑强&quot;</span><span class="p">).</span><span class="nx">Data</span><span class="p">(</span><span class="nx">data</span><span class="p">).</span><span class="nx">Update</span><span class="p">()</span>
</pre></div>
<h4>Increment/Decrement</h4>
<p>用来给指定字段增加/减少指定值</p>
<div class="highlight"><pre><span></span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">WhereBetween</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">).</span><span class="nx">Increment</span><span class="p">(</span><span class="s">&quot;price&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">2.5</span><span class="p">)</span>
<span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">WhereBetween</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">).</span><span class="nx">Decrement</span><span class="p">(</span><span class="s">&quot;price&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">1.5</span><span class="p">)</span>
</pre></div>
<h3>删除数据</h3>
<div class="highlight"><pre><span></span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">WhereGT</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">).</span><span class="nx">Delete</span><span class="p">()</span>
</pre></div>
<h2>时间维护与软删除</h2>
<p>在实际应用当中，数据表中通常会有三个时间字段：创建时间、更新时间、删除时间。GoFrame支持这三个时间字段的自动填充，这三个字段支持的类型为<code>DATE</code>、<code>DATETIME</code>、<code>TIMESTAMP</code>。</p>
<ul>
<li>创建时间：默认为<code>created_at</code></li>
<li>更新时间：默认为<code>updated_at</code></li>
<li>删除时间：默认为<code>deleted_at</code>，数据软删除时使用</li>
</ul>
<p>如果不想使用默认名称，需要自行修改，可以在配置文件里数据库配置时修改，方式如下：</p>
<div class="highlight"><pre><span></span><span class="nt">database</span><span class="p">:</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">....</span>
<span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">createdAt</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;create_time&quot;</span>
<span class="w">    </span><span class="nt">updatedAt</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;update_time&quot;</span>
<span class="w">    </span><span class="nt">deletedAt</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;delete_time&quot;</span>
</pre></div>
<p><strong>软删除</strong></p>
<blockquote><p>软删除并不是真正从数据库中把记录删除，而是通过特定的标记在查询时过滤掉这些数据，使这些数据在页面上看不到，但实际上在数据库中仍然存在。通常用于一些需要历史追踪而不能真正删除的数据。</p>
</blockquote>
<p>当数据表中有<code>deleted_at</code>字段时，使用<code>Delete</code>方法时不会物理删除数据，只是更新<code>deleted_at</code>字段的值。查询数据时，会自动加上<kbd>WHERE \`deleted_at\` IS NULL</kbd>这一条件，过滤掉已被“删除”的数据。</p>
<p>如果需要查询所有数据，需要使用<code>Unscoped</code>方法</p>
<div class="highlight"><pre><span></span><span class="nx">ls</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">Unscoped</span><span class="p">().</span><span class="nx">All</span><span class="p">()</span>
</pre></div>
<h2>事务处理</h2>
<p><strong>常规写法</strong></p>
<div class="highlight"><pre><span></span><span class="nx">tx</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">DB</span><span class="p">().</span><span class="nx">Begin</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>

<span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tx</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s">&quot;book&quot;</span><span class="p">).</span><span class="nx">Data</span><span class="p">(</span><span class="nx">data</span><span class="p">).</span><span class="nx">Save</span><span class="p">()</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">tx</span><span class="p">.</span><span class="nx">Commit</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">tx</span><span class="p">.</span><span class="nx">Rollback</span><span class="p">()</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p><strong>闭包写法</strong>(框架建议写法)</p>
<div class="highlight"><pre><span></span><span class="nx">g</span><span class="p">.</span><span class="nx">DB</span><span class="p">().</span><span class="nx">Transaction</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">TODO</span><span class="p">(),</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">tx</span><span class="w"> </span><span class="nx">gdb</span><span class="p">.</span><span class="nx">TX</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">tx</span><span class="p">.</span><span class="nx">Model</span><span class="p">(</span><span class="s">&quot;book&quot;</span><span class="p">).</span><span class="nx">Ctx</span><span class="p">(</span><span class="nx">ctx</span><span class="p">).</span><span class="nx">Save</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span>
<span class="p">})</span>
</pre></div>
<h2>原生SQL的使用</h2>
<p>由<code>Model</code>提供的方法能组合出绝大多数使用场景所需要的数据操作，但如果需要的操作过于复杂，可能就没法通过已有的方法组合出来，就需要使用写SQL来实现</p>
<p><strong>查询</strong></p>
<div class="highlight"><pre><span></span><span class="nx">db</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">DB</span><span class="p">()</span>
<span class="nx">books</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">Query</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;SELECT * FROM `book` WHERE `id` &gt; ? AND `id` &lt; ?&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Array</span><span class="p">{</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">})</span>
</pre></div>
<p><strong>新增数据</strong></p>
<div class="highlight"><pre><span></span><span class="nx">db</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">DB</span><span class="p">()</span>
<span class="nx">sql</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;INSERT INTO `book` (`name`, `author`, `price`) VALUES (?, ?, ?)&quot;</span>
<span class="nx">data</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Array</span><span class="p">{</span><span class="s">&quot;Go语言从入门到精通&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Go语言研讨组&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">99.98</span><span class="p">}</span>
<span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">Exec</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">sql</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">)</span>
</pre></div>
<p>更多操作查看官方文档<a href="">ORM方法操作(原生)</a></p>
<h2>DAO自动生成与使用</h2>
<p>数据库相关的操作与数据结构放在<code>dao</code>与<code>model</code>中，在GoFrame中，<code>dao</code>与<code>model</code>的内容可以自动生成。生成步骤如下：</p>
<ol>
<li>配置<code>dao</code></li>
</ol>
<p><code>hack/comfig.yaml</code></p>
<div class="highlight"><pre><span></span><span class="nt">gfcli</span><span class="p">:</span>
<span class="w">  </span><span class="nt">gen</span><span class="p">:</span>
<span class="w">    </span><span class="nt">dao</span><span class="p">:</span>
<span class="w">      </span><span class="nt">link</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mysql:root:root@tcp(127.0.0.1:3306)/goframe&quot;</span>
<span class="w">      </span><span class="nt">tables</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;book,</span><span class="nv"> </span><span class="s">user,</span><span class="nv"> </span><span class="s">dept,</span><span class="nv"> </span><span class="s">emp,</span><span class="nv"> </span><span class="s">hobby&quot;</span>
<span class="w">      </span><span class="nt">jsonCase</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Snake&quot;</span>
</pre></div>
<blockquote><ul>
<li>link: 数据库连接url</li>
<li>tables: 需要生成dao及model的数据表，多个表用逗号隔开</li>
<li>jsonCase: entity成员转为json时的转换方式，"Snake"为把驼峰转为下划线</li>
</ul>
</blockquote>
<p>以上为最简单配置，更多配置见官方文档<a href="">代码生成/数据规范 gen dao</a>章节</p>
<ol>
<li>在命令行中执行如下命令</li>
</ol>
<div class="highlight"><pre><span></span>gf<span class="w"> </span>gen<span class="w"> </span>dao
</pre></div>
<p>该命令会生成<code>dao</code>以及<code>model</code>下各个表对应的结构与代码。</p>
<p>接下来使用各个表对应的Model对象时，不再用<code>g.Model</code>获取，而是用下面的的方式：</p>
<div class="highlight"><pre><span></span><span class="nx">md</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">dao</span><span class="p">.</span><span class="nx">Book</span><span class="p">.</span><span class="nx">Ctx</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<span class="nx">books</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">All</span><span class="p">()</span>
</pre></div>
<p>该Model对象可以多次叠加查询条件：</p>
<div class="highlight"><pre><span></span><span class="nx">md</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">dao</span><span class="p">.</span><span class="nx">Book</span><span class="p">.</span><span class="nx">Ctx</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<span class="nx">md</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">WhereGT</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
<span class="nx">md</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">WhereLT</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span>
<span class="nx">books</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">md</span><span class="p">.</span><span class="nx">All</span><span class="p">()</span>

<span class="c1">// 以上代码相当于</span>
<span class="nx">books</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">dao</span><span class="p">.</span><span class="nx">Book</span><span class="p">.</span><span class="nx">Ctx</span><span class="p">(</span><span class="nx">ctx</span><span class="p">).</span><span class="nx">WhereGT</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">).</span><span class="nx">WhereLT</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">).</span><span class="nx">All</span><span class="p">()</span>
</pre></div>
<h2>字段过滤</h2>
<p>使用结构体数据进行创建或更新数据时，尤其是在更新数据的时候，有些字段可能不需要更新，因此对应的字段就不进行赋值，例如以下代码</p>
<div class="highlight"><pre><span></span><span class="kd">type</span><span class="w"> </span><span class="nx">Book</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Id</span><span class="w">      </span><span class="kt">uint</span>
<span class="w">    </span><span class="nx">Name</span><span class="w">    </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">Author</span><span class="w">  </span><span class="kt">string</span>
<span class="w">    </span><span class="nx">Price</span><span class="w">   </span><span class="kt">float64</span>
<span class="w">    </span><span class="nx">PubTime</span><span class="w"> </span><span class="o">*</span><span class="nx">gtime</span><span class="p">.</span><span class="nx">Time</span><span class="w"> </span><span class="s">`orm:&quot;publish_time&quot;`</span>
<span class="p">}</span>

<span class="nx">data</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Book</span><span class="p">{</span>
<span class="w">    </span><span class="nx">Name</span><span class="p">:</span><span class="w">    </span><span class="s">&quot;Linux驱动开发入门与实践&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">PubTime</span><span class="p">:</span><span class="w"> </span><span class="nx">gtime</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;2023-10-11&quot;</span><span class="p">),</span>
<span class="p">}</span>

<span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">dao</span><span class="p">.</span><span class="nx">Book</span><span class="p">.</span><span class="nx">Ctx</span><span class="p">(</span><span class="nx">ctx</span><span class="p">).</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="p">).</span><span class="nx">Data</span><span class="p">(</span><span class="nx">data</span><span class="p">).</span><span class="nx">Update</span><span class="p">()</span>
</pre></div>
<p>直接这样更新，则<code>id</code>、<code>author</code>、<code>price</code>也会被对应类型的零值更新，分别被更新为0、""、0</p>
<p>要解决这样的问题，有以下几种解决方案：</p>
<p><strong>用Fields指定需要更新的字段</strong></p>
<div class="highlight"><pre><span></span><span class="nx">dao</span><span class="p">.</span><span class="nx">Book</span><span class="p">.</span><span class="nx">Ctx</span><span class="p">(</span><span class="nx">ctx</span><span class="p">).</span><span class="nx">Fields</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;publish_time&quot;</span><span class="p">).</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="p">).</span><span class="nx">Data</span><span class="p">(</span><span class="nx">data</span><span class="p">).</span><span class="nx">Update</span><span class="p">()</span>
</pre></div>
<p><strong>用FieldsEx排除不需要更新的字段</strong></p>
<div class="highlight"><pre><span></span><span class="nx">dao</span><span class="p">.</span><span class="nx">Book</span><span class="p">.</span><span class="nx">Ctx</span><span class="p">(</span><span class="nx">ctx</span><span class="p">).</span><span class="nx">FieldsEx</span><span class="p">(</span><span class="s">&quot;id,author,price&quot;</span><span class="p">).</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="p">).</span><span class="nx">Data</span><span class="p">(</span><span class="nx">data</span><span class="p">).</span><span class="nx">Update</span><span class="p">()</span>
</pre></div>
<p><strong>用OmitEmpty过滤空值</strong></p>
<div class="highlight"><pre><span></span><span class="nx">data</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Book</span><span class="p">{</span>
<span class="w">    </span><span class="nx">Name</span><span class="p">:</span><span class="w">    </span><span class="s">&quot;Linux驱动开发入门与实践&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">Price</span><span class="p">:</span><span class="w">   </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="nx">PubTime</span><span class="p">:</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span>
<span class="p">}</span>
<span class="nx">dao</span><span class="p">.</span><span class="nx">Book</span><span class="p">.</span><span class="nx">Ctx</span><span class="p">(</span><span class="nx">ctx</span><span class="p">).</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="p">).</span><span class="nx">OmitEmpty</span><span class="p">().</span><span class="nx">Data</span><span class="p">(</span><span class="nx">data</span><span class="p">).</span><span class="nx">Update</span><span class="p">()</span>
</pre></div>
<p>用这种方法如上数据中，0和<code>nil</code>也会被忽略，没法更新对应字段的值。</p>
<p><strong>使用do对象进行字段过滤</strong></p>
<p>使用<code>gf gen dao</code>时，每个表会生成一个对应的<code>do</code>对象，使用<code>do</code>对象作为参数传递，将会自动过滤空值</p>
<div class="highlight"><pre><span></span><span class="nx">data</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">do</span><span class="p">.</span><span class="nx">Book</span><span class="p">{</span>
<span class="w">    </span><span class="nx">Name</span><span class="p">:</span><span class="w">        </span><span class="s">&quot;Linux驱动开发入门与实践&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">Price</span><span class="p">:</span><span class="w">       </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="nx">PublishTime</span><span class="p">:</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span>
<span class="p">}</span>

<span class="nx">dao</span><span class="p">.</span><span class="nx">Book</span><span class="p">.</span><span class="nx">Ctx</span><span class="p">(</span><span class="nx">ctx</span><span class="p">).</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="p">).</span><span class="nx">Data</span><span class="p">(</span><span class="nx">data</span><span class="p">).</span><span class="nx">Update</span><span class="p">()</span>
</pre></div>
<p>使用这种方法，非<code>nil</code>的零值都可以更新。</p>
<p><code>do</code>对象也可以用于传递查询条件， 也会自动过滤空值</p>
<div class="highlight"><pre><span></span><span class="nx">where</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">do</span><span class="p">.</span><span class="nx">Book</span><span class="p">{</span>
<span class="w">    </span><span class="nx">Author</span><span class="p">:</span><span class="w">      </span><span class="s">&quot;郑强&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">Id</span><span class="p">:</span><span class="w">          </span><span class="mi">13</span><span class="p">,</span>
<span class="w">    </span><span class="nx">PublishTime</span><span class="p">:</span><span class="w"> </span><span class="kc">nil</span><span class="p">,</span>
<span class="p">}</span>

<span class="nx">books</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">dao</span><span class="p">.</span><span class="nx">Book</span><span class="p">.</span><span class="nx">Ctx</span><span class="p">(</span><span class="nx">ctx</span><span class="p">).</span><span class="nx">Where</span><span class="p">(</span><span class="nx">where</span><span class="p">).</span><span class="nx">All</span><span class="p">()</span>
<span class="c1">// 相当于</span>
<span class="nx">books</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">dao</span><span class="p">.</span><span class="nx">Book</span><span class="p">.</span><span class="nx">Ctx</span><span class="p">(</span><span class="nx">ctx</span><span class="p">).</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="p">).</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;author&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;郑强&quot;</span><span class="p">).</span><span class="nx">All</span><span class="p">()</span>
</pre></div>
<h2>关联查询</h2>
<p>多表数据联查时可以用连接，但是数据量大时连接效率不高，GoFrame中提供了模型关联查询，可以简化一些多表联查操作。</p>
<p>以<code>dept</code>、<code>emp</code>、<code>hobby</code>三个表为例，每个部门可以有多个员工，每个员工只有一个部门，每个员工对应一条爱好。</p>
<p><strong>查询所有员工，并关联查询出其所在部门</strong></p>
<ul>
<li>修改<code>entity.Emp</code>，加入关联信息</li>
</ul>
<p><code>internal/model/entity/emp.go</code></p>
<div class="highlight"><pre><span></span><span class="kd">type</span><span class="w"> </span><span class="nx">Emp</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Id</span><span class="w">     </span><span class="kt">uint</span><span class="w">   </span><span class="s">`json:&quot;id&quot;      `</span><span class="w"> </span><span class="c1">// ID</span>
<span class="w">    </span><span class="nx">DeptId</span><span class="w"> </span><span class="kt">uint</span><span class="w">   </span><span class="s">`json:&quot;dept_id&quot; `</span><span class="w"> </span><span class="c1">// 所属部门</span>
<span class="w">    </span><span class="nx">Name</span><span class="w">   </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;name&quot;    `</span><span class="w"> </span><span class="c1">// 姓名</span>
<span class="w">    </span><span class="nx">Gender</span><span class="w"> </span><span class="kt">int</span><span class="w">    </span><span class="s">`json:&quot;gender&quot;  `</span><span class="w"> </span><span class="c1">// 性别: 0=男 1=女</span>
<span class="w">    </span><span class="nx">Phone</span><span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;phone&quot;   `</span><span class="w"> </span><span class="c1">// 联系电话</span>
<span class="w">    </span><span class="nx">Email</span><span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;email&quot;   `</span><span class="w"> </span><span class="c1">// 邮箱</span>
<span class="w">    </span><span class="nx">Avatar</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;avatar&quot;  `</span><span class="w"> </span><span class="c1">// 照片</span>

<span class="w">    </span><span class="nx">Dept</span><span class="w"> </span><span class="o">*</span><span class="nx">Dept</span><span class="w">    </span><span class="s">`orm:&quot;with:id=dept_id&quot; json:&quot;dept&quot;`</span>
<span class="p">}</span>
</pre></div>
<ul>
<li>使用<code>With</code>指定关联模型查询</li>
</ul>
<div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">emps</span><span class="w"> </span><span class="p">[]</span><span class="o">*</span><span class="nx">entity</span><span class="p">.</span><span class="nx">Emp</span>
<span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">dao</span><span class="p">.</span><span class="nx">Emp</span><span class="p">.</span><span class="nx">Ctx</span><span class="p">(</span><span class="nx">ctx</span><span class="p">).</span><span class="nx">With</span><span class="p">(</span><span class="nx">entity</span><span class="p">.</span><span class="nx">Dept</span><span class="p">{}).</span><span class="nx">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">emps</span><span class="p">)</span>
</pre></div>
<p>不用<code>With</code>指定关联的话，查询出的结果中<code>Dept</code>为<code>nil</code></p>
<p><strong>查询所有员工，并关联查询出部门与爱好</strong></p>
<ul>
<li>修改<code>entity.Emp</code>，加入关联信息</li>
</ul>
<p><code>internal/model/entity/emp.go</code></p>
<div class="highlight"><pre><span></span><span class="kd">type</span><span class="w"> </span><span class="nx">Emp</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Id</span><span class="w">     </span><span class="kt">uint</span><span class="w">   </span><span class="s">`json:&quot;id&quot;      `</span><span class="w"> </span><span class="c1">// ID</span>
<span class="w">    </span><span class="nx">DeptId</span><span class="w"> </span><span class="kt">uint</span><span class="w">   </span><span class="s">`json:&quot;dept_id&quot; `</span><span class="w"> </span><span class="c1">// 所属部门</span>
<span class="w">    </span><span class="nx">Name</span><span class="w">   </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;name&quot;    `</span><span class="w"> </span><span class="c1">// 姓名</span>
<span class="w">    </span><span class="nx">Gender</span><span class="w"> </span><span class="kt">int</span><span class="w">    </span><span class="s">`json:&quot;gender&quot;  `</span><span class="w"> </span><span class="c1">// 性别: 0=男 1=女</span>
<span class="w">    </span><span class="nx">Phone</span><span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;phone&quot;   `</span><span class="w"> </span><span class="c1">// 联系电话</span>
<span class="w">    </span><span class="nx">Email</span><span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;email&quot;   `</span><span class="w"> </span><span class="c1">// 邮箱</span>
<span class="w">    </span><span class="nx">Avatar</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;avatar&quot;  `</span><span class="w"> </span><span class="c1">// 照片</span>

<span class="w">    </span><span class="nx">Dept</span><span class="w"> </span><span class="o">*</span><span class="nx">Dept</span><span class="w">    </span><span class="s">`orm:&quot;with:id=dept_id&quot; json:&quot;dept&quot;`</span>
<span class="w">    </span><span class="nx">Hobby</span><span class="w"> </span><span class="o">*</span><span class="nx">Hobby</span><span class="w"> </span><span class="s">`orm:&quot;with:emp_id=id&quot; json:&quot;hobby&quot;`</span>
<span class="p">}</span>
</pre></div>
<ul>
<li>使用<code>With</code>指定需要关联的内容</li>
</ul>
<div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">emps</span><span class="w"> </span><span class="p">[]</span><span class="o">*</span><span class="nx">entity</span><span class="p">.</span><span class="nx">Emp</span>
<span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">dao</span><span class="p">.</span><span class="nx">Emp</span><span class="p">.</span><span class="nx">Ctx</span><span class="p">(</span><span class="nx">ctx</span><span class="p">).</span><span class="nx">With</span><span class="p">(</span><span class="nx">entity</span><span class="p">.</span><span class="nx">Dept</span><span class="p">{},</span><span class="w"> </span><span class="nx">entity</span><span class="p">.</span><span class="nx">Hobby</span><span class="p">{}).</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;dept_id&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">101</span><span class="p">).</span><span class="nx">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">emps</span><span class="p">)</span>
</pre></div>
<p>也可以用<code>WithAll</code>关联所有</p>
<div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">emps</span><span class="w"> </span><span class="p">[]</span><span class="o">*</span><span class="nx">entity</span><span class="p">.</span><span class="nx">Emp</span>
<span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">dao</span><span class="p">.</span><span class="nx">Emp</span><span class="p">.</span><span class="nx">Ctx</span><span class="p">(</span><span class="nx">ctx</span><span class="p">).</span><span class="nx">WithAll</span><span class="p">().</span><span class="nx">Where</span><span class="p">(</span><span class="s">&quot;dept_id&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">101</span><span class="p">).</span><span class="nx">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">emps</span><span class="p">)</span>
</pre></div>
<p><strong>查询部门，关联查询出每个部门的员工</strong></p>
<ul>
<li>修改<code>entity.Dept</code>，加入关联信息</li>
</ul>
<p><code>internal/model/entity/dept.go</code></p>
<div class="highlight"><pre><span></span><span class="c1">// Dept is the golang structure for table dept.</span>
<span class="kd">type</span><span class="w"> </span><span class="nx">Dept</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Id</span><span class="w">     </span><span class="kt">uint</span><span class="w">   </span><span class="s">`json:&quot;id&quot;     `</span><span class="w"> </span><span class="c1">// ID</span>
<span class="w">    </span><span class="nx">Pid</span><span class="w">    </span><span class="kt">uint</span><span class="w">   </span><span class="s">`json:&quot;pid&quot;    `</span><span class="w"> </span><span class="c1">// 上级部门ID</span>
<span class="w">    </span><span class="nx">Name</span><span class="w">   </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;name&quot;   `</span><span class="w"> </span><span class="c1">// 部门名称</span>
<span class="w">    </span><span class="nx">Leader</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;leader&quot; `</span><span class="w"> </span><span class="c1">// 部门领导</span>
<span class="w">    </span><span class="nx">Phone</span><span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;phone&quot;  `</span><span class="w"> </span><span class="c1">// 联系电话</span>

<span class="w">    </span><span class="nx">Emps</span><span class="w"> </span><span class="p">[]</span><span class="o">*</span><span class="nx">Emp</span><span class="w">      </span><span class="s">`orm:&quot;with:dept_id=id&quot; json:&quot;emps&quot;`</span>
<span class="p">}</span>
</pre></div>
<ul>
<li>查询</li>
</ul>
<div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">depts</span><span class="w"> </span><span class="p">[]</span><span class="o">*</span><span class="nx">entity</span><span class="p">.</span><span class="nx">Dept</span>
<span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">dao</span><span class="p">.</span><span class="nx">Dept</span><span class="p">.</span><span class="nx">Ctx</span><span class="p">(</span><span class="nx">ctx</span><span class="p">).</span><span class="nx">With</span><span class="p">(</span><span class="nx">entity</span><span class="p">.</span><span class="nx">Emp</span><span class="p">{}).</span><span class="nx">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">depts</span><span class="p">)</span>
</pre></div>
<p>上述关联查询直接在实体类里面修改，但实体类里的内容是用工具自动生成的，一般情况下不要修改。所以在进行关联查询时，需要重新自定义结构体，只需要保留需要查询的字段即可（用于关联的字段必须存在）</p>
<div class="highlight"><pre><span></span><span class="kd">type</span><span class="w"> </span><span class="nx">MyDept</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">g</span><span class="p">.</span><span class="nx">Meta</span><span class="w"> </span><span class="s">`orm:&quot;table:dept&quot;`</span>
<span class="w">    </span><span class="nx">Id</span><span class="w">     </span><span class="kt">uint</span><span class="w">   </span><span class="s">`json:&quot;id&quot;     `</span><span class="w"> </span><span class="c1">// ID</span>
<span class="w">    </span><span class="nx">Name</span><span class="w">   </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;name&quot;   `</span><span class="w"> </span><span class="c1">// 部门名称</span>
<span class="w">    </span><span class="nx">Leader</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;leader&quot; `</span><span class="w"> </span><span class="c1">// 部门领导</span>
<span class="w">    </span><span class="nx">Phone</span><span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;phone&quot;  `</span><span class="w"> </span><span class="c1">// 联系电话</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">MyEmp</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">g</span><span class="p">.</span><span class="nx">Meta</span><span class="w"> </span><span class="s">`orm:&quot;table:emp&quot;`</span>
<span class="w">    </span><span class="nx">Id</span><span class="w">     </span><span class="kt">uint</span><span class="w">   </span><span class="s">`json:&quot;id&quot;      `</span><span class="w"> </span><span class="c1">// ID</span>
<span class="w">    </span><span class="nx">DeptId</span><span class="w"> </span><span class="kt">uint</span><span class="w">   </span><span class="s">`json:&quot;dept_id&quot; `</span><span class="w"> </span><span class="c1">// 所属部门</span>
<span class="w">    </span><span class="nx">Name</span><span class="w">   </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;name&quot;    `</span><span class="w"> </span><span class="c1">// 姓名</span>
<span class="w">    </span><span class="nx">Phone</span><span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;phone&quot;   `</span><span class="w"> </span><span class="c1">// 联系电话</span>

<span class="w">    </span><span class="nx">Dept</span><span class="w"> </span><span class="o">*</span><span class="nx">MyDept</span><span class="w"> </span><span class="s">`orm:&quot;with:id=dept_id&quot; json:&quot;dept&quot;`</span>
<span class="p">}</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">emps</span><span class="w"> </span><span class="p">[]</span><span class="o">*</span><span class="nx">MyEmp</span>
<span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">dao</span><span class="p">.</span><span class="nx">Emp</span><span class="p">.</span><span class="nx">Ctx</span><span class="p">(</span><span class="nx">ctx</span><span class="p">).</span><span class="nx">With</span><span class="p">(</span><span class="nx">MyDept</span><span class="p">{}).</span><span class="nx">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">emps</span><span class="p">)</span>
</pre></div>
<p>自定义结构体时，需要用<code>g.Meta</code>及<code>orm</code>标签指定对应的数据表</p>
<h1>模板引擎</h1>
<p>前面我们提过可以用下面几个方法返回模板内容</p>
<div class="highlight"><pre><span></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">Response</span><span class="p">)</span><span class="w"> </span><span class="nx">WriteTpl</span><span class="p">(</span><span class="nx">tpl</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">params</span><span class="w"> </span><span class="o">...</span><span class="nx">gview</span><span class="p">.</span><span class="nx">Params</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">Response</span><span class="p">)</span><span class="w"> </span><span class="nx">WriteTplDefault</span><span class="p">(</span><span class="nx">params</span><span class="w"> </span><span class="o">...</span><span class="nx">gview</span><span class="p">.</span><span class="nx">Params</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">Response</span><span class="p">)</span><span class="w"> </span><span class="nx">WriteTplContent</span><span class="p">(</span><span class="nx">content</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">params</span><span class="w"> </span><span class="o">...</span><span class="nx">gview</span><span class="p">.</span><span class="nx">Params</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span>
</pre></div>
<p>默认情况下模板文件目录是<code>resource/template</code></p>
<ul>
<li><code>WriteTpl</code>解析并返回模板文件内容，文件为相对于<code>resource/template</code>的路径</li>
<li><code>WriteTplDefault</code>解析并返回默认模板，为<code>resource/template/index.html</code></li>
<li><code>WriteTplContent</code>解析并返回模板字符串</li>
</ul>
<p>常用的为<code>WriteTpl</code>，其他两个方法简单了解即可</p>
<div class="highlight"><pre><span></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Controller</span><span class="p">)</span><span class="w"> </span><span class="nx">Tpl</span><span class="p">(</span><span class="nx">req</span><span class="w"> </span><span class="o">*</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">req</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">WriteTplDefault</span><span class="p">()</span><span class="w"> </span><span class="c1">// 解析并返回默认模板文件内容</span>
<span class="w">    </span><span class="c1">// 解析并返回模板字符串</span>
<span class="w">    </span><span class="nx">req</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">WriteTplContent</span><span class="p">(</span><span class="s">&quot;&lt;h1&gt;你好, {{.name}} 欢迎学习{{.lang}}&lt;/h1&gt;&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Map</span><span class="p">{</span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;王道长&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;lang&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;GoFrame&quot;</span><span class="p">})</span>
<span class="p">}</span>
</pre></div>
<h2>简单使用示例</h2>
<p><code>resource/template/hello/index.html</code></p>
<div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;zh&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Document<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>你好， {{.name}}<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>欢迎来到{{.lesson}}的学习课程<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>本课程共{{.num}}小节，现在学习的是{{.what}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
<p><code>controller</code></p>
<div class="highlight"><pre><span></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Controller</span><span class="p">)</span><span class="w"> </span><span class="nx">Tpl</span><span class="p">(</span><span class="nx">req</span><span class="w"> </span><span class="o">*</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">data</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Map</span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">   </span><span class="s">&quot;王也道长&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;lesson&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;GoFrame入门课程&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;num&quot;</span><span class="p">:</span><span class="w">    </span><span class="mi">5</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;what&quot;</span><span class="p">:</span><span class="w">   </span><span class="s">&quot;模板引擎使用示例&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">req</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">WriteTpl</span><span class="p">(</span><span class="s">&quot;hello/index.html&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
<h2>模板配置</h2>
<p>模板使用当中一般情况使用默认配置即可，如果需要修改配置，则在<code>manifest/config/config.yaml</code>中进行修改</p>
<div class="highlight"><pre><span></span><span class="nt">viewer</span><span class="p">:</span><span class="w"> </span><span class="c1"># 模板配置</span>
<span class="w">  </span><span class="nt">paths</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;resource/template&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;/www/template&quot;</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="c1"># 模板路径配置，可以配置多个路径</span>
<span class="w">  </span><span class="nt">defaultFile</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;index.hmtl&quot;</span><span class="w"> </span><span class="c1"># WriteTplDefault解析的文件</span>
<span class="w">  </span><span class="nt">delimiters</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;${&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;}&quot;</span><span class="p p-Indicator">]</span><span class="w"> </span><span class="c1"># 模板引擎变量分隔符，默认为[&quot;{{&quot;, &quot;}}&quot;]</span>
</pre></div>
<h2>静态资源</h2>
<p>静态资源不属于模板引擎的内容，但在模板文件中也有需要用到静态资源的地方，因此进行一下补充。</p>
<p>静态资源一般指的是js/css/image文件或者静态HTML文件，在GoFrame的项目目录中，这些文件放在<code>resource/public</code>下，之后还需要开启静态资源服务才能在模板文件中对这些资源进行引用。开启方式有两种</p>
<ul>
<li>配置文件</li>
</ul>
<p><code>manifest/config/config.yaml</code></p>
<div class="highlight"><pre><span></span><span class="nt">server</span><span class="p">:</span>

<span class="w">  </span><span class="nt">serverRoot</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;resource/public&quot;</span>
<span class="w">  </span><span class="nt">indexFolder</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"> </span><span class="c1"># 这个可以不用配置，放在这里了解一下</span>
</pre></div>
<ul>
<li>用代码开启</li>
</ul>
<p><code>internal/cmd/cmd.go</code></p>
<div class="highlight"><pre><span></span><span class="nx">s</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Server</span><span class="p">()</span>
<span class="nx">s</span><span class="p">.</span><span class="nx">SetServerRoot</span><span class="p">(</span><span class="s">&quot;resource/public&quot;</span><span class="p">)</span>
<span class="nx">s</span><span class="p">.</span><span class="nx">SetIndexFolder</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span>
</pre></div>
<p><code>serverRoot</code>配置了静态资源根目录<code>resource/public</code>，对静态资源的引用url以<code>resource/public</code>为根目录</p>
<p>例如，在<code>resource/public/resource/css</code>中放置了一人<code>bootstrap.css</code>文件，引用时写为</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/resource/css/bootstrap.css&quot;</span><span class="p">&gt;</span>
</pre></div>
<h2>条件判断</h2>
<p>在模板中可以进行条件判断，根据条件是否满足来显示不同内容，语法如下：</p>
<div class="highlight"><pre><span></span>{{if .condition}}
条件满足时显示内容
{{else}}
条件不满足时显示内容
{{end}}
</pre></div>
<p>可以嵌套写，也可以写多个{{else if  .condition}}</p>
<p>当<code>.condition</code>为空值，即<code>0</code>、<code>""</code>、<code>nil</code>这类值时，条件判断为假，其他值均为真（条件满足）。</p>
<p>用法示例：</p>
<p><code>resource/template/hello/index.html</code></p>
<div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;zh&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/resource/css/bootstrap.css&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Document<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>

   {{if .name}}
   <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>name的值: {{.name}}<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
   {{else}}
   <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>name的值为false/&quot;&quot;/0/nil等<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
   {{end}}

<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
<p><code>controller</code></p>
<div class="highlight"><pre><span></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Controller</span><span class="p">)</span><span class="w"> </span><span class="nx">Tpl</span><span class="p">(</span><span class="nx">req</span><span class="w"> </span><span class="o">*</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">data</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Map</span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">   </span><span class="s">&quot;王也道长&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;lesson&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;GoFrame入门课程&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;num&quot;</span><span class="p">:</span><span class="w">    </span><span class="mi">5</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;what&quot;</span><span class="p">:</span><span class="w">   </span><span class="s">&quot;模板引擎使用示例&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">req</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">WriteTpl</span><span class="p">(</span><span class="s">&quot;hello/index.html&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
<p><strong>大于小于等于判断</strong></p>
<p>在模板中无法直接使用<code>&gt;</code>、<code>&lt;</code>、<code>==</code>等符号进行关系判断，因此需要使用条件函数</p>
<table>
<thead><tr>
<th style="text-align:center">函数</th>
<th style="text-align:center">对应符号</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">eq</td>
<td style="text-align:center">==</td>
</tr>
<tr>
<td style="text-align:center">ne</td>
<td style="text-align:center">!=</td>
</tr>
<tr>
<td style="text-align:center">lt</td>
<td style="text-align:center">&lt;</td>
</tr>
<tr>
<td style="text-align:center">le</td>
<td style="text-align:center">&lt;=</td>
</tr>
<tr>
<td style="text-align:center">gt</td>
<td style="text-align:center">&gt;</td>
</tr>
<tr>
<td style="text-align:center">ge</td>
<td style="text-align:center">&gt;=</td>
</tr>
</tbody>
</table>
<p>使用示例</p>
<div class="highlight"><pre><span></span>{{if eq 5 .num}}
<span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>num == 5<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
{{else if lt 5 .num}}
<span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>num &gt; 5<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
{{else}}
<span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>num <span class="p">&lt;</span> <span class="nt">5</span><span class="err">&lt;/</span><span class="na">h1</span><span class="p">&gt;</span>
{{end}}
</pre></div>
<p>上述函数还有一些拓展用法，这里只简单介绍基础用法</p>
<p><strong>逻辑判断</strong></p>
<p>模板语言中可以用<code>and</code>、<code>or</code>、<code>not</code>进行逻辑运算</p>
<div class="highlight"><pre><span></span>{{if and (gt .num 0) (lt .num 5)}}    if num &gt; 0 <span class="err">&amp;&amp;</span> num <span class="p">&lt;</span> <span class="nt">5</span>
<span class="err">{{</span><span class="na">if</span> <span class="na">or</span> <span class="err">(</span><span class="na">eq</span> <span class="err">.</span><span class="na">num</span> <span class="na">0</span><span class="err">)</span> <span class="err">(</span><span class="na">eq</span> <span class="err">.</span><span class="na">num</span> <span class="na">5</span><span class="err">)}}</span>    <span class="na">if</span> <span class="na">num </span><span class="o">=</span><span class="s">=</span> <span class="na">0</span> <span class="err">||</span> <span class="na">num </span><span class="o">=</span><span class="s">=</span> <span class="na">5</span>
<span class="err">{{</span><span class="na">if</span> <span class="na">not</span> <span class="err">(</span><span class="na">eq</span> <span class="err">.</span><span class="na">num</span> <span class="na">0</span><span class="err">)}}</span>    <span class="na">if</span> <span class="na">num</span> <span class="err">!=</span> <span class="na">0</span>
</pre></div>
<h2>循环</h2>
<p><code>range ... end</code></p>
<p><strong>循环切片</strong></p>
<p><code>controller/hello.go</code></p>
<div class="highlight"><pre><span></span><span class="nx">data</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Map</span><span class="p">{</span>
<span class="w">    </span><span class="s">&quot;slice&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Array</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;张楚岚&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;诸葛青&quot;</span><span class="p">},</span>
<span class="p">}</span>

<span class="nx">req</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">WriteTpl</span><span class="p">(</span><span class="s">&quot;hello/index.html&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">)</span>
</pre></div>
<p><code>index.html</code></p>
<div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;zh&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/resource/css/bootstrap.css&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Document<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>

   {{range .slice}}
   <span class="p">&lt;</span><span class="nt">span</span><span class="p">&gt;</span>{{.}}<span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span> 
   {{end}}

   {{range $index, $value := .slice}}
   <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>index = {{$index}}, value = {{$value}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
   {{end}}


<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
<p><strong>map数据</strong></p>
<p><code>controller/hello.go</code></p>
<div class="highlight"><pre><span></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Controller</span><span class="p">)</span><span class="w"> </span><span class="nx">Tpl</span><span class="p">(</span><span class="nx">req</span><span class="w"> </span><span class="o">*</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">data</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Map</span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;mp&quot;</span><span class="p">:</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Map</span><span class="p">{</span>
<span class="w">            </span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w">   </span><span class="s">&quot;冯宝宝&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;gender&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;女&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;age&quot;</span><span class="p">:</span><span class="w">    </span><span class="mi">100</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;hobby&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;埋人&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">req</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">WriteTpl</span><span class="p">(</span><span class="s">&quot;hello/index.html&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
<p><code>index.html</code></p>
<div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;zh&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/resource/css/bootstrap.css&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Document<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>

   <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>姓名：{{.mp.name}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>性别：{{.mp.gender}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>年龄：{{.mp.age}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>爱好：{{.mp.hobby}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>


    {{range .mp}}
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>{{.}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    {{end}}

    {{range $key, $value := .mp}}
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>{{$key}}: {{$value}}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    {{end}}

    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>


<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
<h1>上传与下载</h1>
<h2>文件上传</h2>
<p>文件上传可以通过表单上传，也可以通过Ajax上传，GoFrame框架后端处理都是一样的，所以只演示一下表单上传。</p>
<p><strong>单文件上传</strong></p>
<p><code>html/upload.html</code></p>
<div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;en&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>上传文件<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;/upload&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">enctype</span><span class="o">=</span><span class="s">&quot;multipart/form-data&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;file&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;ufile&quot;</span><span class="p">&gt;</span> 
        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;file&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;ufiles&quot;</span> <span class="na">multiple</span><span class="p">&gt;</span> 
        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;上传&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>

<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
<p><code>controller/hello.go</code></p>
<div class="highlight"><pre><span></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Controller</span><span class="p">)</span><span class="w"> </span><span class="nx">Upload</span><span class="p">(</span><span class="nx">req</span><span class="w"> </span><span class="o">*</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">file</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">GetUploadFile</span><span class="p">(</span><span class="s">&quot;ufile&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">file</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">file</span><span class="p">.</span><span class="nx">Filename</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;20231001.png&quot;</span><span class="w"> </span><span class="c1">// 可以根据需要给文件重命名</span>
<span class="w">        </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">file</span><span class="p">.</span><span class="nx">Save</span><span class="p">(</span><span class="s">&quot;./upload&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">req</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Writeln</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p><strong>多文件上传</strong></p>
<div class="highlight"><pre><span></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Controller</span><span class="p">)</span><span class="w"> </span><span class="nx">Upload</span><span class="p">(</span><span class="nx">req</span><span class="w"> </span><span class="o">*</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">files</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">GetUploadFiles</span><span class="p">(</span><span class="s">&quot;ufiles&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">files</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">names</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">files</span><span class="p">.</span><span class="nx">Save</span><span class="p">(</span><span class="s">&quot;./upload&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">req</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Writeln</span><span class="p">(</span><span class="nx">names</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>除了从请求中获取上传文件以外，如果用api规范路由，还可以用如下方式获取上传文件</p>
<div class="highlight"><pre><span></span><span class="kd">type</span><span class="w"> </span><span class="nx">UploadReq</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">g</span><span class="p">.</span><span class="nx">Meta</span><span class="w"> </span><span class="s">`path:&quot;/upload&quot; method:&quot;post&quot;`</span>

<span class="w">    </span><span class="nx">Ufile</span><span class="w"> </span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">UploadFile</span><span class="w"> </span><span class="s">`json:&quot;ufile&quot;`</span>

<span class="w">    </span><span class="nx">UFiles</span><span class="w"> </span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">UploadFiles</span><span class="w"> </span><span class="s">`json:&quot;ufiles&quot;`</span>
<span class="p">}</span>
</pre></div>
<p>使用这种方式，如果文件允许为空， 则可能会发生转换错误。</p>
<p><strong>文件上传应用实例</strong></p>
<ul>
<li>在静态资源目录新建<code>upload</code>文件夹用于存放上传文件，示例中为<code>resource/public/upload</code>，绑定的静态目录为<code>resource/public</code>，因此可以用<code>/upload/&lt;filename&gt;</code>的形式访问指定文件</li>
<li>将上传文件名称修改为对应文件的哈希值，以防上传同名文件覆盖</li>
<li>返回文件的URL</li>
</ul>
<div class="highlight"><pre><span></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Controller</span><span class="p">)</span><span class="w"> </span><span class="nx">Upload</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">api</span><span class="p">.</span><span class="nx">UploadReq</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="o">*</span><span class="nx">api</span><span class="p">.</span><span class="nx">UploadRes</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">req</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">RequestFromCtx</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
<span class="w">    </span><span class="nx">file</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">GetUploadFile</span><span class="p">(</span><span class="s">&quot;ufile&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">file</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">md5str</span><span class="w"> </span><span class="kt">string</span>
<span class="w">        </span><span class="nx">md5str</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">gmd5</span><span class="p">.</span><span class="nx">Encrypt</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">file</span><span class="p">.</span><span class="nx">Filename</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">md5str</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">Ext</span><span class="p">(</span><span class="nx">file</span><span class="p">.</span><span class="nx">Filename</span><span class="p">)</span>
<span class="w">        </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">file</span><span class="p">.</span><span class="nx">Save</span><span class="p">(</span><span class="s">&quot;resource/public/upload&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">res</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">api</span><span class="p">.</span><span class="nx">UploadRes</span><span class="p">{</span>
<span class="w">                </span><span class="nx">Data</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/upload/&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span>
<span class="p">}</span>
</pre></div>
<h2>文件下载</h2>
<p><strong>ServeFile</strong></p>
<p><code>ServeFile</code>向客户端返回一个文件内容，如果是文本或者图片，将会直接展示，不能直接在浏览器中展示的将进行下载</p>
<div class="highlight"><pre><span></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Controller</span><span class="p">)</span><span class="w"> </span><span class="nx">Download</span><span class="p">(</span><span class="nx">req</span><span class="w"> </span><span class="o">*</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">req</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">ServeFile</span><span class="p">(</span><span class="s">&quot;upload/1.png&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
<p><strong>ServeFileDownload</strong></p>
<p>该方法直接引导客户端进行下载，并且可以给下载文件重命名</p>
<div class="highlight"><pre><span></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Controller</span><span class="p">)</span><span class="w"> </span><span class="nx">Download</span><span class="p">(</span><span class="nx">req</span><span class="w"> </span><span class="o">*</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">req</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">ServeFileDownload</span><span class="p">(</span><span class="s">&quot;upload/1.png&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;download.png&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
<h2>上传限制</h2>
<p>如果需要限制单次上传文件大小，可以用<code>clientMaxBodySize</code>配置。如果完全不需要限制，直接设为0即可</p>
<p><code>config.yaml</code></p>
<div class="highlight"><pre><span></span><span class="nt">server</span><span class="p">:</span>
<span class="w">  </span><span class="nt">clientMaxBodySize</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;0&quot;</span>
</pre></div>
<h1>数据校验</h1>
<p>在使用中，经常需要验证前端提交过来的数据是否符合规则，比如非空、长度限制、是否为数字等一系列验证。在GoFrame中，基本上都不用手动写验证规则，框架里已经提供了很多内置的验证规则可以用来验证数据。验证规则详细内容见官方文档<a href="">数据校验/校验规则</a></p>
<p><strong>单个规则/错误提示信息</strong></p>
<div class="highlight"><pre><span></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Controller</span><span class="p">)</span><span class="w"> </span><span class="nx">Valid</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">rq</span><span class="w"> </span><span class="o">*</span><span class="nx">api</span><span class="p">.</span><span class="nx">ValidReq</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">rs</span><span class="w"> </span><span class="o">*</span><span class="nx">api</span><span class="p">.</span><span class="nx">ValidRes</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">type</span><span class="w"> </span><span class="nx">Data</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">Name</span><span class="w">  </span><span class="nx">g</span><span class="p">.</span><span class="nx">Map</span><span class="w"> </span><span class="s">`v:&quot;required#name不能为空&quot;`</span>
<span class="w">        </span><span class="nx">Age</span><span class="w">   </span><span class="kt">int</span><span class="w">    </span><span class="s">`v:&quot;required&quot;`</span>
<span class="w">        </span><span class="nx">Phone</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="s">`v:&quot;required&quot;`</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">data</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Data</span><span class="p">{}</span>
<span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Validator</span><span class="p">().</span><span class="nx">Bail</span><span class="p">().</span><span class="nx">Data</span><span class="p">(</span><span class="nx">data</span><span class="p">).</span><span class="nx">Run</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>

<span class="w">    </span><span class="nx">rs</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">api</span><span class="p">.</span><span class="nx">ValidRes</span><span class="p">{</span><span class="nx">Data</span><span class="p">:</span><span class="w"> </span><span class="nx">data</span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span>
<span class="p">}</span>
</pre></div>
<p><strong>多个规则</strong></p>
<div class="highlight"><pre><span></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Controller</span><span class="p">)</span><span class="w"> </span><span class="nx">Valid</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">rq</span><span class="w"> </span><span class="o">*</span><span class="nx">api</span><span class="p">.</span><span class="nx">ValidReq</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">rs</span><span class="w"> </span><span class="o">*</span><span class="nx">api</span><span class="p">.</span><span class="nx">ValidRes</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">type</span><span class="w"> </span><span class="nx">Data</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">Name</span><span class="w">  </span><span class="kt">string</span>
<span class="w">        </span><span class="nx">Age</span><span class="w">   </span><span class="kt">string</span><span class="w"> </span><span class="s">`v:&quot;required|integer|min:1#age不能为空|age必须为整数|age不能小于1&quot;`</span>
<span class="w">        </span><span class="nx">Phone</span><span class="w"> </span><span class="kt">string</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">data</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Data</span><span class="p">{</span><span class="nx">Age</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1.1&quot;</span><span class="p">}</span>
<span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Validator</span><span class="p">().</span><span class="nx">Bail</span><span class="p">().</span><span class="nx">Data</span><span class="p">(</span><span class="nx">data</span><span class="p">).</span><span class="nx">Run</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>

<span class="w">    </span><span class="nx">rs</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">api</span><span class="p">.</span><span class="nx">ValidRes</span><span class="p">{</span><span class="nx">Data</span><span class="p">:</span><span class="w"> </span><span class="nx">data</span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span>
<span class="p">}</span>
</pre></div>
<p><strong>使用Map指定校验规则</strong></p>
<div class="highlight"><pre><span></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Controller</span><span class="p">)</span><span class="w"> </span><span class="nx">Valid</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">rq</span><span class="w"> </span><span class="o">*</span><span class="nx">api</span><span class="p">.</span><span class="nx">ValidReq</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">rs</span><span class="w"> </span><span class="o">*</span><span class="nx">api</span><span class="p">.</span><span class="nx">ValidRes</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">type</span><span class="w"> </span><span class="nx">Data</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">Name</span><span class="w">  </span><span class="kt">string</span>
<span class="w">        </span><span class="nx">Age</span><span class="w">   </span><span class="kt">int</span>
<span class="w">        </span><span class="nx">Phone</span><span class="w"> </span><span class="kt">string</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">rules</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span>
<span class="w">        </span><span class="s">&quot;Name&quot;</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;required|length:6,16&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;Age&quot;</span><span class="p">:</span><span class="w">   </span><span class="s">&quot;between:18,30&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;Phone&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;phone&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">message</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
<span class="w">        </span><span class="s">&quot;Name&quot;</span><span class="p">:</span><span class="w"> </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span>
<span class="w">            </span><span class="s">&quot;required&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Name不能为空&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="s">&quot;length&quot;</span><span class="p">:</span><span class="w">   </span><span class="s">&quot;长度只能为{min}到{max}个字符&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="s">&quot;Age&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;年龄只能为18到30岁&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">data</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">Data</span><span class="p">{</span><span class="nx">Phone</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;123&quot;</span><span class="p">}</span>
<span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Validator</span><span class="p">().</span><span class="nx">Rules</span><span class="p">(</span><span class="nx">rules</span><span class="p">).</span><span class="nx">Messages</span><span class="p">(</span><span class="nx">message</span><span class="p">).</span><span class="nx">Data</span><span class="p">(</span><span class="nx">data</span><span class="p">).</span><span class="nx">Run</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>

<span class="w">    </span><span class="nx">rs</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">api</span><span class="p">.</span><span class="nx">ValidRes</span><span class="p">{</span><span class="nx">Data</span><span class="p">:</span><span class="w"> </span><span class="nx">data</span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span>
<span class="p">}</span>
</pre></div>
<p><strong>规范路由API数据校验</strong></p>
<p>如果输入数据直接在API里定义了结构，可直接将校验规则写上，在请求时会自动校验，不需要再手动调用校验函数。</p>
<p><code>api/hello.go</code></p>
<div class="highlight"><pre><span></span><span class="kd">type</span><span class="w"> </span><span class="nx">ValidReq</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">g</span><span class="p">.</span><span class="nx">Meta</span><span class="w"> </span><span class="s">`path:&quot;/valid&quot; method:&quot;all&quot;`</span>

<span class="w">    </span><span class="nx">Name</span><span class="w">  </span><span class="kt">string</span><span class="w"> </span><span class="s">`v:&quot;required|length:6,16&quot;`</span>
<span class="w">    </span><span class="nx">Age</span><span class="w">   </span><span class="kt">int</span><span class="w">    </span><span class="s">`v:&quot;required&quot;`</span>
<span class="w">    </span><span class="nx">Phone</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="s">`v:&quot;phone&quot;`</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">ValidRes</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Data</span><span class="w"> </span><span class="kd">interface</span><span class="p">{}</span><span class="w"> </span><span class="s">`json:&quot;data&quot;`</span>
<span class="p">}</span>
</pre></div>
<p><code>controller/hello.go</code></p>
<div class="highlight"><pre><span></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Controller</span><span class="p">)</span><span class="w"> </span><span class="nx">Valid</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">rq</span><span class="w"> </span><span class="o">*</span><span class="nx">api</span><span class="p">.</span><span class="nx">ValidReq</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">rs</span><span class="w"> </span><span class="o">*</span><span class="nx">api</span><span class="p">.</span><span class="nx">ValidRes</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span>
<span class="p">}</span>
</pre></div>
<h1>Cookie/Session</h1>
<p>Cookie是保存在浏览器的一些数据，在请求的时候会放在请求头当中一同发送，通常用来保存sessionid、token等一些数据。</p>
<div class="highlight"><pre><span></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Controller</span><span class="p">)</span><span class="w"> </span><span class="nx">Cookie</span><span class="p">(</span><span class="nx">req</span><span class="w"> </span><span class="o">*</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">req</span><span class="p">.</span><span class="nx">Cookie</span><span class="p">.</span><span class="nx">Set</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;kslfjojklcjkldjfsie&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">req</span><span class="p">.</span><span class="nx">Cookie</span><span class="p">.</span><span class="nx">Set</span><span class="p">(</span><span class="s">&quot;user_name&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;诸葛青&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="nx">name</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">Cookie</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;user_name&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">req</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Writeln</span><span class="p">(</span><span class="s">&quot;name from cookie: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">name</span><span class="p">.</span><span class="nx">String</span><span class="p">())</span>

<span class="w">    </span><span class="nx">req</span><span class="p">.</span><span class="nx">Cookie</span><span class="p">.</span><span class="nx">Remove</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
<p>Session机制用于判断请求由哪一用户发起，Session数据保存在服务器。</p>
<p>以前常用于保存登录数据，进行登录验证，不过现在只是有些比较小的，前后端不分离的项目还在使用。</p>
<div class="highlight"><pre><span></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Controller</span><span class="p">)</span><span class="w"> </span><span class="nx">Session</span><span class="p">(</span><span class="nx">req</span><span class="w"> </span><span class="o">*</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">op</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">GetQuery</span><span class="p">(</span><span class="s">&quot;op&quot;</span><span class="p">).</span><span class="nx">String</span><span class="p">()</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">op</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;set&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">req</span><span class="p">.</span><span class="nx">Session</span><span class="p">.</span><span class="nx">Set</span><span class="p">(</span><span class="s">&quot;user&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Map</span><span class="p">{</span><span class="s">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;张三&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">18</span><span class="p">})</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">op</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;get&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">req</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Writeln</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">Session</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;user&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">op</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;rm&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">req</span><span class="p">.</span><span class="nx">Session</span><span class="p">.</span><span class="nx">Remove</span><span class="p">(</span><span class="s">&quot;user&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
<h1>golang-jwt</h1>
<p>前后端分离的项目更常用的登录验证是<code>JWT(JSON web token)</code>。GoFrame中没有提供相关生成与验证，需要添加第三方库，例如<code>golang-jwt</code></p>
<p>简单使用方式如下：</p>
<ul>
<li>添加</li>
</ul>
<div class="highlight"><pre><span></span>go<span class="w"> </span>get<span class="w"> </span>-u<span class="w"> </span>github.com/golang-jwt/jwt/v5
</pre></div>
<ul>
<li>导入</li>
</ul>
<div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="s">&quot;github.com/golang-jwt/jwt/v5&quot;</span>
</pre></div>
<ul>
<li>生成token</li>
</ul>
<div class="highlight"><pre><span></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Controller</span><span class="p">)</span><span class="w"> </span><span class="nx">Jwt</span><span class="p">(</span><span class="nx">req</span><span class="w"> </span><span class="o">*</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">type</span><span class="w"> </span><span class="nx">UserClaims</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">UserID</span><span class="w">   </span><span class="kt">uint</span>
<span class="w">        </span><span class="nx">UserName</span><span class="w"> </span><span class="kt">string</span>
<span class="w">        </span><span class="nx">jwt</span><span class="p">.</span><span class="nx">RegisteredClaims</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">key</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;arandomstring&quot;</span>

<span class="w">    </span><span class="nx">claim</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">UserClaims</span><span class="p">{</span>
<span class="w">        </span><span class="nx">UserID</span><span class="p">:</span><span class="w">   </span><span class="mi">1011</span><span class="p">,</span>
<span class="w">        </span><span class="nx">UserName</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;张之维&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">RegisteredClaims</span><span class="p">:</span><span class="w"> </span><span class="nx">jwt</span><span class="p">.</span><span class="nx">RegisteredClaims</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Subject</span><span class="p">:</span><span class="w">   </span><span class="s">&quot;张之维&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">ExpiresAt</span><span class="p">:</span><span class="w"> </span><span class="nx">jwt</span><span class="p">.</span><span class="nx">NewNumericDate</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">Add</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Minute</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">10</span><span class="p">)),</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">token</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">jwt</span><span class="p">.</span><span class="nx">NewWithClaims</span><span class="p">(</span><span class="nx">jwt</span><span class="p">.</span><span class="nx">SigningMethodHS256</span><span class="p">,</span><span class="w"> </span><span class="nx">claim</span><span class="p">).</span><span class="nx">SignedString</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">key</span><span class="p">))</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">req</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Writeln</span><span class="p">(</span><span class="nx">token</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">req</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Writeln</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
<ul>
<li>token验证</li>
</ul>
<div class="highlight"><pre><span></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Controller</span><span class="p">)</span><span class="w"> </span><span class="nx">Jwt</span><span class="p">(</span><span class="nx">req</span><span class="w"> </span><span class="o">*</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">type</span><span class="w"> </span><span class="nx">UserClaims</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">UserID</span><span class="w">   </span><span class="kt">uint</span>
<span class="w">        </span><span class="nx">UserName</span><span class="w"> </span><span class="kt">string</span>
<span class="w">        </span><span class="nx">jwt</span><span class="p">.</span><span class="nx">RegisteredClaims</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">key</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;arandomstring&quot;</span>

<span class="w">    </span><span class="nx">token</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="s">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJVc2VySUQiOjEwMTEsIlVzZXJOYW1lIjoi5byg5LmL57u0Iiwic3ViIjoi5byg5LmL57u0IiwiZXhwIjoxNjk4NjcxMjA3fQ.r11R1_WcDueBU52BoUjDS94jqemgrhU-V4WW7YSvXWE&quot;</span>
<span class="w">    </span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">jwt</span><span class="p">.</span><span class="nx">ParseWithClaims</span><span class="p">(</span><span class="nx">token</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">UserClaims</span><span class="p">{},</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">jwt</span><span class="p">.</span><span class="nx">Token</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kd">interface</span><span class="p">{},</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">key</span><span class="p">),</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">    </span><span class="p">})</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">Valid</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">claim</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">Claims</span><span class="p">.(</span><span class="o">*</span><span class="nx">UserClaims</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">req</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Writeln</span><span class="p">(</span><span class="s">&quot;token验证成功&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="nx">req</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Writeln</span><span class="p">(</span><span class="nx">claim</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nx">req</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Writeln</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">Claims</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">req</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Writeln</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p><code>jwt.RegisteredClaims</code></p>
<div class="highlight"><pre><span></span><span class="kd">type</span><span class="w"> </span><span class="nx">RegisteredClaims</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 发布者</span>
<span class="w">    </span><span class="nx">Issuer</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;iss,omitempty&quot;`</span>

<span class="w">    </span><span class="c1">// token使用主体</span>
<span class="w">    </span><span class="nx">Subject</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;sub,omitempty&quot;`</span>

<span class="w">    </span><span class="c1">// </span>
<span class="w">    </span><span class="nx">Audience</span><span class="w"> </span><span class="nx">ClaimStrings</span><span class="w"> </span><span class="s">`json:&quot;aud,omitempty&quot;`</span>

<span class="w">    </span><span class="c1">// 失效时间</span>
<span class="w">    </span><span class="nx">ExpiresAt</span><span class="w"> </span><span class="o">*</span><span class="nx">NumericDate</span><span class="w"> </span><span class="s">`json:&quot;exp,omitempty&quot;`</span>

<span class="w">    </span><span class="c1">// 生效时间</span>
<span class="w">    </span><span class="nx">NotBefore</span><span class="w"> </span><span class="o">*</span><span class="nx">NumericDate</span><span class="w"> </span><span class="s">`json:&quot;nbf,omitempty&quot;`</span>

<span class="w">    </span><span class="c1">// 发布时间</span>
<span class="w">    </span><span class="nx">IssuedAt</span><span class="w"> </span><span class="o">*</span><span class="nx">NumericDate</span><span class="w"> </span><span class="s">`json:&quot;iat,omitempty&quot;`</span>

<span class="w">    </span><span class="c1">// 可以唯一标识这一jwt的字符串，用来防止数据相似的jwt哈希碰撞</span>
<span class="w">    </span><span class="nx">ID</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;jti,omitempty&quot;`</span>
<span class="p">}</span>
</pre></div>
<h1>中间件</h1>
<p>中间件（拦截器）是在请求与响应的过程中，拦截下请求与响应并做一些操作，常见的用途是在请求前进行鉴权，在请求后对响应数据进行包装等</p>
<p>中间件的定义与普通路由函数一样，只是其中需要用<code>Next()</code>进行路由放行。</p>
<div class="highlight"><pre><span></span><span class="kd">func</span><span class="w"> </span><span class="nx">MiddleWare</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">r</span><span class="p">.</span><span class="nx">Middleware</span><span class="p">.</span><span class="nx">Next</span><span class="p">()</span>
<span class="p">}</span>
</pre></div>
<p><strong>前置中间件</strong></p>
<p>在执行具体的路由函数之前进行操作的中间件称为前置中间件，例如进行登录验证的中间件：</p>
<div class="highlight"><pre><span></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="nx">sMiddleware</span><span class="p">)</span><span class="w"> </span><span class="nx">Auth</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">user</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">service</span><span class="p">.</span><span class="nx">Session</span><span class="p">().</span><span class="nx">GetUser</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">Context</span><span class="p">())</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">Id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">service</span><span class="p">.</span><span class="nx">Session</span><span class="p">().</span><span class="nx">SetNotice</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">Context</span><span class="p">(),</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">model</span><span class="p">.</span><span class="nx">SessionNotice</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Type</span><span class="p">:</span><span class="w">    </span><span class="nx">consts</span><span class="p">.</span><span class="nx">SessionNoticeTypeWarn</span><span class="p">,</span>
<span class="w">            </span><span class="nx">Content</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;未登录或会话已过期，请您登录后再继续&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="p">})</span>
<span class="w">        </span><span class="c1">// 只有GET请求才支持保存当前URL，以便后续登录后再跳转回来。</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Method</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;GET&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">_</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">service</span><span class="p">.</span><span class="nx">Session</span><span class="p">().</span><span class="nx">SetLoginReferer</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">Context</span><span class="p">(),</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">GetUrl</span><span class="p">())</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// 根据当前请求方式执行不同的返回数据结构</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">IsAjaxRequest</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">response</span><span class="p">.</span><span class="nx">JsonRedirectExit</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">LoginUrl</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">r</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">RedirectTo</span><span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">LoginUrl</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">r</span><span class="p">.</span><span class="nx">Middleware</span><span class="p">.</span><span class="nx">Next</span><span class="p">()</span>
<span class="p">}</span>
</pre></div>
<p><strong>后置中间件</strong></p>
<p>在路由函数执行完成之后再进行操作的中间件称为后置中间件，例如对返回的数据格式进行统一封装的中间件：</p>
<div class="highlight"><pre><span></span><span class="c1">// 返回处理中间件</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">s</span><span class="w"> </span><span class="o">*</span><span class="nx">sMiddleware</span><span class="p">)</span><span class="w"> </span><span class="nx">ResponseHandler</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">r</span><span class="p">.</span><span class="nx">Middleware</span><span class="p">.</span><span class="nx">Next</span><span class="p">()</span>

<span class="w">    </span><span class="c1">// 如果已经有返回内容，那么该中间件什么也不做</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">BufferLength</span><span class="p">()</span><span class="w"> </span><span class="p">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="p">(</span>
<span class="w">        </span><span class="nx">err</span><span class="w">             </span><span class="p">=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">GetError</span><span class="p">()</span>
<span class="w">        </span><span class="nx">res</span><span class="w">             </span><span class="p">=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">GetHandlerResponse</span><span class="p">()</span>
<span class="w">        </span><span class="nx">code</span><span class="w"> </span><span class="nx">gcode</span><span class="p">.</span><span class="nx">Code</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">gcode</span><span class="p">.</span><span class="nx">CodeOK</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">code</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">gerror</span><span class="p">.</span><span class="nx">Code</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">code</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">gcode</span><span class="p">.</span><span class="nx">CodeNil</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">code</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">gcode</span><span class="p">.</span><span class="nx">CodeInternalError</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">IsAjaxRequest</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">response</span><span class="p">.</span><span class="nx">JsonExit</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span><span class="w"> </span><span class="nx">code</span><span class="p">.</span><span class="nx">Code</span><span class="p">(),</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">())</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">service</span><span class="p">.</span><span class="nx">View</span><span class="p">().</span><span class="nx">Render500</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">Context</span><span class="p">(),</span><span class="w"> </span><span class="nx">model</span><span class="p">.</span><span class="nx">View</span><span class="p">{</span>
<span class="w">                </span><span class="nx">Error</span><span class="p">:</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">Error</span><span class="p">(),</span>
<span class="w">            </span><span class="p">})</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">IsAjaxRequest</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">response</span><span class="p">.</span><span class="nx">JsonExit</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span><span class="w"> </span><span class="nx">code</span><span class="p">.</span><span class="nx">Code</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// 什么都不做，业务API自行处理模板渲染的成功逻辑。</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
<p>中件间的定义实际上就是如下：</p>
<div class="highlight"><pre><span></span><span class="kd">func</span><span class="w"> </span><span class="nx">MiddleWare</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 前置中间件</span>
<span class="w">    </span><span class="nx">r</span><span class="p">.</span><span class="nx">Middleware</span><span class="p">.</span><span class="nx">Next</span><span class="p">()</span>
<span class="w">    </span><span class="c1">// 后置中间件</span>
<span class="p">}</span>
</pre></div>
<p><strong>SetCtxVar/GetCtxVar</strong></p>
<p>如果需要在一些请求流程中进行参数传递，可以用<code>SetCtxVar/GetCtxVar</code>进行存取</p>
<p>例如</p>
<div class="highlight"><pre><span></span><span class="kd">func</span><span class="w"> </span><span class="nx">MiddleWare</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">r</span><span class="p">.</span><span class="nx">SetCtxVar</span><span class="p">(</span><span class="s">&quot;UserName&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;陆玲珑&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="nx">r</span><span class="p">.</span><span class="nx">Middleware</span><span class="p">.</span><span class="nx">Next</span><span class="p">()</span>
<span class="p">}</span>
</pre></div>
<p>在具体路由函数中取用</p>
<div class="highlight"><pre><span></span><span class="nx">UserName</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">GetCtxVar</span><span class="p">(</span><span class="s">&quot;UserName&quot;</span><span class="p">)</span>
</pre></div>
<h1>组件</h1>
<h2>数据结构</h2>
<p>GoFrame中提供了一些常用的数据结构，如列表、队列、集合、Map等，详细内容见官方文档。</p>
<h2>时间</h2>
<p><strong>当前时间</strong></p>
<div class="highlight"><pre><span></span><span class="nx">t</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">gtime</span><span class="p">.</span><span class="nx">Now</span><span class="p">()</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="nx">t</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">gtime</span><span class="p">.</span><span class="nx">Date</span><span class="p">()</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="nx">t</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">gtime</span><span class="p">.</span><span class="nx">Datetime</span><span class="p">()</span>
</pre></div>
<p><strong>创建时间对象</strong></p>
<div class="highlight"><pre><span></span><span class="nx">t</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">gtime</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;2023-11-03 21:45:22&quot;</span><span class="p">)</span>
</pre></div>
<p>参数可以是字符串、时间戳、时间对象等数据</p>
<div class="highlight"><pre><span></span><span class="nx">t</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">gtime</span><span class="p">.</span><span class="nx">NewFromStr</span><span class="p">(</span><span class="s">&quot;2023-11-03 21:50:25&quot;</span><span class="p">)</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="nx">t</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">gtime</span><span class="p">.</span><span class="nx">StrToTime</span><span class="p">(</span><span class="s">&quot;2023-11-03 21:50:25&quot;</span><span class="p">)</span>
</pre></div>
<p>将字符串转为时间对象，具体支持的时间格式见文档<a href="">时间管理/工具方法</a></p>
<p><strong>设置时区</strong></p>
<div class="highlight"><pre><span></span><span class="nx">gtime</span><span class="p">.</span><span class="nx">SetTimeZone</span><span class="p">(</span><span class="s">&quot;Asia/Tokyo&quot;</span><span class="p">)</span>
<span class="nx">t</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">gtime</span><span class="p">.</span><span class="nx">Now</span><span class="p">()</span>
</pre></div>
<p><strong>时间戳</strong></p>
<div class="highlight"><pre><span></span><span class="nx">t1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">gtime</span><span class="p">.</span><span class="nx">Timestamp</span><span class="p">()</span>
<span class="nx">t2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">gtime</span><span class="p">.</span><span class="nx">TimestampMilli</span><span class="p">()</span>
<span class="nx">t3</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">gtime</span><span class="p">.</span><span class="nx">TimestampMicro</span><span class="p">()</span>
<span class="nx">t4</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">gtime</span><span class="p">.</span><span class="nx">TimestampNano</span><span class="p">()</span>
</pre></div>
<p>返回为<code>int64</code>类型，也可以返回字符串类型</p>
<div class="highlight"><pre><span></span><span class="nx">t1</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">gtime</span><span class="p">.</span><span class="nx">TimestampStr</span><span class="p">()</span>
<span class="nx">t2</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">gtime</span><span class="p">.</span><span class="nx">TimestampMilliStr</span><span class="p">()</span>
<span class="nx">t3</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">gtime</span><span class="p">.</span><span class="nx">TimestampMicroStr</span><span class="p">()</span>
<span class="nx">t4</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">gtime</span><span class="p">.</span><span class="nx">TimestampNanoStr</span><span class="p">()</span>
</pre></div>
<p><strong>格式化日期数据</strong></p>
<p>可以将日期格式化为指定的格式，具体格式化用到的符号见文档<a href="">时间管理/时间格式</a></p>
<div class="highlight"><pre><span></span><span class="nx">t</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">gtime</span><span class="p">.</span><span class="nx">Now</span><span class="p">()</span>
<span class="nx">req</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Writeln</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">Format</span><span class="p">(</span><span class="s">&quot;Y-m-d H:i:s&quot;</span><span class="p">))</span>
<span class="nx">req</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Writeln</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">Format</span><span class="p">(</span><span class="s">&quot;YmdHis&quot;</span><span class="p">))</span>
</pre></div>
<p><strong>获取年月日时分秒</strong></p>
<div class="highlight"><pre><span></span><span class="nx">t</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">gtime</span><span class="p">.</span><span class="nx">Now</span><span class="p">()</span>
<span class="nx">req</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Writeln</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">Year</span><span class="p">())</span>
<span class="nx">req</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Writeln</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">Month</span><span class="p">())</span>
<span class="nx">req</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Writeln</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">Day</span><span class="p">())</span>
<span class="nx">req</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Writeln</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">Hour</span><span class="p">())</span>
<span class="nx">req</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Writeln</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">Minute</span><span class="p">())</span>
<span class="nx">req</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">Writeln</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">Second</span><span class="p">())</span>
</pre></div>
<p>更多操作方法见文档<a href="">时间管理/方法介绍</a></p>
<h2>随机数</h2>
<p><strong>随机整数</strong></p>
<div class="highlight"><pre><span></span><span class="nx">n</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">grand</span><span class="p">.</span><span class="nx">Intn</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
<p>返回0 &lt;= n &lt; 100的随机数</p>
<div class="highlight"><pre><span></span><span class="nx">n</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">grand</span><span class="p">.</span><span class="nx">N</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">999</span><span class="p">)</span>
</pre></div>
<p>返回100 &lt;= n &lt;= 999的随机数</p>
<p><strong>随机字符串</strong></p>
<div class="highlight"><pre><span></span><span class="nx">s</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">grand</span><span class="p">.</span><span class="nx">S</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="nx">s</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">grand</span><span class="p">.</span><span class="nx">S</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span>
</pre></div>
<p>返回指定长度的随机字母/数字组合的字符串，第二个参数为<code>true</code>表示包括特殊符号</p>
<div class="highlight"><pre><span></span><span class="nx">s</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">grand</span><span class="p">.</span><span class="nx">Digits</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
<p>返回指定长度的随机数字字符串</p>
<div class="highlight"><pre><span></span><span class="nx">s</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">grand</span><span class="p">.</span><span class="nx">Letters</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
<p>返回指定长度的随机字母字符串</p>
<div class="highlight"><pre><span></span><span class="nx">s</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">grand</span><span class="p">.</span><span class="nx">Symbols</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
<p>返回指定长度的随机特殊符号字符串</p>
<div class="highlight"><pre><span></span><span class="nx">s</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">grand</span><span class="p">.</span><span class="nx">Str</span><span class="p">(</span><span class="s">&quot;日照香炉生紫烟，遥看瀑布挂前川。Oh Yeah&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span>
</pre></div>
<p>从给定的字符串中随机返回指定数量的字符，可以是汉字。</p>
<p><strong>全局唯一数</strong></p>
<div class="highlight"><pre><span></span><span class="nx">s</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">guid</span><span class="p">.</span><span class="nx">S</span><span class="p">()</span>
</pre></div>
<h1>接口文档</h1>
<p>用规范路由的写法，GoFrame会自动生成接口文档。所有接口信息会自动生成在<code>/api.json</code>中，遵循的是<code>OpenAPIv3</code>标准，框架默认使用的是<code>redoc</code>来生成文档前端页面，只能查看接口信息，不能进行请求测试。因此可以可以改为其他UI页面，例如<code>swaggerUI</code>或者自行实现UI页面。</p>
<ul>
<li><strong>注释掉<code>manifest/config/config.yml</code>中的<code>swaggerPath: "/swagger"</code></strong></li>
<li><strong>实现UI页面，引入<code>swaggerUI</code>组件</strong></li>
</ul>
<p><code>swagger.html</code></p>
<div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;en&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;X-UA-Compatible&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;IE=edge&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/swagger-ui.css&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;/swagger-ui-bundle.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>API Doc<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;swagger-ui&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/javascript&quot;</span><span class="p">&gt;</span>
<span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">ui</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">SwaggerUIBundle</span><span class="p">({</span>
<span class="w">        </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;/api.json&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">dom_id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;#swagger-ui&#39;</span>
<span class="w">    </span><span class="p">})</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
<p>引入的CSS与JS文件如果下载到项目中则用上述方式引入，或者可以通过下列CDN引入</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://unpkg.com/swagger-ui-dist@latest/swagger-ui.css&quot;</span> <span class="p">/&gt;</span>
</pre></div>
<ul>
<li><strong>添加路由</strong></li>
</ul>
<div class="highlight"><pre><span></span><span class="nx">group</span><span class="p">.</span><span class="nx">GET</span><span class="p">(</span><span class="s">&quot;/swagger&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">req</span><span class="w"> </span><span class="o">*</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">req</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">WriteTpl</span><span class="p">(</span><span class="s">&quot;/swagger.html&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">})</span>
</pre></div>
<h1>构建打包</h1>
<p>GoFrame中静态资源也可以直接打包进可执行文件当中，发布时只需提供一个可执行文件即可。</p>
<ul>
<li><strong>配置</strong></li>
</ul>
<p><code>hack/config.yaml</code></p>
<div class="highlight"><pre><span></span><span class="nt">gfcli</span><span class="p">:</span>
<span class="w">  </span><span class="nt">build</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;hellogf&quot;</span>
<span class="w">    </span><span class="nt">arch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;amd64&quot;</span>
<span class="w">    </span><span class="nt">system</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;linux&quot;</span>
<span class="w">    </span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;none&quot;</span>
<span class="w">    </span><span class="nt">cgo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
<span class="w">    </span><span class="nt">packSrc</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;manifest/config,resource/public,resource/template&quot;</span>
<span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1.0.0&quot;</span>
<span class="w">    </span><span class="nt">output</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;./bin&quot;</span>
<span class="w">    </span><span class="nt">extra</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
</pre></div>
<blockquote><ul>
<li><code>name</code>：打包后的可执行文件名</li>
<li><code>arch</code>：系统架构，可以有多个，用<kbd>,</kbd>分隔，用<code>all</code>表示编译所有支持的架构</li>
<li><code>system</code>：编译平台，可以有多个，用<kbd>,</kbd>分隔，用<code>all</code>表示编译所有支持的系统</li>
<li><code>packSrc</code>：需要打包的静态资源目录</li>
<li><code>version</code>：版本号</li>
</ul>
</blockquote>
<ul>
<li><strong>打包</strong></li>
</ul>
<div class="highlight"><pre><span></span>gf<span class="w"> </span>build
</pre></div>
<p>以上操作会把指定的目录一起打包进可执行文件。通常情况例如配置文件等一些需要改动的文件不用打包进可执行文件。</p>
<h1>综合示例</h1>
<p>本示例简单实现下列功能的API：</p>
<ol>
<li>书本数据获取(分页)</li>
<li>书本数据添加、编辑、删除</li>
<li>用户名与密码登录</li>
<li>书本数据展示与添加、编辑、删除需要登录才能访问</li>
</ol>
<p>本示例用API实现，即只用JSON格式数据进行返回。如果需要用模板实现，核心部分都相同，只是需要将返回的数据自行组织到模板页面上。</p>
<h1>#</h1>
<p><strong>1. 创建项目</strong></p>
<div class="highlight"><pre><span></span>gf<span class="w"> </span>init<span class="w"> </span>gfbook
</pre></div>
<p>删除<code>api</code>、<code>controller</code>中自动生成的文件，删除<code>cmd.go</code>中的路由绑定。</p>
<p>添加依赖的库，<code>mysql</code>驱动和<code>jwt</code></p>
<p>方法一（需要联网）：</p>
<div class="highlight"><pre><span></span>go<span class="w"> </span>get<span class="w"> </span>github.com/gogf/gf/contrib/drivers/mysql/v2
go<span class="w"> </span>get<span class="w"> </span>github.com/golang-jwt/jwt/v5
</pre></div>
<p><code>mysql</code>驱动初始化导入</p>
<p><code>main.go</code></p>
<div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">_</span><span class="w"> </span><span class="s">&quot;github.com/gogf/gf/contrib/drivers/mysql/v2&quot;</span>
<span class="p">)</span>
</pre></div>
<p>方法二（需要之前已经下载过对应版本的库，此次不需要联网）</p>
<p>需要先进行初始化导入，不然没法添加</p>
<p><code>main.go</code></p>
<div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">_</span><span class="w"> </span><span class="s">&quot;github.com/gogf/gf/contrib/drivers/mysql/v2&quot;</span>
<span class="w">    </span><span class="nx">_</span><span class="w"> </span><span class="s">&quot;github.com/golang-jwt/jwt/v5&quot;</span><span class="w"> </span><span class="c1">// 这行在go mod tidy运行之后删除</span>
<span class="p">)</span>
</pre></div>
<p><code>go.mod</code></p>
<div class="highlight"><pre><span></span><span class="nx">require</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">gogf</span><span class="o">/</span><span class="nx">gf</span><span class="o">/</span><span class="nx">contrib</span><span class="o">/</span><span class="nx">drivers</span><span class="o">/</span><span class="nx">mysql</span><span class="o">/</span><span class="nx">v2</span><span class="w"> </span><span class="nx">v2</span><span class="mf">.5.3</span>
<span class="w">    </span><span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">gogf</span><span class="o">/</span><span class="nx">gf</span><span class="o">/</span><span class="nx">v2</span><span class="w"> </span><span class="nx">v2</span><span class="mf">.5.3</span>
<span class="w">    </span><span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">golang</span><span class="o">-</span><span class="nx">jwt</span><span class="o">/</span><span class="nx">jwt</span><span class="o">/</span><span class="nx">v5</span><span class="w"> </span><span class="nx">v5</span><span class="mf">.0.0</span>
<span class="p">)</span>
</pre></div>
<p>执行以下指令更新</p>
<div class="highlight"><pre><span></span>go<span class="w"> </span>mod<span class="w"> </span>tidy
</pre></div>
<p><strong>2. 配置</strong></p>
<p><code>internal/config/config.yaml</code></p>
<p>配置数据库连接</p>
<div class="highlight"><pre><span></span><span class="nt">server</span><span class="p">:</span>
<span class="w">  </span><span class="nt">address</span><span class="p">:</span><span class="w">     </span><span class="s">&quot;:8000&quot;</span>
<span class="w">  </span><span class="nt">openapiPath</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/api.json&quot;</span>
<span class="w">  </span><span class="nt">swaggerPath</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/swagger&quot;</span>
<span class="w">  </span><span class="nt">serverRoot</span><span class="p">:</span><span class="w">  </span><span class="s">&quot;resource/public/resource&quot;</span>

<span class="nt">database</span><span class="p">:</span>
<span class="w">  </span><span class="nt">link</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mysql:root:root@tcp(127.0.0.1:3306)/goframe?loc=Local&amp;parseTime=true&quot;</span>

<span class="nt">logger</span><span class="p">:</span>
<span class="w">  </span><span class="nt">level </span><span class="p">:</span><span class="w"> </span><span class="s">&quot;all&quot;</span>
<span class="w">  </span><span class="nt">stdout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div>
<p>准备需要用到的资源文件</p>
<p><code>hack/config.yaml</code></p>
<p>配置DAO生成相关信息</p>
<div class="highlight"><pre><span></span><span class="nt">gfcli</span><span class="p">:</span>
<span class="w">  </span><span class="nt">gen</span><span class="p">:</span>
<span class="w">    </span><span class="nt">dao</span><span class="p">:</span>
<span class="w">      </span><span class="nt">link</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mysql:root:root@tcp(127.0.0.1:3306)/goframe&quot;</span>
<span class="w">      </span><span class="nt">tables</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;user,book&quot;</span>
<span class="w">      </span><span class="nt">jsonCase</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Snake&quot;</span>
</pre></div>
<p>配置完成之后运行命令生成DAO相关文件</p>
<div class="highlight"><pre><span></span>gf<span class="w"> </span>gen<span class="w"> </span>dao
</pre></div>
<p><strong>3.编写API数据结构</strong></p>
<p><code>api/user/user.go</code></p>
<div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nx">user</span>

<span class="kn">import</span><span class="w"> </span><span class="s">&quot;github.com/gogf/gf/v2/frame/g&quot;</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">LoginReq</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">g</span><span class="p">.</span><span class="nx">Meta</span><span class="w">   </span><span class="s">`path:&quot;/login&quot; method:&quot;post&quot;`</span>
<span class="w">    </span><span class="nx">Username</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="s">`p:&quot;username&quot; v:&quot;required#请输入用户名&quot; dc:&quot;用户名&quot;`</span>
<span class="w">    </span><span class="nx">Password</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="s">`p:&quot;password&quot; v:&quot;required#请输入密码&quot; dc:&quot;密码&quot;`</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">UserInfo</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Id</span><span class="w">       </span><span class="kt">uint</span><span class="w">   </span><span class="s">`json:&quot;id&quot;         dc:&quot;用户ID&quot;`</span>
<span class="w">    </span><span class="nx">Username</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;username&quot;   dc:&quot;用户名&quot;`</span>
<span class="w">    </span><span class="nx">Nickname</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;nickname&quot;   dc:&quot;昵称&quot;`</span>
<span class="w">    </span><span class="nx">Avatar</span><span class="w">   </span><span class="kt">string</span><span class="w"> </span><span class="s">`json:&quot;avatar&quot;     dc:&quot;用户头像&quot;`</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">LoginRes</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Token</span><span class="w">    </span><span class="kt">string</span><span class="w">    </span><span class="s">`json:&quot;token&quot; dc:&quot;验证token&quot;`</span>
<span class="w">    </span><span class="nx">UserInfo</span><span class="w"> </span><span class="o">*</span><span class="nx">UserInfo</span><span class="w"> </span><span class="s">`json:&quot;user_info&quot;`</span>
<span class="p">}</span>
</pre></div>
<p><code>api/book/book.go</code></p>
<div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nx">book</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;gfbook/internal/model/entity&quot;</span>

<span class="w">    </span><span class="s">&quot;github.com/gogf/gf/v2/frame/g&quot;</span>
<span class="w">    </span><span class="s">&quot;github.com/gogf/gf/v2/os/gtime&quot;</span>
<span class="p">)</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">IndexReq</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">g</span><span class="p">.</span><span class="nx">Meta</span><span class="w">   </span><span class="s">`path:&quot;/book&quot; method:&quot;get&quot;`</span>
<span class="w">    </span><span class="nx">Page</span><span class="w">     </span><span class="kt">uint</span><span class="w"> </span><span class="s">`p:&quot;page&quot; v:&quot;required|integer|min:1#数据页不能为空|数据页只能是整数|数据页不能小于1&quot; dc:&quot;页数&quot;`</span>
<span class="w">    </span><span class="nx">PageSize</span><span class="w"> </span><span class="kt">uint</span><span class="w"> </span><span class="s">`p:&quot;page_size&quot; v:&quot;integer|min:1#数据大小只能为整数|数据大小不能小于1&quot; d:&quot;10&quot; dc:&quot;每页数据量&quot;`</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">IndexRes</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Page</span><span class="w">     </span><span class="kt">uint</span><span class="w">          </span><span class="s">`json:&quot;page&quot; dc:&quot;页数&quot;`</span>
<span class="w">    </span><span class="nx">PageSize</span><span class="w"> </span><span class="kt">uint</span><span class="w">          </span><span class="s">`json:&quot;page_size&quot; dc:&quot;每页数据量&quot;`</span>
<span class="w">    </span><span class="nx">Rows</span><span class="w">     </span><span class="p">[]</span><span class="nx">entity</span><span class="p">.</span><span class="nx">Book</span><span class="w"> </span><span class="s">`json:&quot;rows&quot; dc:&quot;查询数据&quot;`</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">AddReq</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">g</span><span class="p">.</span><span class="nx">Meta</span><span class="w">      </span><span class="s">`path:&quot;/book&quot; method:&quot;post&quot;`</span>
<span class="w">    </span><span class="nx">Name</span><span class="w">        </span><span class="kt">string</span><span class="w">      </span><span class="s">`p:&quot;name&quot; v:&quot;required#书名不能为空&quot;  dc:&quot;书名&quot;      `</span>
<span class="w">    </span><span class="nx">Author</span><span class="w">      </span><span class="kt">string</span><span class="w">      </span><span class="s">`p:&quot;author&quot; v:&quot;required#作者不能为空&quot;   dc:&quot;作者&quot;     `</span>
<span class="w">    </span><span class="nx">Price</span><span class="w">       </span><span class="kt">float64</span><span class="w">     </span><span class="s">`p:&quot;price&quot; v:&quot;required|float|min:0#价格不能为空|价格格式不正确|价格不能小于0&quot; dc:&quot;价格&quot;       `</span>
<span class="w">    </span><span class="nx">PublishTime</span><span class="w"> </span><span class="o">*</span><span class="nx">gtime</span><span class="p">.</span><span class="nx">Time</span><span class="w"> </span><span class="s">`p:&quot;publish_time&quot; v:&quot;date#出版时间格式不正确&quot; dc:&quot;出版日期&quot;`</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">AddRes</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">EditReq</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">g</span><span class="p">.</span><span class="nx">Meta</span><span class="w">      </span><span class="s">`path:&quot;/book&quot; method:&quot;put&quot;`</span>
<span class="w">    </span><span class="nx">Id</span><span class="w">          </span><span class="kt">uint</span><span class="w">        </span><span class="s">`p:&quot;id&quot; v:&quot;required&quot; dc:&quot;书本ID&quot;`</span>
<span class="w">    </span><span class="nx">Name</span><span class="w">        </span><span class="kt">string</span><span class="w">      </span><span class="s">`p:&quot;name&quot;  dc:&quot;书名&quot;      `</span>
<span class="w">    </span><span class="nx">Author</span><span class="w">      </span><span class="kt">string</span><span class="w">      </span><span class="s">`p:&quot;author&quot;   dc:&quot;作者&quot;     `</span>
<span class="w">    </span><span class="nx">Price</span><span class="w">       </span><span class="kt">float64</span><span class="w">     </span><span class="s">`p:&quot;price&quot; v:&quot;float|min:0#价格格式不正确|价格不能小于0&quot;  dc:&quot;价格&quot;      `</span>
<span class="w">    </span><span class="nx">PublishTime</span><span class="w"> </span><span class="o">*</span><span class="nx">gtime</span><span class="p">.</span><span class="nx">Time</span><span class="w"> </span><span class="s">`p:&quot;publish_time&quot; v:&quot;date#出版时间格式不正确&quot; dc:&quot;出版日期&quot;`</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">EditRes</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">DelReq</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">g</span><span class="p">.</span><span class="nx">Meta</span><span class="w"> </span><span class="s">`path:&quot;/book&quot; method:&quot;delete&quot;`</span>
<span class="w">    </span><span class="nx">Id</span><span class="w">     </span><span class="kt">uint</span><span class="w"> </span><span class="s">`p:&quot;id&quot; v:&quot;required&quot; dc:&quot;书本ID&quot;`</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">DelRes</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>
</pre></div>
<p><strong>4. 控制器框架及路由绑定</strong></p>
<p><code>internal/controller/user/user.go</code></p>
<div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nx">user</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;context&quot;</span>
<span class="w">    </span><span class="s">&quot;gfbook/api/user&quot;</span>
<span class="p">)</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">UserController</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">cUser</span><span class="p">{}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">cUser</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">cUser</span><span class="p">)</span><span class="w"> </span><span class="nx">Login</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">req</span><span class="w"> </span><span class="o">*</span><span class="nx">user</span><span class="p">.</span><span class="nx">LoginReq</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="o">*</span><span class="nx">user</span><span class="p">.</span><span class="nx">LoginRes</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span>
<span class="p">}</span>
</pre></div>
<p><code>internal/controller/book/book.go</code></p>
<div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nx">book</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;context&quot;</span>
<span class="w">    </span><span class="s">&quot;gfbook/api/book&quot;</span>
<span class="p">)</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">BookController</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">cBook</span><span class="p">{}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">cBook</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">cBook</span><span class="p">)</span><span class="w"> </span><span class="nx">Index</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">req</span><span class="w"> </span><span class="o">*</span><span class="nx">book</span><span class="p">.</span><span class="nx">IndexReq</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="o">*</span><span class="nx">book</span><span class="p">.</span><span class="nx">IndexRes</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">cBook</span><span class="p">)</span><span class="w"> </span><span class="nx">Add</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">req</span><span class="w"> </span><span class="o">*</span><span class="nx">book</span><span class="p">.</span><span class="nx">AddReq</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="o">*</span><span class="nx">book</span><span class="p">.</span><span class="nx">AddRes</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">cBook</span><span class="p">)</span><span class="w"> </span><span class="nx">Edit</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">req</span><span class="w"> </span><span class="o">*</span><span class="nx">book</span><span class="p">.</span><span class="nx">EditReq</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="o">*</span><span class="nx">book</span><span class="p">.</span><span class="nx">EditRes</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">cBook</span><span class="p">)</span><span class="w"> </span><span class="nx">Del</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">req</span><span class="w"> </span><span class="o">*</span><span class="nx">book</span><span class="p">.</span><span class="nx">DelReq</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="o">*</span><span class="nx">book</span><span class="p">.</span><span class="nx">EditRes</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span>
<span class="p">}</span>
</pre></div>
<p><code>internal/cmd/cmd.go</code></p>
<div class="highlight"><pre><span></span><span class="nx">s</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">g</span><span class="p">.</span><span class="nx">Server</span><span class="p">()</span>
<span class="nx">s</span><span class="p">.</span><span class="nx">Group</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">group</span><span class="w"> </span><span class="o">*</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">RouterGroup</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">group</span><span class="p">.</span><span class="nx">Middleware</span><span class="p">(</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">MiddlewareHandlerResponse</span><span class="p">)</span>
<span class="w">    </span><span class="nx">group</span><span class="p">.</span><span class="nx">Group</span><span class="p">(</span><span class="s">&quot;/user&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">group</span><span class="w"> </span><span class="o">*</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">RouterGroup</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">group</span><span class="p">.</span><span class="nx">Bind</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">UserController</span><span class="p">)</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">    </span><span class="nx">group</span><span class="p">.</span><span class="nx">Group</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">group</span><span class="w"> </span><span class="o">*</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">RouterGroup</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">group</span><span class="p">.</span><span class="nx">Bind</span><span class="p">(</span><span class="nx">book</span><span class="p">.</span><span class="nx">BookController</span><span class="p">)</span>
<span class="w">    </span><span class="p">})</span>
<span class="p">})</span>
</pre></div>
<p><strong>5. 设计Book的Service接口并完善控制器</strong></p>
<p><code>internal/service/book.go</code></p>
<div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nx">service</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;context&quot;</span>
<span class="w">    </span><span class="s">&quot;gfbook/internal/model/do&quot;</span>
<span class="w">    </span><span class="s">&quot;gfbook/internal/model/entity&quot;</span>
<span class="p">)</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">IBook</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 查询书本列表</span>
<span class="w">    </span><span class="nx">GetList</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="kt">uint</span><span class="p">,</span><span class="w"> </span><span class="nx">pageSize</span><span class="w"> </span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">books</span><span class="w"> </span><span class="p">[]</span><span class="nx">entity</span><span class="p">.</span><span class="nx">Book</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
<span class="w">    </span><span class="c1">// 添加书本信息</span>
<span class="w">    </span><span class="nx">Add</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">book</span><span class="w"> </span><span class="nx">do</span><span class="p">.</span><span class="nx">Book</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
<span class="w">    </span><span class="c1">// 修改书本信息</span>
<span class="w">    </span><span class="nx">Edit</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">book</span><span class="w"> </span><span class="nx">do</span><span class="p">.</span><span class="nx">Book</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
<span class="w">    </span><span class="c1">// 删除书本信息</span>
<span class="w">    </span><span class="nx">Del</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">localBook</span><span class="w"> </span><span class="nx">IBook</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">Book</span><span class="p">()</span><span class="w"> </span><span class="nx">IBook</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">localBook</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nb">panic</span><span class="p">(</span><span class="s">&quot;IBook接口未实现或未注册&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">localBook</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">RegisterBook</span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="nx">IBook</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">localBook</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">i</span>
<span class="p">}</span>
</pre></div>
<p><code>internal/controller/book/book.go</code></p>
<div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nx">book</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;context&quot;</span>
<span class="w">    </span><span class="s">&quot;gfbook/api/book&quot;</span>
<span class="w">    </span><span class="s">&quot;gfbook/internal/model/do&quot;</span>
<span class="w">    </span><span class="s">&quot;gfbook/internal/service&quot;</span>
<span class="p">)</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">BookController</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">cBook</span><span class="p">{</span>
<span class="w">    </span><span class="nx">service</span><span class="p">:</span><span class="w"> </span><span class="nx">service</span><span class="p">.</span><span class="nx">Book</span><span class="p">(),</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">cBook</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">service</span><span class="w"> </span><span class="nx">service</span><span class="p">.</span><span class="nx">IBook</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">cBook</span><span class="p">)</span><span class="w"> </span><span class="nx">Index</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">req</span><span class="w"> </span><span class="o">*</span><span class="nx">book</span><span class="p">.</span><span class="nx">IndexReq</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="o">*</span><span class="nx">book</span><span class="p">.</span><span class="nx">IndexRes</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">books</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">service</span><span class="p">.</span><span class="nx">Book</span><span class="p">().</span><span class="nx">GetList</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">Page</span><span class="p">,</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">PageSize</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">res</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">book</span><span class="p">.</span><span class="nx">IndexRes</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Page</span><span class="p">:</span><span class="w">     </span><span class="nx">req</span><span class="p">.</span><span class="nx">Page</span><span class="p">,</span>
<span class="w">            </span><span class="nx">PageSize</span><span class="p">:</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">PageSize</span><span class="p">,</span>
<span class="w">            </span><span class="nx">Rows</span><span class="p">:</span><span class="w">     </span><span class="nx">books</span><span class="p">,</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">cBook</span><span class="p">)</span><span class="w"> </span><span class="nx">Add</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">req</span><span class="w"> </span><span class="o">*</span><span class="nx">book</span><span class="p">.</span><span class="nx">AddReq</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="o">*</span><span class="nx">book</span><span class="p">.</span><span class="nx">AddRes</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">service</span><span class="p">.</span><span class="nx">Add</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">do</span><span class="p">.</span><span class="nx">Book</span><span class="p">{</span>
<span class="w">        </span><span class="nx">Name</span><span class="p">:</span><span class="w">        </span><span class="nx">req</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Author</span><span class="p">:</span><span class="w">      </span><span class="nx">req</span><span class="p">.</span><span class="nx">Author</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Price</span><span class="p">:</span><span class="w">       </span><span class="nx">req</span><span class="p">.</span><span class="nx">Price</span><span class="p">,</span>
<span class="w">        </span><span class="nx">PublishTime</span><span class="p">:</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">PublishTime</span><span class="p">,</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">    </span><span class="k">return</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">cBook</span><span class="p">)</span><span class="w"> </span><span class="nx">Edit</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">req</span><span class="w"> </span><span class="o">*</span><span class="nx">book</span><span class="p">.</span><span class="nx">EditReq</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="o">*</span><span class="nx">book</span><span class="p">.</span><span class="nx">EditRes</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">service</span><span class="p">.</span><span class="nx">Edit</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">do</span><span class="p">.</span><span class="nx">Book</span><span class="p">{</span>
<span class="w">        </span><span class="nx">Id</span><span class="p">:</span><span class="w">          </span><span class="nx">req</span><span class="p">.</span><span class="nx">Id</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Name</span><span class="p">:</span><span class="w">        </span><span class="nx">req</span><span class="p">.</span><span class="nx">Name</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Author</span><span class="p">:</span><span class="w">      </span><span class="nx">req</span><span class="p">.</span><span class="nx">Author</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Price</span><span class="p">:</span><span class="w">       </span><span class="nx">req</span><span class="p">.</span><span class="nx">Price</span><span class="p">,</span>
<span class="w">        </span><span class="nx">PublishTime</span><span class="p">:</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">PublishTime</span><span class="p">,</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">    </span><span class="k">return</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">cBook</span><span class="p">)</span><span class="w"> </span><span class="nx">Del</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">req</span><span class="w"> </span><span class="o">*</span><span class="nx">book</span><span class="p">.</span><span class="nx">DelReq</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="o">*</span><span class="nx">book</span><span class="p">.</span><span class="nx">EditRes</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">service</span><span class="p">.</span><span class="nx">Del</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">Id</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span>
<span class="p">}</span>
</pre></div>
<p><strong>6. Logic层Book操作具体实现</strong></p>
<ul>
<li>新建<code>internal/logic/book/book.go</code>文件，实现上面的<code>IBook</code>接口</li>
</ul>
<p><code>internal/logic/book/book.go</code></p>
<div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nx">book</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;context&quot;</span>
<span class="w">    </span><span class="s">&quot;gfbook/internal/dao&quot;</span>
<span class="w">    </span><span class="s">&quot;gfbook/internal/model/do&quot;</span>
<span class="w">    </span><span class="s">&quot;gfbook/internal/model/entity&quot;</span>
<span class="w">    </span><span class="s">&quot;gfbook/internal/service&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">service</span><span class="p">.</span><span class="nx">RegisterBook</span><span class="p">(</span><span class="nx">New</span><span class="p">())</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">New</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="nx">iBook</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">iBook</span><span class="p">{}</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">iBook</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>

<span class="c1">// Add implements service.IBook.</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">iBook</span><span class="p">)</span><span class="w"> </span><span class="nx">Add</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">book</span><span class="w"> </span><span class="nx">do</span><span class="p">.</span><span class="nx">Book</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">dao</span><span class="p">.</span><span class="nx">Book</span><span class="p">.</span><span class="nx">Ctx</span><span class="p">(</span><span class="nx">ctx</span><span class="p">).</span><span class="nx">Data</span><span class="p">(</span><span class="nx">book</span><span class="p">).</span><span class="nx">Insert</span><span class="p">()</span>
<span class="w">    </span><span class="k">return</span>
<span class="p">}</span>

<span class="c1">// Del implements service.IBook.</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">iBook</span><span class="p">)</span><span class="w"> </span><span class="nx">Del</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">dao</span><span class="p">.</span><span class="nx">Book</span><span class="p">.</span><span class="nx">Ctx</span><span class="p">(</span><span class="nx">ctx</span><span class="p">).</span><span class="nx">Where</span><span class="p">(</span><span class="nx">dao</span><span class="p">.</span><span class="nx">Book</span><span class="p">.</span><span class="nx">Columns</span><span class="p">().</span><span class="nx">Id</span><span class="p">,</span><span class="w"> </span><span class="nx">id</span><span class="p">).</span><span class="nx">Delete</span><span class="p">()</span>
<span class="w">    </span><span class="k">return</span>
<span class="p">}</span>

<span class="c1">// Edit implements service.IBook.</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">iBook</span><span class="p">)</span><span class="w"> </span><span class="nx">Edit</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">book</span><span class="w"> </span><span class="nx">do</span><span class="p">.</span><span class="nx">Book</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">dao</span><span class="p">.</span><span class="nx">Book</span><span class="p">.</span><span class="nx">Ctx</span><span class="p">(</span><span class="nx">ctx</span><span class="p">).</span><span class="nx">Where</span><span class="p">(</span><span class="nx">dao</span><span class="p">.</span><span class="nx">Book</span><span class="p">.</span><span class="nx">Columns</span><span class="p">().</span><span class="nx">Id</span><span class="p">,</span><span class="w"> </span><span class="nx">book</span><span class="p">.</span><span class="nx">Id</span><span class="p">).</span><span class="nx">Data</span><span class="p">(</span><span class="nx">book</span><span class="p">).</span><span class="nx">Update</span><span class="p">()</span>
<span class="w">    </span><span class="k">return</span>
<span class="p">}</span>

<span class="c1">// GetList implements service.IBook.</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">iBook</span><span class="p">)</span><span class="w"> </span><span class="nx">GetList</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">page</span><span class="w"> </span><span class="kt">uint</span><span class="p">,</span><span class="w"> </span><span class="nx">pageSize</span><span class="w"> </span><span class="kt">uint</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">books</span><span class="w"> </span><span class="p">[]</span><span class="nx">entity</span><span class="p">.</span><span class="nx">Book</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">dao</span><span class="p">.</span><span class="nx">Book</span><span class="p">.</span><span class="nx">Ctx</span><span class="p">(</span><span class="nx">ctx</span><span class="p">).</span><span class="nx">Page</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nx">page</span><span class="p">),</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="nx">pageSize</span><span class="p">)).</span><span class="nx">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">books</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span>
<span class="p">}</span>
</pre></div>
<ul>
<li>新建<code>internal/logic/logic.go</code>文件，并对上述实现进行初始化导入</li>
</ul>
<div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">_</span><span class="w"> </span><span class="s">&quot;gfbook/internal/logic/book&quot;</span>
<span class="p">)</span>
</pre></div>
<ul>
<li>在<code>main.go</code>中对logic进行初始化导入</li>
</ul>
<p><code>main.go</code></p>
<div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">_</span><span class="w"> </span><span class="s">&quot;gfbook/internal/logic&quot;</span>
<span class="p">)</span>
</pre></div>
<p><strong>7. User的Service层设计与控制器完善</strong></p>
<p><code>internal/service/user.go</code></p>
<div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nx">service</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;context&quot;</span>
<span class="w">    </span><span class="s">&quot;gfbook/internal/model/entity&quot;</span>
<span class="p">)</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">IUser</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Login</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">username</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">password</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">user</span><span class="w"> </span><span class="o">*</span><span class="nx">entity</span><span class="p">.</span><span class="nx">User</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">localUser</span><span class="w"> </span><span class="nx">IUser</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">User</span><span class="p">()</span><span class="w"> </span><span class="nx">IUser</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">localUser</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nb">panic</span><span class="p">(</span><span class="s">&quot;IUser接口未实现或未注册&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">localUser</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">RegisterUser</span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="nx">IUser</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">localUser</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">i</span>
<span class="p">}</span>
</pre></div>
<p><code>internal/controller/user/user.go</code></p>
<div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nx">user</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;context&quot;</span>
<span class="w">    </span><span class="nx">api_user</span><span class="w"> </span><span class="s">&quot;gfbook/api/user&quot;</span>
<span class="w">    </span><span class="s">&quot;gfbook/internal/model/entity&quot;</span>
<span class="w">    </span><span class="s">&quot;gfbook/internal/service&quot;</span>
<span class="w">    </span><span class="s">&quot;time&quot;</span>

<span class="w">    </span><span class="s">&quot;github.com/golang-jwt/jwt/v5&quot;</span>
<span class="p">)</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">UserController</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">cUser</span><span class="p">{}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">cUser</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">cUser</span><span class="p">)</span><span class="w"> </span><span class="nx">Login</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">req</span><span class="w"> </span><span class="o">*</span><span class="nx">api_user</span><span class="p">.</span><span class="nx">LoginReq</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">res</span><span class="w"> </span><span class="o">*</span><span class="nx">api_user</span><span class="p">.</span><span class="nx">LoginRes</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">user</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">service</span><span class="p">.</span><span class="nx">User</span><span class="p">().</span><span class="nx">Login</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">Username</span><span class="p">,</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">Password</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">res</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">api_user</span><span class="p">.</span><span class="nx">LoginRes</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Token</span><span class="p">:</span><span class="w"> </span><span class="nx">jwtToken</span><span class="p">(</span><span class="nx">user</span><span class="p">),</span>
<span class="w">            </span><span class="nx">UserInfo</span><span class="p">:</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">api_user</span><span class="p">.</span><span class="nx">UserInfo</span><span class="p">{</span>
<span class="w">                </span><span class="nx">Id</span><span class="p">:</span><span class="w">       </span><span class="nx">user</span><span class="p">.</span><span class="nx">Id</span><span class="p">,</span>
<span class="w">                </span><span class="nx">Username</span><span class="p">:</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">Username</span><span class="p">,</span>
<span class="w">                </span><span class="nx">Nickname</span><span class="p">:</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">Nickname</span><span class="p">,</span>
<span class="w">                </span><span class="nx">Avatar</span><span class="p">:</span><span class="w">   </span><span class="nx">user</span><span class="p">.</span><span class="nx">Avatar</span><span class="p">,</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">jwtToken</span><span class="p">(</span><span class="nx">user</span><span class="w"> </span><span class="o">*</span><span class="nx">entity</span><span class="p">.</span><span class="nx">User</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">JwtTokenKey</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;zbvxMPp12fibPNnOaYmc0rviniaJCOVJ&quot;</span>
<span class="w">    </span><span class="c1">// 实际使用中可将Key存于文件中或放在常量中 consts.JwtTokenKey</span>

<span class="w">    </span><span class="nx">claim</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">jwt</span><span class="p">.</span><span class="nx">RegisteredClaims</span><span class="p">{</span>
<span class="w">        </span><span class="nx">Subject</span><span class="p">:</span><span class="w">   </span><span class="nx">user</span><span class="p">.</span><span class="nx">Username</span><span class="p">,</span>
<span class="w">        </span><span class="nx">ExpiresAt</span><span class="p">:</span><span class="w"> </span><span class="nx">jwt</span><span class="p">.</span><span class="nx">NewNumericDate</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Now</span><span class="p">().</span><span class="nx">Add</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Hour</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">24</span><span class="p">)),</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">token</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">jwt</span><span class="p">.</span><span class="nx">NewWithClaims</span><span class="p">(</span><span class="nx">jwt</span><span class="p">.</span><span class="nx">SigningMethodHS256</span><span class="p">,</span><span class="w"> </span><span class="nx">claim</span><span class="p">).</span><span class="nx">SignedString</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">JwtTokenKey</span><span class="p">))</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nb">panic</span><span class="p">(</span><span class="s">&quot;token生成出错&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">token</span>
<span class="p">}</span>
</pre></div>
<p><strong>8. User的Logic层实现</strong></p>
<p><code>internal/logic/user/user.go</code></p>
<div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nx">user</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;context&quot;</span>
<span class="w">    </span><span class="s">&quot;gfbook/internal/dao&quot;</span>
<span class="w">    </span><span class="s">&quot;gfbook/internal/model/do&quot;</span>
<span class="w">    </span><span class="s">&quot;gfbook/internal/model/entity&quot;</span>
<span class="w">    </span><span class="s">&quot;gfbook/internal/service&quot;</span>

<span class="w">    </span><span class="s">&quot;github.com/gogf/gf/v2/errors/gerror&quot;</span>
<span class="p">)</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">iUser</span><span class="w"> </span><span class="kd">struct</span><span class="p">{}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">New</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="nx">iUser</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">iUser</span><span class="p">{}</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">service</span><span class="p">.</span><span class="nx">RegisterUser</span><span class="p">(</span><span class="nx">New</span><span class="p">())</span>
<span class="p">}</span>

<span class="c1">// Login implements service.IUser.</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">iUser</span><span class="p">)</span><span class="w"> </span><span class="nx">Login</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">username</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">password</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nx">user</span><span class="w"> </span><span class="o">*</span><span class="nx">entity</span><span class="p">.</span><span class="nx">User</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">dao</span><span class="p">.</span><span class="nx">User</span><span class="p">.</span><span class="nx">Ctx</span><span class="p">(</span><span class="nx">ctx</span><span class="p">).</span><span class="nx">Where</span><span class="p">(</span><span class="nx">do</span><span class="p">.</span><span class="nx">User</span><span class="p">{</span>
<span class="w">        </span><span class="nx">Username</span><span class="p">:</span><span class="w"> </span><span class="nx">username</span><span class="p">,</span>
<span class="w">        </span><span class="nx">Password</span><span class="p">:</span><span class="w"> </span><span class="nx">password</span><span class="p">,</span>
<span class="w">    </span><span class="p">}).</span><span class="nx">Scan</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">user</span><span class="p">)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">err</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">gerror</span><span class="p">.</span><span class="nx">New</span><span class="p">(</span><span class="s">&quot;用户名或密码有误&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span>
<span class="p">}</span>
</pre></div>
<p><code>internal/logic/logic.go</code></p>
<div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">_</span><span class="w"> </span><span class="s">&quot;gfbook/internal/logic/book&quot;</span>
<span class="w">    </span><span class="nx">_</span><span class="w"> </span><span class="s">&quot;gfbook/internal/logic/user&quot;</span>
<span class="p">)</span>
</pre></div>
<p><strong>9. 添加登录验证中间件</strong></p>
<p><code>internal/service/middware.go</code></p>
<div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nx">service</span>

<span class="kn">import</span><span class="w"> </span><span class="s">&quot;github.com/gogf/gf/v2/net/ghttp&quot;</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">IMiddleware</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">Auth</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">localMiddleware</span><span class="w"> </span><span class="nx">IMiddleware</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">Middleware</span><span class="p">()</span><span class="w"> </span><span class="nx">IMiddleware</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">localMiddleware</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nb">panic</span><span class="p">(</span><span class="s">&quot;IMiddleware接口未实现或未注册&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">localMiddleware</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">RegisterMiddleware</span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="nx">IMiddleware</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">localMiddleware</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">i</span>
<span class="p">}</span>
</pre></div>
<p><code>internal/logic/middleware/middleware.go</code></p>
<div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nx">middleware</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="s">&quot;gfbook/internal/consts&quot;</span>
<span class="w">    </span><span class="s">&quot;gfbook/internal/service&quot;</span>

<span class="w">    </span><span class="s">&quot;github.com/gogf/gf/v2/net/ghttp&quot;</span>
<span class="w">    </span><span class="s">&quot;github.com/golang-jwt/jwt/v5&quot;</span>
<span class="p">)</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">service</span><span class="p">.</span><span class="nx">RegisterMiddleware</span><span class="p">(</span><span class="nx">New</span><span class="p">())</span>
<span class="p">}</span>

<span class="kd">func</span><span class="w"> </span><span class="nx">New</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="nx">iMiddleware</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">iMiddleware</span><span class="p">{}</span>
<span class="p">}</span>

<span class="kd">type</span><span class="w"> </span><span class="nx">iMiddleware</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span>
<span class="p">}</span>

<span class="c1">// Auth implements service.IMiddleware.</span>
<span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">iMiddleware</span><span class="p">)</span><span class="w"> </span><span class="nx">Auth</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">res</span><span class="w"> </span><span class="o">*</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">DefaultHandlerResponse</span>
<span class="w">    </span><span class="nx">tokenStr</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">Header</span><span class="p">.</span><span class="nx">Get</span><span class="p">(</span><span class="s">&quot;Authorization&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">tokenStr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">res</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">DefaultHandlerResponse</span><span class="p">{</span>
<span class="w">            </span><span class="nx">Code</span><span class="p">:</span><span class="w">    </span><span class="mi">403</span><span class="p">,</span>
<span class="w">            </span><span class="nx">Message</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;请登录后携带token访问&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">token</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">jwt</span><span class="p">.</span><span class="nx">Parse</span><span class="p">(</span><span class="nx">tokenStr</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="o">*</span><span class="nx">jwt</span><span class="p">.</span><span class="nx">Token</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kd">interface</span><span class="p">{},</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="p">[]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">consts</span><span class="p">.</span><span class="nx">JwtTokenKey</span><span class="p">),</span><span class="w"> </span><span class="kc">nil</span>
<span class="w">        </span><span class="p">})</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">!</span><span class="nx">token</span><span class="p">.</span><span class="nx">Valid</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">res</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">DefaultHandlerResponse</span><span class="p">{</span>
<span class="w">                </span><span class="nx">Code</span><span class="p">:</span><span class="w">    </span><span class="mi">403</span><span class="p">,</span>
<span class="w">                </span><span class="nx">Message</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;token已失效，请重新登录&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">res</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">r</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">WriteJsonExit</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">r</span><span class="p">.</span><span class="nx">Middleware</span><span class="p">.</span><span class="nx">Next</span><span class="p">()</span>
<span class="p">}</span>
</pre></div>
<p><code>internal/logic/logic.go</code></p>
<div class="highlight"><pre><span></span><span class="kn">package</span><span class="w"> </span><span class="nx">logic</span>

<span class="kn">import</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="nx">_</span><span class="w"> </span><span class="s">&quot;gfbook/internal/logic/book&quot;</span>
<span class="w">    </span><span class="nx">_</span><span class="w"> </span><span class="s">&quot;gfbook/internal/logic/middleware&quot;</span>
<span class="w">    </span><span class="nx">_</span><span class="w"> </span><span class="s">&quot;gfbook/internal/logic/user&quot;</span>
<span class="p">)</span>
</pre></div>
<p><code>internal/cmd/cmd.go</code></p>
<div class="highlight"><pre><span></span><span class="nx">group</span><span class="p">.</span><span class="nx">Group</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">group</span><span class="w"> </span><span class="o">*</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">RouterGroup</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">group</span><span class="p">.</span><span class="nx">Middleware</span><span class="p">(</span><span class="nx">service</span><span class="p">.</span><span class="nx">Middleware</span><span class="p">().</span><span class="nx">Auth</span><span class="p">)</span>
<span class="w">                    </span><span class="nx">group</span><span class="p">.</span><span class="nx">Bind</span><span class="p">(</span><span class="nx">book</span><span class="p">.</span><span class="nx">BookController</span><span class="p">)</span>
<span class="w">                </span><span class="p">})</span>
</pre></div>
<p><strong>10. 接口文档</strong></p>
<p>准备对应的JS与CSS文件放入静态资源对应的目录，或者可以用在线的CDN链接</p>
<p><code>template/api.html</code></p>
<div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&quot;en&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&quot;X-UA-Compatible&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;IE=edge&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/resource/css/swagger-ui.css&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;/resource/js/swagger-ui-bundle.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>API Doc<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;swagger-ui&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/javascript&quot;</span><span class="p">&gt;</span>
<span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">ui</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">SwaggerUIBundle</span><span class="p">({</span>
<span class="w">        </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;/api.json&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="nx">dom_id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;#swagger-ui&#39;</span>
<span class="w">    </span><span class="p">})</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
<p><code>internal/cmd/cmd.go</code></p>
<div class="highlight"><pre><span></span><span class="nx">group</span><span class="p">.</span><span class="nx">GET</span><span class="p">(</span><span class="s">&quot;/api&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">req</span><span class="w"> </span><span class="o">*</span><span class="nx">ghttp</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">req</span><span class="p">.</span><span class="nx">Response</span><span class="p">.</span><span class="nx">WriteTpl</span><span class="p">(</span><span class="s">&quot;/api.html&quot;</span><span class="p">)</span>
<span class="w">                </span><span class="p">})</span>
</pre></div>
<h1>后续学习项目</h1>
<p><a href="https://github.com/gogf/gf-demo-user">https://github.com/gogf/gf-demo-user</a></p>
<p><a href="https://github.com/gogf/focus-single">https://github.com/gogf/focus-single</a></p>

            </div>
        </article>
        <div id="ga-tags">
    
    <span class="ga-tag">
        <a class="ga-highlight" href="/Xuxx_Blogs/tag/Go/">#Go</a>
    </span>
    
</div>
    </section>

    
<section id="ga-content_pager">

    <div class="next">
        <h3>没有了</h3>
        <p class="yue">这是最新的文章</p>
    </div>


    <div class="prev">
        <a class="ga-highlight" href="/Xuxx_Blogs/archives/bj51/">ElasticSearch笔记_03</a>
        <p class="yue">笔记</p>
    </div>

</section>


    

</main>

                <footer class="ga-mono" id="ga-footer">
                    <section>
                        <span id="ga-uptime"></span>
                        <span class="brand">Xuxx - 个人博客</span>
                    </section>
                    <section>
                        <p class="copyright">
                            <span>Copyright © 2024 Xuxx</span>
                            <span>Powered by <a no-style href="https://github.com/AlanDecode/Maverick" target="_blank">Maverick & Galileo</a></span>
                        </p>
                        <div class="copyright">
                            <span class="footer-addon">
                                
                            </span>
                            <nav class="social-links">
                                <ul><li><a class="no-style" title="Twitter" href="https://twitter.com/xuxx3309" target="_blank"><i class="gi gi-twitter"></i>Twitter</a></li><span class="separator">·</span><li><a class="no-style" title="GitHub" href="https://github.com/QQ1820582487" target="_blank"><i class="gi gi-github"></i>GitHub</a></li></ul>
                            </nav>
                        </div>
                    </section>
                    <script>
                        var site_build_date = "2019-12-26T02:30+08:00"
                    </script>
                    <script src="https://cdn.jsdelivr.net/gh/qq1820582487/Xuxx_Blogs@gh-pages/assets/galileo-d8a0a06eff.js"></script>
                </footer>
            </div>
        </div>
    </div>
        
        
        <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="pswp__bg"></div>
        <div class="pswp__scroll-wrap">
            <div class="pswp__container">
                <div class="pswp__item"></div>
                <div class="pswp__item"></div>
                <div class="pswp__item"></div>
            </div>
            <div class="pswp__ui pswp__ui--hidden">
                <div class="pswp__top-bar">
                    <div class="pswp__counter"></div>
                    <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                    <button class="pswp__button pswp__button--share" title="Share"></button>
                    <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                    <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                    <div class="pswp__preloader">
                        <div class="pswp__preloader__icn">
                          <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                          </div>
                        </div>
                    </div>
                </div>
                <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                    <div class="pswp__share-tooltip"></div> 
                </div>
                <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
                </button>
                <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
                </button>
                <div class="pswp__caption">
                    <div class="pswp__caption__center"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/gh/qq1820582487/Xuxx_Blogs@gh-pages/assets/ExSearch/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/qq1820582487/Xuxx_Blogs@gh-pages/assets/ExSearch/ExSearch-493cb9cd89.js"></script>
    
    <!--katex-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/qq1820582487/Xuxx_Blogs@gh-pages/assets/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/gh/qq1820582487/Xuxx_Blogs@gh-pages/assets/katex.min.js"></script>
    <script>
    mathOpts = {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "\\[", right: "\\]", display: true},
            {left: "$", right: "$", display: false},
            {left: "\\(", right: "\\)", display: false}
        ]
    };
    </script>
    <script defer src="https://cdn.jsdelivr.net/gh/qq1820582487/Xuxx_Blogs@gh-pages/assets/auto-render.min.js" onload="renderMathInElement(document.body, mathOpts);"></script>

    
    </body>
</html>