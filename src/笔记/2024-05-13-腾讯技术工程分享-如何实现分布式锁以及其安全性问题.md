---
layout: post
title: 腾讯技术工程分享-如何实现分布式锁以及其安全性问题
slug: bj52
date: 2024-05-13 20:13
status: publish
author: Xuxx
categories: 
  - 笔记
tags: 
  - 分布式锁
excerpt: 笔记
---


> 问题：
基于 Redis 如何实现一个分布式锁?它足够安全吗 ?
一个严谨的分布式锁模型如何实现，应该考虑什么?
我们经常听到的 Redlock(红锁)有什么问题?
业界争论 Redlock，到底在争论什么?哪种观点是对的 ?
分布式锁到底用 Redis 还是 Zookeeper、Etcd ?

# 1.为什么需要分布式锁？

- 单机锁:同一台机器上的不同线程/进程修改同一个资源操作系统提供互斥能力(线程锁、文件锁、信号量)
- 分布式锁:不同机器上的线程/进程修改同一个资源需借助外部系统(MySQL、Redis、Zookeeper)

![](../static/笔记图片/2024-05-13-腾讯技术工程分享-如何实现分布式锁以及其安全性问题/2024-05-13-腾讯技术工程分享-如何实现分布式锁以及其安全性问题_01.png)

# 2.基于Redis分布式锁怎么实现?

![](../static/笔记图片/2024-05-13-腾讯技术工程分享-如何实现分布式锁以及其安全性问题/2024-05-13-腾讯技术工程分享-如何实现分布式锁以及其安全性问题_02.png)

![](../static/笔记图片/2024-05-13-腾讯技术工程分享-如何实现分布式锁以及其安全性问题/2024-05-13-腾讯技术工程分享-如何实现分布式锁以及其安全性问题_03.png)

# 3.Redis分布锁存在的问题

![](../static/笔记图片/2024-05-13-腾讯技术工程分享-如何实现分布式锁以及其安全性问题/2024-05-13-腾讯技术工程分享-如何实现分布式锁以及其安全性问题_04.png)

![](../static/笔记图片/2024-05-13-腾讯技术工程分享-如何实现分布式锁以及其安全性问题/2024-05-13-腾讯技术工程分享-如何实现分布式锁以及其安全性问题_05.png)

![](../static/笔记图片/2024-05-13-腾讯技术工程分享-如何实现分布式锁以及其安全性问题/2024-05-13-腾讯技术工程分享-如何实现分布式锁以及其安全性问题_06.png)

![](../static/笔记图片/2024-05-13-腾讯技术工程分享-如何实现分布式锁以及其安全性问题/2024-05-13-腾讯技术工程分享-如何实现分布式锁以及其安全性问题_07.png)

![](../static/笔记图片/2024-05-13-腾讯技术工程分享-如何实现分布式锁以及其安全性问题/2024-05-13-腾讯技术工程分享-如何实现分布式锁以及其安全性问题_08.png)

![](../static/笔记图片/2024-05-13-腾讯技术工程分享-如何实现分布式锁以及其安全性问题/2024-05-13-腾讯技术工程分享-如何实现分布式锁以及其安全性问题_09.png)

![](../static/笔记图片/2024-05-13-腾讯技术工程分享-如何实现分布式锁以及其安全性问题/2024-05-13-腾讯技术工程分享-如何实现分布式锁以及其安全性问题_10.png)

> 这只是单机Redis状态下的使用，还未考虑集群环境

![](../static/笔记图片/2024-05-13-腾讯技术工程分享-如何实现分布式锁以及其安全性问题/2024-05-13-腾讯技术工程分享-如何实现分布式锁以及其安全性问题_11.png)

# 4.红锁(Redlock)

![](../static/笔记图片/2024-05-13-腾讯技术工程分享-如何实现分布式锁以及其安全性问题/2024-05-13-腾讯技术工程分享-如何实现分布式锁以及其安全性问题_12.png)

![](../static/笔记图片/2024-05-13-腾讯技术工程分享-如何实现分布式锁以及其安全性问题/2024-05-13-腾讯技术工程分享-如何实现分布式锁以及其安全性问题_13.png)

分布式领域专家 VS Redis作者

![](../static/笔记图片/2024-05-13-腾讯技术工程分享-如何实现分布式锁以及其安全性问题/2024-05-13-腾讯技术工程分享-如何实现分布式锁以及其安全性问题_14.png)

![](../static/笔记图片/2024-05-13-腾讯技术工程分享-如何实现分布式锁以及其安全性问题/2024-05-13-腾讯技术工程分享-如何实现分布式锁以及其安全性问题_15.png)

![](../static/笔记图片/2024-05-13-腾讯技术工程分享-如何实现分布式锁以及其安全性问题/2024-05-13-腾讯技术工程分享-如何实现分布式锁以及其安全性问题_16.png)

![](../static/笔记图片/2024-05-13-腾讯技术工程分享-如何实现分布式锁以及其安全性问题/image-20240513210125508.png)

![](../static/笔记图片/2024-05-13-腾讯技术工程分享-如何实现分布式锁以及其安全性问题/image-20240513210354220.png)

![](../static/笔记图片/2024-05-13-腾讯技术工程分享-如何实现分布式锁以及其安全性问题/image-20240513210911641.png)

![](../static/笔记图片/2024-05-13-腾讯技术工程分享-如何实现分布式锁以及其安全性问题/image-20240513211101410.png)

![](../static/笔记图片/2024-05-13-腾讯技术工程分享-如何实现分布式锁以及其安全性问题/image-20240513211258566.png)

![](../static/笔记图片/2024-05-13-腾讯技术工程分享-如何实现分布式锁以及其安全性问题/image-20240513211349615.png)

![](../static/笔记图片/2024-05-13-腾讯技术工程分享-如何实现分布式锁以及其安全性问题/image-20240513212043743.png)

![](../static/笔记图片/2024-05-13-腾讯技术工程分享-如何实现分布式锁以及其安全性问题/image-20240513212456550.png)

# 5.基于Zookeeper和Etcd的分布锁

![](../static/笔记图片/2024-05-13-腾讯技术工程分享-如何实现分布式锁以及其安全性问题/image-20240513212513824.png)

![](../static/笔记图片/2024-05-13-腾讯技术工程分享-如何实现分布式锁以及其安全性问题/image-20240513212804643.png)

![](../static/笔记图片/2024-05-13-腾讯技术工程分享-如何实现分布式锁以及其安全性问题/image-20240513212954762.png)

![](../static/笔记图片/2024-05-13-腾讯技术工程分享-如何实现分布式锁以及其安全性问题/image-20240513213118232.png)

![](../static/笔记图片/image-20240513213500365.png)

# 6.总结

![](../static/笔记图片/2024-05-13-腾讯技术工程分享-如何实现分布式锁以及其安全性问题/image-20240513213551252.png)

![](../static/笔记图片/2024-05-13-腾讯技术工程分享-如何实现分布式锁以及其安全性问题/image-20240513214036910.png)

NPC问题：进程暂停、网络超时、时钟漂移、GC的STW等等
